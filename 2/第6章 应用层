第6章   应用层

在前五章我们已经详细地讨论了计算机网络提供通信服务的过程。但是我们还没有讨论这些通信服务是如何提供给应用进程来使用过的。本章就是讨论各种应用进程通过什么样的应用层协议来使用网络所提供的这些通信服务。
这里需要再强调一下，每个应用层协议都是为了解决某一类应用问题，而应用问题的解决又往往是通过位于不同主机中的多个应用进程之间的通信和协同工作来完成的。应用层的具体内容就是规定应用进程在通信时所遵循的协议。
应用层的许多协议都是基于客户服务器方式。即使是对等通信方式，实质上也是一种特殊的客户服务器方式。这里再明确一下，客户（client）和服务器（Server）都是指通信中所设计的两个应用进程。客户服务器方式所描述的是进程之间服务和被服务的关系。这里最主要的特征就是：客户是服务请求方，服务器是服务提供方。
下面先讨论许多应用协议都要使用的域名系统。在介绍了文件传送协议和远程登录协议后，就重点介绍万维网的工作原理及其主要协议。由于万维网的出现使因特网得到了飞速的发展，因此万维网在本章中占有最大的篇幅，也本章的重点。接着讨论用户最常用的因特网电子邮件，最后，介绍有关网络管理方面的问题以及有关网络编程的概念。对应用层更深入的学习可参阅【come04】【come06】【tane03】及有关标准。

6.1域名系统DNS
    6.1.1域名系统概述
    域名系统DNS（Domain Name System）是因特网使用的命名系统，用来把便于人们使用的机器名字转换为IP地址。域名系统其实就是名字系统。为什么不叫“名字”而叫“域名”呢？这是因为在这种因特网的命名系统中使用了许多的“域”（domain），因此就出现了“域名”这个名词。“名字系统”没有说清用在什么地方，而“域名系统”就很明确地指明这种系统是用在因特网中。在下一节我们就会讲到，在域名结构中会出现很重要的“点(.)”。
    许多应用层软件经常直接使用域名系统DNS，但计算机的用户只是简介而不是直接使用域名系统。
    用户与因特网上某个主机通信时，显然不愿意使用很难记忆的长达32位二进制主机地址。即使是点分十进制IP地址也并不太容易记忆。相反，大家愿意使用比较容易记忆的主机名字。早在ARPANET时代，整个网络只有数百台计算机，那时适用一个叫做hosts的文件，列出所有主机名字和相应的IP地址。只要用户输入一个主机名字，计算机就可很快地把这个主机名字转换成机器能够识别的二进制IP地址。
    为什么机器在处理IP数据报时要使用IP地址而不使用域名呢？这是因为IP地址的长度是固定的32位（如果是IPv6地址，那就是128位，也是定长的），而域名的长度并不是固定的，机器处理起来比较困难。
    从理论上讲，整个因特网可以只使用一个域名服务器，使它装入因特网上所有主机名，并回答所有对IP地址的查询。然而这种做法并不可取。因为因特网规模很大，这样的域名服务器肯定会因过负荷而无法正常工作，而且一旦域名服务器出现故障，整个因特网就会瘫痪。因此，早在1983年因特网就开始采用层次树状结构的命名方法，并使用分布式的域名系统DNS。DNS的因特网标准是RFC 1034，1035。
    因特网的域名系统DNS被设计成为一个联机分布式数据库系统，并采用客户服务器方式。DNS使大多数名字都在本地进行解析（resolve），仅少量解析需要在因特网上通信，因此DNS系统的效率的效率很高。由于DNS是分布式系统，即使单个计算机出了故障，也不会妨碍整个DNS系统的正常运行。
    域名到IP地址的解析是由分布在因特网上的许多域名服务器程序（可简称为域名服务器）共同完成的。域名服务器程序在专设的结点上运行，而人们也常把运行域名服务器程序的机器称为域名服务器。
    域名到IP地址的解析过程的要点如下：当某一个应用进程需要把主机名解析为IP地址时，该应用进程就调用解析程序（resolver），并成为DNS的一个客户，把待解析的域名放在DNS请求报文中，以UDP用户数据报方式发给本地域名服务器（使用UDP是为了减少开销）。本地域名服务器在查找域名后，把对应的IP地址放在回答报文中返回。应用进程获得目的主机的IP地址后即可进行通信。
    若本地域名服务器不能回答该请求，则此域名服务器就暂时称为DNS中的另一个客户，并向其他域名服务器发出查询请求。这种过程直至找到能够回答该请求的域名服务器为止。上述的这种查找过程，后面还要进一步讨论。
    6.1.2因特网的域名结构
    早期的因特网使用了非等级的名字空间，其优点是名字简短。但当因特网上的用户数急剧增加时，用非等级的名字空间来管理一个很大的而且是经常变换的名字集合是非常困难的。因此，因特网后来就采用了层次树状结构的命名方法，就像全球邮政系统和电话系统那样。采用这种命名方法，任何一个连续在因特网上的注意或路由器，都以一个唯一的层次结构的名字，即域名（domain name）。这里，“域”（domain）是名字空间中一个可被管理的划分。域还可以划分为子域，而子域还可继续划分为子域的子域，这样就形成了顶级域、二级域、三级域，等等。
    从语法上讲，每一个域名都是由标号（label）序列组成，而各标号之间用点隔开（请注意，是小数点“.”，不是中文的句号“。”）。例如下面的域名:mail.cctv.com(三级域名.二级域名.顶级域名)
    就是中央电视台用于收到电子邮件的计算机（即邮件服务器）的域名，它由三个标号组成，其中标号com是顶级域名，标号cctv是二级域名，标号mail是三级域名。
    DNS规定，域名中的标号都由英文字母或数字组成，每一个标号不超过63个字符（但为了记忆方便，最好不要超过12个字符），而不区分大小写字母（例如，CCYV或cctv在域名中是等效的）。标号中除连字符（-）外不能使用其他标点符号。级别最低的域名写在最左边，而级别最高的顶级域名则写在最右边。由多个标号组成的完整域名总共不超过255个字符。DNS既不规定一个域名需要包含多少个下级域名，也不规定每一级的域名代表什么意思。各级域名由其上一级的域名管理机构管理，而最高的顶级域名则由ICANN进行管理。用这种方法可使每一个域名在整个因特网范围内是唯一的，并且也容易设计出一种查找域名的机制。
    需要注意的是，域名只是个逻辑概念，并不代表计算机所在的物理地点。变成的域名和使用有助记忆的字符串，是为了便于人来使用。而IP地址是定长的32位二进制数字则非常便于机器进行处理。这里需要注意，域名中的“点”和点分十进制中的“点”并无一一对应的关系。点分十进制IP地址中一定是包含三个“点”，但每一个域名中“点”的数目则不一定正好是三个。
    据2006年12月的统计，现在顶级域名TLD（Top Level Domain）已有265个【W-TLD】，分为三大类：
    （1）国家顶级域名nTLD：采用ISO 3166的规定。如：cn表示中国，us表示美国，uk表示英国，等等。国家顶级域名又常记为ccTLD（cc表示国家代码country-code）。到2006年12月为止，国家顶级域名总共有247个。
    （2）通用顶级域名gTLD：到2006年12月为止，通用顶级域名的总数已经达到18个【W-gTLD】。最常见的通用顶级域名有7个，即：
        com（公司企业），net（网络服务机构），org（非营利性的组织），int（国际组织），edu（美国专用的教育机构），gov（美国的政府部门），mil表示（美国的军事部门）。
        其余11个通用顶级域名是：
        aero（航空运输企业），biz（公司和企业），cat（加泰隆人的语言和文化团体），coop（合作团体），info（各种情况），jobs（人力资源管理者），mobi（移动产品与服务的用户和提供者），museum（博物馆），name（个人），pro（有证书的专业人员），travel（旅游业）。
    （3）基础结构域名（infrastructure domain）：这种顶级域名只有一个，即arpa，用于反向域名解析，因此又称为反向域名。
        在国家顶级域名下注册的二级域名均由该国家自行确定。例如，顶级域名为jp的日本，将其教育和企业机构的二级域名定为ac和co，而不用edu和com。
        我国把二级域名划分为“类别域名”和“行政区域名”两大类。
        “类别域名”共7个，分别为ac（科研机构）；com（工、商、金融等企业）；edu（中国的教育机构）；gov（中国的政府机构）；mil（中国的国防机构）；net（提供互联网络服务的机构）；org（非营利性的组织）。
        “行政区域名”共34个，适用于我国的各省、自治区、直辖市。例如：bj（北京市），js（江苏省），等等。
    值得注意的是，我国修订的域名体系允许直接在cn的顶级域名下注册二级域名。这显然给我国的因特网用户提供了很大的方便。例如某公司abc以前要注册为abc.com.cn，是个三级域名。但现在可以注册为abc.cn，变成了二级域名。据统计，到2006年6月底为止，直接在cn的顶级域名下注册二级域名已经超过66万个。
    关于我国的互联网发展现状以及各种规定（如申请域名的手续），均可在中国互联网网络信息中心CNNIC的网址上找到【W-CNNIC】。
    用域名树来表示因特网的域名系统是最清楚的。图是因特网域名空间的结构，它实际上是一个倒过来的树，在最上面的是根，但没有对应的名字。根下面一级的节点就是最高一级的顶级域名（由于跟没有名字，所以在跟下面一级的域名就叫做顶级域名）。顶级域名可往下划分子域名，即二级域名。在往下划分就是三级域名四级域名，等等。图列举了一些域名作为自己。凡是在顶级域名com下注册的单位都获得了一个二级域名。图中给出的例子有：中央电视台cctv，以及IBM、惠普（HP）等公司。在顶级域名cn（中国）下面举出了几个二级域名，如bj，edu以及com。在某个二级域名下注册的单位就可以获得一个三级域名。图中给出的在edu下面额三级域名有：tsinghua（清华大学）和pku（北京大学）。一旦某个单位拥有了一个域名，它就可以自己决定是否要进一步划分其下属的子域名，并且不必由其上级机构批准。图中画出了cctv（中央电视台）和Tsinghua（清华大学）都分别划分了自己的下一级的域名mail和www（分别是三级域名和四级域名）。域名树的树叶就是单台计算机的名字，它不能在继续往下划分子域了。
    应当注意，虽然中央电视台和清华大学都各有一台计算机取名为mail，但它们的域名并不一样，因为前者是mail.cctv.com，而后者是mail.tsinghua.edu.cn。因此，即使在世界上还有很多单位的计算机取名为mail，但是它们在因特网中的域名却都必须是唯一的。
    这里还要强调指出，因特网的名字空间是按照机构的组织来划分的，与物理的网络无关，与IP地址中的“子网”也没有关系。
    6.1.3域名服务器
    上面讲述的域名体系是抽象的。但具体实现域名系统则是使用分布在各地的域名服务器。从理论上讲，可以让每一级的域名都有一个相对应的域名服务器，使所有的域名服务器构成和图相对应的“域名服务器树”的结构。但这样做会使域名服务器的数量太多，是域名系统的运行效率降低。因此DNS就采用划分区的办法来解决这个问题。
    一个服务器所负责管辖的（或有权限的）范围叫作区（zone）。各单位根据具体情况来划分自己管辖范围的区。但在一个区中的所有节点必须是能够连通的。每一个区设置相应的权限域名服务器（authoritative name Server），用来保存该区中的所有主机的域名到IP地址的映射。总之，DNS服务器的管辖范围不是以“域”为单位，而是以“区”为单位。区是DNS服务器实际管辖的范围。区可能等于或小于域，但一定不可能大于域。
    图是区的不同划分方法的举例。假定abc公司有下属部门x和y，部门x下面又分三个分部门u，v和w，而y下面还有其下属部门t、图表示abc公司只设一个区abc.com。这是，区abc.com和域abc.com指的是同一件事。但图表示abc公司划分了两个区（大的公司可能要划分多个区）：abc.com和y.abc.com。这两个区都隶属于域abc.com，都各设置了相应的权限域名服务器。不难看出，区是“域”的子集。
    图中公司abc划分的两个区为例，给出了DNS域名服务器树状结构图。这种DNS域名服务器树状结构图可以更准确地反映出DNS的分布式结构。在图中的每一个域名服务器都能够进行部分域名到IP地址的解析。当某个DNS服务器不能进行域名到IP地址的转换时，它就设法找因特网上别的域名服务器进行解析。
    从图可看出，因特网上的DNS域名服务器也是按照层次安排的。每一个域名服务器都只对域名体系中的一部分进行管辖。根据域名服务器所起的作用，可以把域名服务器划分为以下四种不同的类型：
    （1）根域名服务器（root name server）：根域名服务器是最高层次的域名服务器，也是最重要的域名服务器。所有的根域名服务器都知道所有的顶级域名服务器的域名和IP地址。根域名服务器是最重要的域名服务器，因为不管是哪一个本地域名服务器，若要对因特网上任何一个域名进行解析（即转换为IP地址），只要自己无法解析，就首先要求助于根域名服务器。假定所有的根域名服务器都瘫痪了，那么整个的DNS系统就无法工作。在因特网上共有13个不同的IP地址的根域名服务器，他们的名字是用一个英文字母命名，从a一直到m（前12个字母）。这些根域名服务器响应的域名分别是a.rootservers.net，...，m.rootservers.net。但请注意，根域名服务器的数目并不是13个机器，而是13套装置（13 installations）【W-ROOT】。实际上，到2006年底全世界已经安装了123个根域名服务器机器，分布在世界各地（虽然负责运营根域名服务器的组织大多在美国，但这些根域名服务器大部分并不在美国）。这样做的目的是为了方便用户，使世界上大部分DNS域名服务器都能就近找到一个根域名服务器。例如，根域名服务器f现在就有40个地点安装有机器，图是这40个地点的分布情况（中国有三个，位置是背景、香港和台北）。由于根域名服务器采用了任播（anycast）技术，因此当DNS客户向某个根域名服务器进行查询时（用这个根域名服务器的IP地址），因特网上的路由器就能找到里这个DNS客户最近的一个根域名服务器。这样做不仅加快了DNS的查询过程，也更加合理地利用了因特网的资源。
    需要注意的是，在许多情况下，根域名服务器并不直接把待查询的域名直接转换成IP地址（根域名服务器也没有存放这种信息），而是告诉本地域名服务器下一步应当找哪一个顶级域名服务器进行查询。
    由于根域名服务器在DNS中的地位特殊，因此对根域名服务器有许多具体的需求，可参阅 RFC 2870。
    （2）顶级域名服务器（即TLD服务器）：这些域名服务器负责管理在该顶级域名服务器注册的所有二级域名。当收到DNS查询请求时，就给出相应的回答（可能是最后的结果，也可能是下一步应当找的域名服务器的IP地址）。
    （3）权限域名服务器：这就是前面已经讲过的负责一个区的域名服务器。当一个权限域名服务器还不能给出最后的查询回答时，就会告诉发出查询请求的DNS客户，下一步应当找哪一个权限域名服务器。例如在图中，区abc.com和区y.abc.com各设有一个权限域名服务区。
    （4）本地域名服务器（local name server）：本地域名服务器并不属于图所示的域名服务器层次结构，但它对域名系统非常重要。当一个主机发出DNS查询请求时，这个查询请求报文就发送给本地域名服务器。由此可看出本地域名服务器的重要性。每一个因特网服务提供者ISP，或一个大学，甚至一个大学里的系，都可以拥有一个本地域名服务器，这种域名服务器有时也称为默认域名服务器。当PC机使用WindowsXP操作系统时，打开“控制面板”，选择“网络连接”，再用鼠标右键点击任何一种网络连接，选择“属性”、“网络”，然后选择“Internet协议（TCP/IP）”，再选择“属性”，就可看见有关DNS地址的选项（自动获取或指定地址）。这里的DNS服务器指的就是本地域名服务器。本地域名服务器离用户较近，一般不超过几个路由器的距离。当所要查询的主机也属于同一个本地ISP时，该本地域名服务器立即就能将所查询的主机名转换为它的IP地址，而不需要再去询问其他的域名服务器。
    为了提高域名服务器的可靠性，DNS域名服务器都把数据复制到几个域名服务器来保存，其中的一个是主域名服务器（master name server），其他的是辅助域名服务器（secondary name server）。当主域名服务器出故障时，辅助域名服务器可以保证DNS的查询工作不会中断。主域名服务器定期把数据复制到辅助域名服务器中，而更改数据只能在主域名服务器中进行。这样就保证了数据的一致性。
    下面简单讨论一下域名的解析过程。这里要注意两点。
    第一，主机向本地域名服务器查询一般都是采用递归查询（recursive query）。所谓递归查询就是：如果主机所询问的本地域名服务器不知道被查询域名的IP地址，那么本地域名服务器就以DNS客户的身份，向其他根域名服务器发出查询请求报文（即替该主机继续查询），而不是让该主机自己进行下一步的查询。因此，递归查询返回的查询结果或者是所要查询的IP地址，或者是报错，表示无法查询到所需的IP地址。
    第二，本地域名服务器向根域名服务器的查询通常是采用迭代查询（iterative query）。迭代查询的特点是这样的：当根域名服务器收到本地域名服务发出的迭代查询请求报文时，要么给出所要查询的IP地址，要么告诉本地域名服务器：“你下一步应当向哪一个域名服务器进行查询”。然后让本地域名服务器进行后续的查询（而不是替本地域名服务器进行后续的查询）。根域名服务器通常是把自己知道的顶级域名服务器的IP地址告诉本地域名服务器，让本地域名服务器再向顶级域名服务器查询。顶级域名服务器在收到本都域名服务器的查询请求后，要么给出所要查询的IP地址，要么告诉本地域名服务器下一步应当向哪一个权限域名服务器进行查询。本地域名服务器就这样进行迭代查询。最后，知道了所要解析的域名的IP地址，然后把这个结果返回给发起查询的主机。当然，本地域名服务器也可以采用递归查询。这取决于最初的查询请求报文的设置是要求使用哪一种查询方式。
    图用例子说明了这两种查询的区别。
    假定域名m.xyz.com的主机想知道另一个主机（域名为y.abc.com）的IP地址。例如，主机m.xyz.com打算发送邮件给主机y.abc.com。这是就必须知道主机y.abc.com的IP地址。下面是图的几个查询步骤：
    1.主机m.xyz.com先向其本地域名服务器dns.xyz.com进行递归查询。
    2.本地域名服务器采用迭代查询。它先向一个根域名服务器查询。
    3.根域名服务器告诉本地域名服务器，下一次应查询的顶级域名服务器dns.com的IP地址。
    4.本地域名服务器向顶级域名服务器dns.com进行查询。
    5.顶级域名服务器dns.com告诉本地域名服务器，下一次应查询的权限域名服务器dns.abc.com的IP地址。
    6.本地域名服务器向权限域名服务器dns.abc.com进行查询。
    7.权限域名服务器dns.abc.com告诉本地域名服务器，所查询的主机的IP地址。
    8.本地域名服务器最后把查询结果告诉m.xyz.com。
    我们注意到，这8个步骤总共要使用8个UDP用户数据报的报文。本地域名服务器经过三次迭代查询后，从权限域名服务器dns.abc.com得到了主机y.abc.com的IP地址，最后把结果返回给发起查询的主机m.xyz.com。
    图是本地域名服务器采用递归查询的情况。在这种情况下，本地域名服务器只需向根域名服务器查询一次，后面的几次查询都是在其他几个域名服务器之间进行的（步骤3至6）。只是在步骤7，本地域名服务器从根域名服务器得到了所需的IP地址。最后在步骤8，本地域名服务器把查询结果告诉主机m.xyz.com。整个的查询也是使用8个UDP报文。
    为了提高DNS查询效率，并减轻根域名服务器的负荷和减少因特网上的DNS查询报文数量，在域名服务器中广泛地使用了高速缓存（有时也称为高速缓存域名服务器）。高速缓存用来存放最近查询过的域名以及从何处获得域名映射信息的记录。
    例如，在图的查询过程中，如果在不久前已经有用户查询过域名y.abc.com的IP地址，那么本地域名服务器就不必向根域名服务器重新查询y.abc.com的IP地址，而是直接把高速缓存中存放的上次查询结果（即y.abc.com的IP地址）告诉用户。
    假定本地域名服务器的缓存中并没有y.abc.com的IP地址，而是存放着顶级域名服务器dns.com的IP地址，那么本地域名服务器也可以不向根域名服务器进行查询，而是直接向com顶级域名服务器发送请求报文。这样不仅可以大大减轻根域名服务器的负荷，而且也能够使因特网上的DNS查询请求和回答报文的数量大为减少。
    由于名字到地址的绑定并不经常改变，为了保持高速缓存中的内容正确，域名服务器应为每项内容设置计时器并处理超过合理时间的项（例如，每个项目只存放两天）。当域名服务器已从缓存中删去某项信息后又被请求查询该项信息，就必须重新到授权管理该项的域名服务器获取绑定信息。当权限域名服务器回答一个查询请求时，在响应中都指明绑定有效存在的时间值。增加此时间值可减少网络开销，而减少此时间值可提高域名转换的准确性。
    不但在本地域名服务器中需要高速缓存，在主机中也很需要。许多主机在启动时从本地域名服务器下载名字和地址的全部数据库，维护存放自己最近使用的域名的高速缓存，并且只在从缓存中找不到名字时才使用域名服务器。维护本地域名服务器数据库的主机自然应该定期地检查域名服务器以获得新的映射信息，而且主机必须从缓存中删掉无效的项。由于域名改动并不频繁，大多数网点不需花太多精力就能维护数据库的一致性。
6.2文件传送协议
    6.2.1FTP概述
    文件传送协议FTP（File Transfer Protocol）是因特网上使用得最广泛的文件传送协议。FTP提供交互式的访问，允许客户指明文件的类型与格式（如指明是否使用ASCII码），并允许文件具有存取权限（如访问文件的用户必须经过授权，并输入有效的口令）。FTP屏蔽了各计算机系统的细节，因而适合于在异构网络中任意计算机之间传送文件。RFC 959很早就成为了因特网的正式标准。
    在因特网发展的早期阶段，用FTP传送文件约占整个因特网的通信量的三分之一，而由电子邮件和域名系统所产生的通信量还小于FTP所产生的通信量。只是到了1995年，WWW的通信量才首次超过了FTP。
    在下面6.2.2和6.2.3节分别介绍基于TCP的FTP和基于UDP的TFTP，它们都是文件共享协议中的一大类，即复制整个文件，其特点是：若要存取一个文件，就必须先获得一个本地的文件副本。如果要修改文件，只能对文件副本进行修改，然后再将修改后的文件副本传回原节点。
    文件共享协议中的另一大类是联机访问（on-line access）。联机访问意味着允许多个程序同时对一个文件进行存取。和数据库系统不同之处是用户不需要调用一个特殊的客户进程，而是由操作系统提供对远地共享文件进行访问的服务，就如同对本地文件的访问一样。。这就使用户可以用远地文件作为输入和输出来运行任何应用程序，而操作系统中的文件系统则提供对共享文件的透明存取。透明存取的优点是：将原来用于处理本地文件的应用程序用来处理远地文件时，不需要对该应用程序作明显的改动。属于稳健共享协议的有网络文件系统NFS（Network File System）。网络文件系统NFS最初是在UNIX操作系统环境下实现稳健和目录的共享。NFS可使本地计算机共享远地的资源，就像这些资源在本地一样。由于NFS原先是SUN公司在TCP/IP网络上创建的，因此目前NFS主要应用在TCP/IP网络上。然而现在NFS也可在OS/2，MS-Windows，NetWare等操作系统上运行。NFS还没有成为因特网的正式标准，现在的版本4（NFSv4）是2000年底发表的【RFC 3010】，目前还只是建议标准。限于篇幅，本书不讨论NFS的详细工作过程。
    6.2.2FTP的基本工作原理
    网络环境中的一项基本应用就是将文件从一台计算机中复制到另一台可能相距很远的计算机中。初看起来，在两个主机之间传送文件是很简单的事情。其实这往往非常困难。原因是众多的计算机厂商研制出的文件系统多达数百种，且差别很大。经常遇到的问题是：
    （1）计算机存储数据的格式不同。
    （2）文件的目录结构和文件命名的规定不同。
    （3）对于相同的文件存取功能，操作系统使用的命令不同。
    （4）访问控制方法不同。
    文件传送协议FTP只提供文件传送的一些基本的服务，它使用TCP可靠的运输服务。FTP的主要功能是减少或消除在不同操作系统下处理文件的不兼容性。
    FTP使用客户服务器方式。一个FTP服务器进程可同时为多个客户进程提供服务。FTP的服务器进程有两大部分组成：一个主进程，负责接收新的请求；另外有若干个从属进程，负责处理单个请求。
    主进程的工作步骤如下：
    （1）打开熟知端口（端口号为21），是客户进程能够连接上。
    （2）等待客户进程发出连接请求。
    （3）启动从属进程来处理客户进程发来的请求。从属进程对客户进程的请求处理完毕后即终止，但从属进程在运行期间根据需要还可能创建其他一些子进程。
    （4）回到等待状态，继续接受其他客户进程发来的请求。主进程与从属进程的处理是并发地进行。
    FTP的工作情况如图所示。图中的椭圆圈表示在系统中运行的进程。图中的服务器端有两个从属进程：控制进程和数据传送进程。为简单起见，服务器端的主进程没有画上。在客户端除了控制进程和数据传送进程外，还有一个用户界面进程用来和用户接口。
    在进行文件传输时，FTP的客户和服务器之间要建立两个并行的TCP连接：“控制连接”和“数据连接”。控制链接在整个会话期间一直保持打开，FTP客户所发出的传送请求，通过控制连接发送给服务器端的控制进程，但控制链接并不用来传送文件。实际用于传输文件的是“数据连接”。服务器端的控制进程在接收到FTP客户发送来的文件传输请求后就创建“数据传送进程”和“数据连接”，用来连接客户端和服务器端的数据传送进程。数据传送进程实际完成文件的传送，在传送完毕关闭“数据传送连接”并结束运行。由于TFP使用了一个分离的控制链接，因此FTP的控制信息使带外（out of band）传送的。
    当客户进程向服务器进程发出建立连接请求时，要寻找连接服务器进程的熟知端口（21），同时还要告诉服务器进程自己的另一个端口号码，用于建立数据传送连接。接着，服务器进程用自己传送数据的熟知端口（20）与客户进程所提供的端口号码数据传送连接。由于FTP使用了两个不同的端口号，所以数据连接与控制链接不会发生混乱。
    使用两个独立的连接的主要好处是使协议更加简单和更容易实现，同时在传输文件时还可以利用控制链接（例如，客户发送请求终止传输）。
    FTP并非对所有的数据传输都是最佳的。例如，计算机A上运行的应用程序要在远地计算机B的一个很大的文件末尾添加一行信息。若使用FTP，则应先将此文件从计算机B传送到计算机A，添加上这一行信息后，再用FTP将此文件传送到计算机B，来回传送这样打的文件很花时间。实际上这种传送是不必要的，因为计算机A并没有使用该文件的内容。
    然而网络文件系统NFS则采用另一种思路。NFS允许应用进程打来一个远地文件，并能在该文件的某一个特定的位置上开始读写数据。这样，NFS可使用户只复制一个大文件中的一个很小的片段，而不需要复制整个大文件。对于上述例子，计算机A中的NFS客户软件，将要添加的数据和文件后面写数据的请求一起发送到远地的计算机B中的NFS服务器，NFS服务器更新文件后返回应答信息。在网络上传送的只是少量的修改数据。
    6.2.3简单文件传送协议TFTP
    TCP/IP协议族中还有一个简单文件传送协议TFTP（Trivial File Transfer Protocol），它是一个很小且易于实现的文件传送协议。TFTP的版本2是因特网的正式标准。虽然TFTP也使用客户服务器方式，但它使用UDP数据报，因此TFTP需要有自己的差错改正措施。TFTP只支持文件传输而不支持交互。TFTP没有一个庞大的命令集，没有列目录的功能，也不能对用户进行身份鉴别。
    TFTP的主要优点两个。第一，TFTP可用于UDP环境。例如，当需要将程序或文件同时向许多机器下载时就往往需要使用TFTP。第二，TFTP代码占的内存较小。这对较小的计算机或某些特殊用途的设备是很重要的。这些设备不需要硬盘，只需要固化了TFTP、UDP和IP的小容量只读存储器即可。当接通电源后，设备执行只读存储器中的代码，在网络上广播一个TFTP请求。网络上的TFTP服务器就发送响应，其中包括可执行二进制程序。设备收到此文件后将其放入内存，然后开始运行程序。这种方式增加了灵活性，也减少了开销。
    TFTP的主要特点是：
    （1）每次传送的数据报文中有512字节的数据，但最后一次可不足512字节。
    （2）数据报文按序编号，从1开始。
    （3）支持ASCII码或二进制传送。
    （4）可对文件进行读或写。
    （5）使用很简单的首部。
    TFTP的工作很像停止等待协议。发送完一个文件块后就等待对方的确认，确认是应指明确认的块编号。发完数据后在规定时间内收不到确认就要重新发数据PDU。发送确认PDU的一方若在规定时间内收不到下一个文件块，也要重发确认PDU。这样就可保证文件的传送不致因某一个数据报的丢失而告失败。
    在一开始工作时。TFTP客户进程发送一个读请求报文或写请求报文给TFTP服务器进程，其熟知端口号码为69。TFTP服务器进程要选择一个新的端口和TFTP客户进程进行通信。若文件长度恰好为512字节的整数倍，则在文件传送完毕后，还必须在最后放一个只含首部而无数据的数据报文。若文件长度不是512字节的整数倍，则最后传送数据报文中数据字段一定不满512字节，这正好可作为文件结束的标志。
6.3远程终端协议TELNET
    TELNET是一个简单的远程终端协议，它也是因特网的正式标准。用户用TELNET就可在其所在地通过TCP连接注册（即登录）到远地的另一个主机上（使用主机名或IP地址）。TELNET能将用户的击键传到远方主机，同时也能将远方主机的输出通过TCP连接返回到用户屏幕。这种服务是透明的，因为用户感觉到好像键盘和显示器是直接连在远地主机上。因此TELNET又称为终端仿真协议。
    TELNET并不复杂，以前应用得很多。现在由于PC机的功能越来越强，用户已较少使用TELNET了。
    TELNET也使用客户服务器方式。在本地系统运行TELNET客户进程，而在远地主机则运行TELNET服务器进程。和FTP的情况相似，服务器中的主进程等待新的请求，并产生从属进程来处理每一个连接。
    TELNET能够适应许多计算机和操作系统的差异。例如，对于文本中一行的结束，有的系统使用ASCII码的回车（CR），有的系统使用换行（LF），还有的系统使用两个字符，回车-换行（CR-LF）。又如，在中断一个程序时，许多系统使用Control-C（^C），但有的系统使用ESC按键。为了适应这种禅意，TELNET定义了数据和命令应怎样通过因特网。这些定义就是所谓的网络虚拟终端NVT（Network Virtual Terminal）。NVT的意思。客户软件把用户的击键和命令转换成NVT格式，并送交服务器。服务器软件把收到的数据和命令，从NVT格式转换成原地系统所需的格式。向用户返回数据，服务器吧原地系统的格式转换为NVT格式，本地客户再从NVT格式转换到本地系统所需的格式。
    NVT的格式定义很简单。所有的通信都使用8位一个字节。在运转时，NVT使用7位ASCII码传送数据。而当高位置1时用作控制命令。ASCII吗共有95个可打印字符（如字母、数字、标点符号）和33个控制字符。所有可打印字符在NVT中的意义和在ASCII码中一样。但NVT只使用了ASCII码 的控制字符中的几个。此外，NVT还定义了两字符的CR-LF为标准的行结束控制符。当用户键入回车按键时，TELENT和客户就把它转换为CR-LF再进行传输，而TELNET服务器要把CR-LF转换为远地机器的行结束字符。
    TELNET的选项协商（Option Negotiation）使TELNET客户和TELNET服务器可商定使用更多的终端功能，协商的双方是平等的。
6.4万维网WWW
    6.4.1万维网概述
    万维网WWW（World WIde Web）并非某种特殊的计算机网络。万维网是一个大规模的联机式的信息储藏所，英文简称为Web。万维网用链接的方法能非常方便地从因特网上的一个斩断访问另一个站点（也就是所谓的“连接到另一个站点”），从而主动地按需获取丰富的信息。图说明了万维网提供分布式服务的特点。
    图画出了五个万维网上的站点，他们可以相隔数千公里，但都必须连接在因特网上。每一个万维网站点都存放了许多文档。在这些文档中有一些地方的文字是用特殊方式显示的（例如用不同的颜色，或廉价了下划线），而放我们将鼠标移动到这些地方时，鼠标的箭头就变成了一只手的形状。这就表明这些地方有一个链接（这种连接有时也称之为超链），如果我们在这些地方点击鼠标，就可以从这个文档链接到可能相隔很远的另一个文档。经过一定的时延（几秒钟、几分钟甚至更长，取决于所链接的文档的大小和网络的拥塞情况），在我们的屏幕上就能将远方传送古来的文档显示出来。例如，站点A的某个文件有两个地方1和2可以链接到其他的站点。当我们点击链接1时，就可连接到站点B的某个文档。若点击2则可链接到站点E。站点B的文档也有两个地方和3和4有链接。若点击链接3就可链接到站点D，而点击链接4就链接到站点E，但从E的这个文档已不能继续链接到其他任何的站点。站点D的文档中有两个地方5和6有链接，可以分别链接到A和C。
    正是由于万维网的出现，使因特网从仅由少数计算机专家使用变为普通百姓也能利用的信息资源。万维网的出现使网站数按指数规律增长。因此，万维网的出现使因特网发展中的一个非常重要的里程碑。
    万维网是欧洲粒子物理实验室的Tim Berbers-Lee最初于1989年3月提出的。1993年2月，第一个图形界面浏览器开发成功，名字叫做Mosaic。1995年著名的NetscapeNavigator浏览器上市。目前最流行的浏览器是微软公司的Internet Explorer。
    万维网是一个分布式的超媒体（hypermedia）系统，它是超文本（hypertext）系统的扩充。所谓超文本是包括指向其他文档的链接的文本。也就是说，一个超文本由多个信息源链接成，而这些信息源的数目实际上是不受限制的。利用一个链接可使用户找到另一个文档，而这些又可链接到其他的文档（以此类推）。这些文档可以位于世界上任何一个接在因特网上的超文本系统中。超文本是万维网的基础。
    超媒体与超文本的区别是文档内容不同。超文本文档仅包含文本信息，而超媒体文档还包含其他表示方式的信息，如图形、图像、声音、动画，甚至活动视频图像。
    分布式的和非分布式的超媒体系统有很大区别。在非分布式系统中，各种信息都驻留在单个计算机的磁盘中。由于各种文档都可从本地获得，因此这些文档之间的连接可进行一致性检查。所以，一个非分布式超媒体系统能够保证所有的连接都是有效的和一致的。
    万维网把大量信息分布在整个因特网上。每台主机上的文档都独立进行管理。对这些文档的增加、修改、删除或重新命名都不需要（实际上也不可能）通知到因特网上成千上万的节点。这样，万维网文档之间的连接就经常会不一致。例如，主机A上的文档X本来包含了一个指向主机B上的文档Y的连接。若主机B的管理员在某日删除了文档Y，那么主机A的上述链接显然就失效了。
    万维网以客户服务器方式工作。上面所说的浏览器就是在用户主机上的万维网客户程序。万维网文档所驻留的主机则运行服务器程序，因此这个主机也称为万维网服务器。客户程序向服务器程序发出请求，服务器程序向客户程序送回客户所要的万维网文档。在一个客户程序主窗口上显示出的万维网文档称为页面（page）。
    从以上所述可以看出，万维网必须解决以下几个问题：
    （1）怎样标志分布在整个因特网上的万维网文档。
    （2）用什么样的协议来实现万维网上各种链接？
    （3）怎样使不同作者创作的不同风格的万维网文档都能在因特网上各种主机上显示出来，同时使用户清除地知道在什么地方存在着链接？
    （4）怎样使用户能够很方便地找到所需的信息？
    为了解决第一个问题，万维网使用统一资源定位符URL（Uniform Resource Locator）来标志万维网上的各种文档，并使每一个文档在整个因特网的范围内具有唯一的标识符URL。
    为了解决上述的第二个问题，就要使万维网客户程序与万维网服务器程序之间的交互遵守严格的协议，这就是超文本传送协议HTTP（HyperText Transfer Protocol）。HTTP是一个应用层协议，它使用TCP连接进行可靠的传送。为了解决上述的第三个问题，万维网使用超文本标记语言HTML（HyperText Markup Language），使得万维网页面的设计者可以很方便地用链接从本页面的某处链接到因特网上的任何一个万维网页面，并且能够在自己的主机屏幕上讲这些页面显示出来。最后，用户可使用搜索工具在万维网上方便地查找所需的信息。
    下面我们将进一步讨论上述的这些重要概念。
    6.4.2统一资源定位符URL
    1.URL的格式
    统一资源定位符URL是用来表示从因特网上得到的资源位置和访问这些资源的方法。URL给资源的位置提供一种抽象的识别方法，并用这种方法给资源定位。只要能够对资源定位，系统就可以对资源进行各种操作，如存取、更新、替换和查找其属性。
    这里所说的“资源”是指在因特网上可以被访问的任何对象，包括文件目录、文件、文档、图像、声音等，以及与因特网相连的任何形式的数据。“资源”还包括电子邮件的地址和USENET新闻组，或USENET新闻组中的报文。
    URL相当于一个文件名在网络范围的扩展。因此，URL是与因特网相连的机器上的任何可访问对象的一个指针。由于访问不同对象所使用的协议不同，所以URL还指出读取某个对象时所使用的协议。URL的一半形式由以下四个部分组成：<协议>://<主机>:<端口>/<路径>
    URL的第一部分是最左边的<协议>。这里的<协议>就是指出使用什么协议来获取该万维网文档。现在最常用的协议就是http（超文本传送协议HTTP），其次是ftp（文件传送协议FTP）。
    在<协议>后面使规定必须协商的格式“://”，不能省略。它的右边是第二部分<主机>，它指出这个万维网文档是在哪一个主机上。这里的<主机>就是指该主机在因特网上的域名。再后面使第三和第四部分<端口>和<路径>，有时可省略。
    下面我们简单介绍使用得最多的一种URL。
    2.使用HTTP的URL
    对于万维网的网点的访问要使用HTTP协议。HTTP的URL的一般形式是：http://<主机>:<端口>/<路径>
    HTTP的默认端口是80，通常可省略。若再省略文件的<路径>项，则URL就指到因特网上的某个主页（home page）。主页是个很重要的概念，它可以是以下几种情况之一：
    （1）一个WWW服务器的最高级别的页面。
    （2）某一个组织或部门的一个定制的页面或目录。从这样的页面可链接到因特网上的与本组织或部门有关的站点。
    （3）由某一个人自己设计的描述他本人情况的WWW页面。
    例如，要查有关清华大学的信息，就可先进入清华大学的主页，其URL为：http://www.tsinghua.edu.cn
    这里省略了默认的端口号80。我们从清华大学的主页入手，就可以通过许多不同的链接找到所要查找的各种有关清华大学各个部门的信息。
    更复杂一些的路径是指向层次结构的从属页面。例如：http://www.tsinghua.edu.cn/chn/yxsz/index.htm
    是清华大学的“院系设置”页面的URL。注意，上面的URL中使用了指向文件的路径，而文件名就是最后的index.htm。后缀htm（有时可写为html）表示这是一个用超文本标记语言HTML写出的文件。
    虽然URL里面的字母不分大小写，但有的页面为了读者看起来方便，故意用了一些大写字母，实际上这对使用Windows的PC机用户是没有关系的。
    用户使用URL并非仅仅能够访问万维网的页面，而且还能够通过URL使用其他的因特网应用程序，如FTP或USENET新闻组等。更重要的是，用户在使用这些应用程序时，只使用一个程序，即浏览器。这显然是非常方便的。
    6.4.3超文本传送协议HTTP
    1.HTTP的操作过程
    HTTP协议定义了浏览器（即万维网客户进程）怎样向万维网服务器请求万维网文档，以及服务器怎样把文档传送给浏览器。从层次的角度看，HTTP是面向事务的（transaction-oriented）应用层协议，它是万维网上能够可靠地交换文件（包括文本、声音、图像等各种多媒体文件）的重要基础。
    万维网的大致工作过程。
    每个万维网网点都有一个服务器进程，它不断地监听TCP的端口80，以便发现是否有浏览器（即万维网客户。请注意，浏览器和万维网客户是同义词）向它发出连接建立请求。一旦监听到连接建立请求并建立了TCP连接之后，浏览器就向万维网服务器发出浏览某个页面的请求，服务器接着就返回请求的页面作为相应。最后，TCP连接就被释放了。在浏览器和服务器之间的请求和响应的交互，必须按照规定的格式和遵循一定的规则。这些格式和规则就是超文本传送协议HTTP。
    HTTP规定在HTTP客户与HTTP服务器之间的每次交互，都由一个ASCII码串构成的请求和一个“类MIME（MIME-like）”的响应组成。HTTP报文通常都使用GTCP连接传送。
    用户浏览页面的方法有两种。一种方法是在浏览器的地址窗口中键入所要找的页面的URL。另一种方法是在某一个页面中用鼠标点击一个可选部分，这是浏览器会自动在因特网上找到所要链接的页面。
    假定图中的用户用鼠标点击了屏幕上的一个可选部分。他使用的连接指向了“清华大学院系设置”的页面，其URL是http://www.tsinghua.edu.cn/chn/yxsz/index.htm。下面我们用HTTP/1.0更具体地说明在用户点击鼠标后所发生的几个时间：
    （1）浏览器分析链接指向页面的URL。
    （2）浏览器向DNS请求解析www.tsinghua.edu.cn的IP地址。
    （3）域名系统DNS解析出清华大学服务器的IP地址为166.111.4.100。
    （4）浏览器与服务器建立TCP连接（在服务器端IP地址是166.111.4.100，端口是80）
    （5）浏览器发出取文件命令：GET/chn/yxsz/index.htm。
    （6）服务器www.tsinghua.edu.cn给出响应，把文件index.htm发送给浏览器。
    （7）释放TCP连接。
    （8）浏览器显示“清华大学院系设置”文件index.htm中的所有文本。
    浏览器在下载文件时，可以设置为只下载其中的文本部分。这样可使下载的速度加快。在这种情况向，文件中原来嵌入图像或声音的地方只用一个小图标来显示。用户若要下载这些图像或声音，可用鼠标再分别点击这些图标。每点击一次鼠标，就重复执行一次类似于上面的8个步骤。也就是先建立TCP连接，在使用TCP连接传送命令和传送文件，最后释放TCP连接。
    HTTP使用了面向连接的TCP作为运输层协议，保证了数据的可靠传输。HTTP不必考虑数据在传输过程中被丢弃后又怎样被重传。但是HTTP协议本身是无连接的。这就是说，虽然HTTP使用了TCP连接，但通信的双方在交换HTTP报文之前不需要先建立HTTP连接。在1997年以前使用的是RFC 1945定义的HTTP/1.0协议。在1998年这个协议升级为HTTP/1.1，目前是因特网草案标准。
    HTTP协议是无状态的（stateless）。也就是说，同一个客户第二次访问同一个服务器上的页面时，服务器的响应与第一次被访问时的相同（假定现在服务器还没有把该页面更新），因为服务器并不记得曾经访问过的这个客户，也不记得为该客户曾经服务过多少次。HTTP的无状态特性简化了服务器的设计，使服务器更容易支持大量并发的HTTP请求。
    下面我们粗略估算一下，从浏览器请求一个万维网文档到收到整个文档所需的时间。用户在点击鼠标链接某个万维网文档时，HTTP协议首先要和服务器建立TCP连接。这需要使用三次握手。当三次握手的前两部分完成后（即经过了一个RTT时间后），万维网客户就把HTTP请求报文作为三次握手的第三个报文的数据发送给万维网服务器。服务器收到HTTP请求报文后，就把所有的文档作为相应报文返回给客户。
    从图可看出，请求一个万维网文档所需的时间是该文档的传输时间（与文档大小成正比）加上两倍往返时间RTT（一个RTT用于连接TCP连接，另一个RTT用于请求和接收万维网文档。这里TCP建立连接的三次握手的第三个报文段中捎带了客户对万维网文档的请求）。
    HTTP/1.0的主要缺点，就是每请求一个文档就要有两倍的RTT的开销。若一个主页上有很多链接的对象（如图片等）需要依次进行链接，那么每一次链接下载都导致2xRTT的开销。另一种开销就是万维网客户和服务器为每一次建立新的TCP连接都要分配缓存和变量。特别是万维网服务器往往要同时服务于大量客户的请求，这样会使万维网服务器的负担很重。好在浏览器都提供了能够打开5~10个并行的TCP连接，而每一个TCP连接处理客户的一个请求。因此，使用并行TCP连接可以缩短响应时间。
    HTTP/1.1协议较好地解决了这个问题，它使用了持续连接（persistent connection）。所谓持续连接就是万维网服务器在发送响应后仍然在一段时间内保持这条连接，使同一个客户（浏览器）和该服务器可以继续在这条连接上传送后续的HTTP请求报文和响应报文。这并不局限于传送同一个页面上链接的文档，而是只要这些文档都在同一个服务器上就行。目前一些流行的浏览器（例如，IE6.0）的默认设置就是使用HTTP/1.1。如果用户不愿意使用持续连接的浏览器，可以点击IE浏览器上面的“工具”，然后点击“Internet选项”，再点击“高级”，把“HTTP1.1设置”的选择取消即可。
    HTTP/1.1协议的持续连接有两种工作方式，即非流水线方式（without pipelining）和流水线方式（with pipelining）。
    非流水线方式的特点，是客户在收到前一个响应后才能发出下一个请求。因此，在TCP连接已建立后，客户每访问一次对象都要用去一个往返时间RTT。这比非持续连接的两倍RTT的开销节省了建立TCP连接所需的一个RTT时间。但非流水线方式还是有缺点的，因为服务器咋ifasongwan一个对象后，其TCP连接就处于空闲状态，浪费了服务器资源。
    流水线方式的特点，是客户在收到前一个响应后才能发出下一个请求。因此，在TCP连接已建立后，客户每访问一次对象都要用去一个往返时间RTT。这比费持续连接的两倍RTT的开销节省了建立TCP连接所需的一个RTT时间。但非流水线方式还是有缺点的，因为服务器在发送完一个对象后，其TCP连接就处于空闲状态，浪费了服务器资源。
    流水线方式的特点，是客户在收到HTTP的响应报文之前就能够接着发送新的请求报文。于是一个接一个的请求报文到达服务器后，服务器就可连续发回响应报文。因此，使用流水线方式时，客户访问所有的对象只需花费一个RTT时间。流水线工作方式使TCP连接中的空闲时间减少，提高了下载文档效率。
    2.代理服务器
    代理服务器（proxy server）是一种网络实体，它又称为万维网高速缓存（Web Cache）。代理服务器把最近的一些请求和响应暂存在本地磁盘中。当新请求到达时，若代理服务器发现这个请求与暂时存放的请求相同，就返回暂存的响应，而不需要按URL的地址再次去因特网访问该资源。代理服务器可在客户端或服务器端工作，也可在中建系统上工作。下面我们用例子说明他的作用。
    设图是校园网不使用代理服务器的情况。这是，校园网中所有的PC机都通过2Mb/s专线链路（R1-R2）与因特网上的远点服务器建立TCP连接。因而校园网各PC机访问因特网的通信量往往会使这条2Mb/s的链路过载，使得时延大大增加。
    图是校园网使用代理服务器的情况。这是，访问因特网的过程是这样的：
    （1）校园网PC机中的浏览器向因特网的服务器请求服务时，就先和校园网的代理服务器建立TCP连接，并向代理服务器发出HTTP请求报文。
    （2）若代理服务器已经存放了所请求的对象，代理服务器就把这个对象放入HTTP响应报文中返回给PC机的浏览器。
    （3）否则，代理服务器就代表发出请求的用户浏览器，与因特网上的源点服务器（origin server）建立TCP连接，并发送HTTP请求报文。
    （4）源点服务器把所请求的对象放在HTTP响应报文中返回给校园网的代理服务器。
    （5）代理服务器收到这个对象后，先复制在自己的本地存储器中（留待以后用），然后再把这个对象放在HTTP响应报文中，通过已建立的TCP连接，返回给请求该对象的浏览器。
    我们注意到，代理服务器有时是作为服务器（当接收浏览器的HTTP请求时），但有时却作为客户（当向因特网上的源点服务器发送HTTP请求时）。
    在使用代理服务器的情况下，由于有相当一大部分通信量局限在校园网的内部，因此，2Mb/s专线链路（R1-R2）上的通信量大大减少，因而减小了访问因特网的时延。
    3.HTTP的报文结构
    HTTP有两类报文：
    （1）请求报文--从客户向服务器发送请求报文。
    （2）响应报文--从服务器到客户的回答。
    由于HTTP是面向文本的（text-oriented），因此在报文中的每一个字段都是一些ASCII码串，因而各个字段的长度都是不确定的。
    HTTP请求报文的响应报文都是由三个部分组成。可以看出，这两种报文格式的区别就是开始行不同。
    （1）开始行，用于区分是请求报文还是响应报文。在请求报文中的开始行叫做请求行（Request-Line），而在响应报文中的开始行叫做状态行（Status-Line）。在开始行的三个字段之间都以空格分隔开，最后的“CR”和“LF”分贝代表“回车”和“换行”。
    （2）首部行，用来说明浏览器、服务器或报文主题的一些信息。首部可以有好几行，但也可以不使用。在每一个首部行中都有首部字段名和它的值，每一行在结束的地方都要有“回车”和“换行”。整个首部行结束时，还有一空行将首部行和后面的实体主体分开。
    （3）实体主体（entity body），在请求报文中一般都不用这个字段，而在响应报文中也可能没有这个字段。
    下面先介绍HTTP请求报文最重要的一些主要特点。
    请求报文的第一行“请求行”只有三个内容，即方法，请求资源的URL，以及HTTP的版本。
    请注意：这里的名词“方法”（method）是面向对象技术中使用的专门名词。所谓“方法”就是对所请求的对象进行的操作，这些方法实际上也就是一些命令。因此，请求报文的类型是由它所采用的方法决定的。表6-1给出了请求报文中常用的集中方法。
            |方法（操作）|意义                        |
            |OPTION     |请求一些选项的信息            |
            |GET        |请求读取由URL所标志的信息     |
            |HEAD       |请求读取由URL所标志的信息的首部|
            |POST       |给服务器添加信息（例如，注释） |
            |PUT        |在指明的URL下存储一个文档     |
            |DELETE     |删除指明的URL所标志的资源     |
            |TRACE      |用来进行环回测试的请求报文     |
            |CONNECT    |用于代理服务器                |
    对于我们在图中的例子，即要链接到“清华大学院系设置”的页面。HTTP的请求报文的开始行（即请求行）应当是（请注意在GET后面和HTTP/1.1前面的空格）：
    GET  http://www.tsinghua.edu.cn/chn/yxsz/index.htm HTTP/1.1
    下面是一个请求报文的例子：
    GET  /chn/yxsz/index.htm  HTTP/1.1  {请求行使用了相对URL}
    Host:www.tsinghua.edu.cn  {此行是首部行的开始。这行给出主机的域名}
    Connection:close  {高速服务器发送完请求的文档后就可释放连接}
    User-Agent:  Mozilla/5.0  {表明用户代理是使用Netscape浏览器}
    Accept-Language: cn  {表明用户希望优先得到中文版本的文档}
    {请求报文的最后还有一个空行}

    在请求行使用了相对URL（即省略了主机的域名）是因为下面的首部行（第2行）给出了主机的域名。第3行是告诉服务器不使用持续连接，表示浏览器希望服务器在传送完所请求的对象后即关闭TCP连接。这个请求报文没有实体主体。
    再看一下HTTP响应报文的主要特点。
    每一个请求报文发出后，都能收到一个响应报文。响应报文的第一行就是状态行。
    状态行包括三项内容，即HTTP的版本，状态吗，以及解释状态码的简单短语。
    状态码（Status-Code）都是三位数字的，分为5大类共33种。例如，
    1xx表示通知信息，如请求收到了或正在进行处理。
    2xx表示成功，如接受或知道了。
    3xx表示重定向，如要完成请求还必须采取进一步的行动。
    4xx表示客户的差错，如请求中有错误的语法或不能完成。
    5xx表示服务器的差错，如服务器失效无法完成请求。
    下面三种状态行在响应报文中是经常见到的。
    HTTP/1.1  202  Accepted  {接受}
    HTTP/1.1  400  Bad Request {错误的请求}
    HTTP/1.1  404  Not Found  {找不到}
    若请求的网页从http://www.ee.xyz.edu/index.html 转移到了一个新的地址，则响应报文的状态行和一个首部行就是下面的形式：
    HTTP/1.1  301  Moved Permanently  {永久性地转移了}
    Location:http://www.xyz.edu/ee/index.html  {新的URL}
    4.在服务器上存放用户的信息
    上面已经讲过，HTTP是无状态的。这样做虽然简化了服务器的设计，但在实际工作中，一些万维网站点却常常希望能够识别用户。例如，在网上购物时，一个顾客要购买多种物品。当他把选好的一件物品放入“购物车”后，他还要继续浏览和选购其他物品。因此，服务器需要记住应用户的身份，使他再接着选购的一些物品能够放入同一个“购物车”中，这样就便于集中结账。有时某些万维网站点也可能想限制某些用户的访问。要做到这点，可以在HTTP中使用Cookie。在RFC 2109中对Cookie进行了定义，规定万维网站点可以使用Cookie来跟踪用户。Cookie原意是“小甜饼”（广东人用方言音译为“曲奇”），目前尚无标准译名，在这里Cookie表示在HTTP服务器合客户之间传递的状态信息。现在很多网站都已广泛使用Cookie。
    Cookie是这样工作的。当用户张三浏览某个使用Cookie的网站时，该网站的服务器就为张三产生一个唯一的识别码，并以此作为索引在服务器的后端数据库中产生一个项目。接着在给张三的HTTP响应报文中添加一个叫做Set-cookie的首部行。这里的“首部字段名”就是“Set-cookie”，而后面的“值”就是赋予该用户的“识别码”。例如这个首部行是这样的：Set-cookie：12345678
    当张三收到这个响应时，其浏览器就在它管理的特定Cookie文件中添加一行，其中包括这个服务器的主机名和Set-cookie后面给出的识别码。当张三继续浏览这个网站时，每发送一个HTTP请求报文，其浏览器就会从其Cookie文件中取出这个网站的识别码，并放到HTTP请求报文的Cookie首部行中：Cookie：12345678
    于是，这个网站就能够跟踪用户12345678（张三）在该网站的活动。需要注意的是，服务器并不需要知道这个用户的姓名张三和其他的信息。但服务器能够知道用户12345678在什么时间访问了哪些页面，以及访问这些页面的顺序。如果张三是在网上购物，那么这个服务器可以为展示干维护一个所购物品的列表，使张三在结束这次购物时可以一起付费。
    如果张三在几天后再次访问这个网站，那么他的浏览器会在其HTTP请求报文中继续使用首部行Cookie：12345678，而这个网站服务器根据张三过去的访问记录可以向他推荐商品。如果张三已经在该网站登记过和使用过信用卡付费，那么这个网站就已经保存了张三的姓名、电子邮件地址、信用卡号码等信息。这样，当张三继续在该网站购物时，只要还是用同一个电脑上网，由于浏览器产生的HTTP请求报文中都携带了同样的Cookie首部行，服务器就可利用Cookie来验证这是用户张三，因此以后张三在这个网站购物时就不必重新在键盘上输入姓名、信用卡号码等信息。这样，当张三继续在该网站购物时，只要还使用同一个电脑上网，由于浏览器产生的HTTP请求报文中都携带了同样的Cookie首部行，服务器就可利用Cookie来验证这是用户张三，因此以后张三在这个网站购物时就不必重新在键盘上输入姓名、信用卡号码等等信息。这对顾客显然是很方便的。
    尽管Cookie能够简化用户网上购物的过程，但Cookie的使用一直引起很多争论。有人认为Cookie会把计算机病毒带到用户的计算机中。其实这是对Cookie的误解。Cookie只是一个小小的文本文件，不是计算机的可执行程序，因此不可能传播计算机病毒，也不可能用来获取用户计算机硬盘中的信息。对于Cookie的另一个争议，是关于用户隐私的保护问题。例如，网站服务器知道了张三的一些信息，就有可能把这些信息出卖给第三方。Cookie还可用来手机用户在万维网网站上的行为。这些都属于用户个人的隐私。有些网站为了使顾客放心，就公开声明他们会保护顾客的隐私，绝不会把顾客的识别码或个人信息出售或转移给其他厂商。
    在网上进行过浏览的用户可以在Cookie的文件夹中看到这些Cookie文件。对于使用WindowsXP的用户可在C盘的文件夹“Documents and Settings”中继续打开使用自己的“用户名”的文件夹，然后就可看到“Cookies”文件夹，里面就是存放Cookie文件的地方。用户不仅又看到Cookie识别码，而且可以看到是哪个网站发送过来的Cookie文件。
    为了让用户有拒绝接受Cookie的自由，在浏览器中用户可自行设置接受Cookie的条件。例如在浏览器IE6.0中，点击工具栏中的“工具”按钮，找到“Internet选项”，再点击“隐私”，就可以看见菜单中的左边有一个可上下滑动的标尺，它有了六个位置。最高的位置是阻止所有Cookie，而最低的位置是接受所有Cookie。中间的位置则是在不同条件下可以接受Cookie。用户可根据自己的情况对IE浏览器进行必要的设置。
    6.4.4万维网的文档
    1.超文本标记语言HTML
    要使任何一台计算机都能显示出任何一个万维网服务器上的页面，就必须解决页面制作的标准化问题。超文本标记语言HTML（HyperText Markup Language）就是一种制作万维网页面的标准语言，它消除了不同计算机之间信息交流的障碍。由于HTML非常易于掌握且实施简单，因此它很快就成为万维网的重要基础。官方的HTML标准由W3C（即WWW Consortium）负责制定。有关HTML的一些参考资料见[W-HTML]。现在最新的版本是HTML4.0。更新的版本正在研究之中。
    HTML定义了许多用于排版的命令，即“标签”（tag）。例如，<I>表示后面开始用斜体字排版，而</I>则表示斜体字排版到此结束。HTML就把各种标签嵌入到万维网的页面中，这样就构成了所谓的HTML文档。HTML文档是一种可以用任何文本编辑器（例如，Windows的记事本Notepad）创建的ASCII码文件。但应注意，仅当HTML文档是以.html或.htm为后缀时，浏览器才对这样的HTML文档的各种标签进行解释。如果HTML文档改换以.txt为其后缀，则HTML解释程序就不对标签进行解释，而浏览器只能看见原来的文本文件。
    并非所有的浏览器都支持所有的HTML标签。若某一个浏览器不支持某一个HTML标签，则浏览器将忽略此标签，但在一对不能识别的标签之间的文本仍然会被显示出来。
    下面是一个简单例子，用来说明HTML文档中标签的用法。在每一个语句后面的花括号中的字是为读者看的注释，在实际的HTML文档中并没有这种注释。
    把上面的HTML文档存入D盘的文件夹HTML，文件名是HTML-example.html（注意：没有文档中的注释部分）。当浏览器读取了该文档后，就按照HTML文档中的各种标签，根据浏览器所使用的显示器的尺寸和分辨率的大小，重新进行排版并显示出来。图表示IE浏览器在计算机屏幕上显示出的与该文档有关部分的画面。文档的标题（title）“一个HTML的例子”显示在浏览器最上面的标题栏中。文件的路径显示在地址栏中。再下面就是文档的主体部分。主体部分的题头（heading），即文档主体部分的标题“HTML很容易掌握”，用较大的字号显示出来，因为在标签中指明了使用的是1级题头<H1>。
    目前已开发出了很好的制作万维网页面的软件工具，使我们能够像使用Word字处理器那样很方便地制作各种页面。即使我们用Word字处理器编辑了一个文件，但只要在“另存为（Save As）”时选取文件后缀为.htm或.html，就可以很方便地把Word的.doc格式文件转换为浏览器可以显示的HTML格式的文档。
    HTML允许在万维网页面中掺入图像。一个页面本身带有的图像称为内涵图像（inline image）。HTML标准并没有规定该图像的格式。实际上，大多数浏览器都支持GIF和JPEG文件。很多种格式的图像占据的存储空间太大，因而这种图像在因特网传送石就很浪费时间。例如，一副位图文件（.bmp）可能要占用500~700KB的存储空间。但若将此图像该村为经压缩的.gif格式，则可能只有十几个千字节，大大减少了存储空间。
    HTML还规定了链接的设置方法。我们知道每个链接都有一个起点和终点。链接的起点说明在万维网页面中什么地方可引出一个链接。在一个页面中，链接的起点可以是一个字或几个字，或是一幅图，或是一段文字。在浏览器所显示的页面上，链接的起点是很容易识别的。对于以文字作为链接的起点时，这些文字往往用不同的颜色显示（例如，一般的文字用黑色字时，链接起点往往使用蓝色字），甚至还加上下划线（一般由浏览器来设置）。当我们将鼠标移动到一个链接的起点时，表示鼠标位置的箭头就变成了一只手。这是只要点击鼠标，这个链接就被激活。
    链接的重点可以是其他网站上的页面。这种链接方式叫做远程链接。这时必须在HTML文档中指明链接到网站的URL。有时链接可以指向本计算机中的某一个文件或本文件中的某处。这叫作本地链接。这是必须在HTML文档中指明链接的路径。
    实际上，现在这种链接方式已经不局限于用在万维网文档中。在最常用的Word字处理器的工具栏中，也设有“插入超链接”的按钮。只要点击这个按钮，就可以看到设置超链接的窗口。用户可以很方便地在自己写的Word文档中设置各种链接的起点和终点。
    2.动态万维网文档
    上面所讨论的万维网文档只是万维网文档中最基本的一种，即所谓的静态文档（static document）。静态文档是指咋iwendang创作完毕后就存放在万维网服务器中，在被用户浏览的过程中，内容不会改变。由于这种文档的内容不会改变，因此用户UID静态文档的每次读取所得到的返回结果都是相同的。
    静态文档的最大优点是简单。由于HTML是一种排版语言，因此静态文档可以由不懂程序设计的人员来创建。但静态文档的缺点是不够灵活。当信息变化时就要由文档的作者手工对文档进行修改。可见，变换频繁的文档不适于做成静态文档。
    动态文档（dynamic document）是指文档的内容是在浏览器访问万维网服务器时才由应用程序动态创建。当浏览器请求到达时，万维网服务器要运行另一个应用程序，并把控制转移到此应用程序。接着，该应用程序对浏览器发来的数据进行处理，并输出HTML格式的文档，万维网服务器应用程序的输出作为对浏览器的响应。由于对浏览器每次请求的响应都是临时生成的，因此用户通过动态文档所看到的内容是不断变化的。动态文档的主要优点是具有报告当前最新信息的能力。例如，动态文档可用来报告股市行情、天气预报或民航售票情况等内容。但动态文档的创建难度比静态文档的高，因为动态文档的开发不是直接编写文档本身，而是编写用于生成文档的应用程序，这就要求动态文档的开饭人员必须会编程，而所编写的程序还要通过大范围的测试，以保证输入的有效性。
    动态文档和静态文档之间的主要差别提现在服务器一端。这主要是文档内容的生成方法不同。而从浏览器的角度看，这两种文档并没有区别。动态文档的静态文档的内容都遵循HTML所规定的格式，浏览器仅根据在屏幕上看到的内容并无法判定服务器送来的是哪一种文档，只有文档的开发者才知道。
    从以上所述可以看出，要实现动态文档就必须在以下两个方面对万维网服务器的功能进行扩充：
    （1）应增加另一个应用程序，用来处理浏览器发来的数据，并创建动态文档。
    （2）应增加一个机制，用来使万维网服务器将浏览器发来的数据传送给这个应用程序，然后万维网服务器能够解释这个应用程序的输出，并向浏览器返回HTML文档。
    图是扩充了功能的万维网服务器的示意图。这里增加了一个机制，叫做通用网关接口CGI（Common Gateway Interface）。CGI是一种标准，它定义了动态文档应如何创建，输入数据应如何提供给应用程序，以及输出结果应如何使用。
    在万维网服务器中新增加的应用程序叫做CGI程序。取这个名字的原因是：万维网服务器与CGI的通信是遵循这CGI标准。“通用”是因为这个标准所定义的规则对其他任何语言都是通用的。“网关”二字的出现是因为CGI程序还可能要访问其他的服务器资源，如数据库或图形软件包，因而CGI程序的作用有点像一个网关。也有人将CGI程序简称为网关程序。“接口”是因为又一些已定义好的变量和调用等可供其他CGI程序使用。请读者注意：在看到CGI这个名词时，应弄清是指CGI标准，还是指CGI程序。
    CGI程序的正式名字是CGI脚本（script）。按照计算机科学的一般概念，“脚本”指的是一个程序，它被另一个程序（解释程序）而不是计算机的处理机来解释或执行。有一些语言专门作为脚本语言（script language），如Perl，REXX（在IBM主机上使用），JavaScript以及Tcl/Tk等。脚本也可用一些常用的编程语言写出，如C，C++等。使用脚本语言可更容易地和更快地进行编码，这对一些有限功能的小程序是很合适的。但一个脚本运行起来比一般的编译程序要慢，因为它的每一条指令先要被另一个程序来处理（这就要一些附加的指令），而不是直接被指令处理器来处理。脚本不一定是一个独立的程序，它可以是一个动态装入的库，甚至是服务器的一个子程序。
    CGI程序又称为cgi-bin脚本，这是因为在许多万维网服务器上，为便于找到CGI程序，就将CGI程序放在/cgi-bin的目录下。
    3.活动万维网文档
    随着HTTP和万维网浏览器的发展，上一节所述的动态文档已明显地不能满足发展的需要。这是因为，动态文档一旦建立，它所包含的信息内容也就固定下来而无法及时刷新屏幕。另外，像动画之类的显示效果，动态文档也无法提供。
    有两种技术可用于浏览器屏幕显示的连续更新。一种技术称为服务器推送（server push），这种技术是将所有的工作都交给服务器。服务器不断地运行与动态文档相关联的应用程序，定期更新信息，并发送更新过的文档。
    尽管从用户角度看，这样做可达到连续更新的目的，但这又很大的缺点。
    首先，为了满足很多客户的请求，服务器就要运行很多的服务器推送程序。这将造成过多的服务器开销。其次，服务器推送技术要求服务器为每一个浏览器客户维持一个不释放的TCP连接。随着TCP连接的数目增加，每一个连接所能分配到的网络带宽就下降，这就导致网络传输时延的增大。
    另一种提供屏幕连续更新的技术是活动文档（active document）技术。这种技术是把所有的工作都转移给浏览器端。每当浏览器请求一个活动文档时，服务器就返回一段活动文档程序副本，是该程序副本在浏览器端运行。这时，活动文档的内容就可与用户直接交互，并可连续地改变屏幕的显示。只要用户运行活动文档程序，活动文档的内容就可以连续地改变。由于活动文档技术不需要服务器的连续更新传送，对网络带宽的要求也不会太高。
    从传送得角度看，浏览器和服务器都把活动文档看成是静态文档。在服务器上的活动文档的内容是不变的，这点和动态文档是不同的。浏览器可在本地缓存一份活动文档的副本。活动文档还可处理成压缩形式，便于存储和传送。另一点要注意的是，活动文档本身并不包括其运行所需的全部软件，大部分的支持软件是事先存放在浏览器中。图说明了活动文档的创建过程。
    有美国Sun公司开发的Java语言是一项用于创建和运行活动文档的技术。在Java技术中使用了一个新的名词“小应用程序”（applet）来描述活动文档程序。当用户从万维网服务器下载一个嵌入了Java小应用程序的HTML文档后，用户可在浏览器的显示屏幕上点击某个图像，然后就可看到动画的效果，或是在某个下拉式菜单中点击某个项目，然后就可看到根据用户键入的数据所得到额计算结果。实际上，Java技术是活动文档技术的一部分。
    Java技术共有三个主要组成部分：
    （1）程序设计语言。Java包含一个新的程序设计语言，它即可用来编写传统的计算机程序，也可用来编写Java小应用程序。
    （2）运行（runtime）环境。Java系统还定义了一个运行Java程序所必须的运行环境，其中包括一个Java虚拟机（简称为JVM），该软件定义了Java二进制代码的执行模型。
    （3）类库（class library）。为了更容易编写Java小应用程序，Java提供了强大的类库支持。
    Java是一种面向对象的高级语言，编程方便直观。Java是从C++派生出来的，它省略了C++很多复杂的、很少用的语言特点。但Java和C或C++并不兼容。Java的每一个数据项都有一个确定的类型。对数据的操作严格按照该数据的类型来进行。
    Java的编译程序将源程序转换成Java字节码（bytecode），这是一种与机器无关的二进制代码。计算机程序调用解释程序（interpreter）读取字节码，并解释执行。
    Java语言、字节码以及Java运行系统都被设计成与计算机硬件无关。一旦形成了字节码，就可在任何计算机上运行，并产生相同的输出。为什么要使Java小应用程序与具体的机器无关呢？这是因为，首先，在因特网上用户使用的计算机种类繁多，Java小应用程序与机器无关可使在任何计算机上运行的浏览器程序能够下载并运行活动文档，Java小应用程序与机器无关可使在任何计算机上运行的浏览器程序能够下载并运行活动文档。其次，这样做可保证活动文档在所有的浏览器上产生同样的正确输出。第三，可大大地降低活动文档的创建和测试费用，因为不必为每一种计算机都制作一个副本。
    Java运行环境包括一些设置，可允许小应用程序操纵用户的显示，而Java类库则包含提供高级图形接口的软件。这些合在一起，就称为抽象窗口工具箱AWT（Abstract Window Toolkit）执行。为什么需要这样的一个AWT呢？有这样另个原因。首先，使用小应用程序主要是为了复杂的显示，只要静态显示不能满足要求是就要使用小应用程序。其次，一个控制图形显示的程序还必须指明许多的细节。例如，若要显示一个图形，程序就必须决定：是将此图形显示在已有的窗口内，还是另外创建一个新的窗口。若创建新的窗口，那么程序就要指明窗口的题头、大小、颜色、窗口所放的位置，以及是否需要滚动条等。
    由于Java小应用程序可能需要和静态文档进行交互，在AWT中还包括常规的万威望浏览器操作的类。例如，给定一个URL，一个小应用程序能够使用AWT的类来读取和显示一个HTML文档，读取和显示一个图像，以及读取和播放一个声音片段。
    最早的浏览器只有一个HTML解释程序，用来显示静态或动态文档。但运行Java的浏览器则需要两个解释程序，即HTML解释程序和Java小应用程序解释程序。
    解释程序是一个复杂的程序，其核心是一个模仿计算机的简单循环。解释程序维持一个指令指针，在初始化时在小应用程序的开始处。在每一个循环操作时，解释程序在指令指针指向的地址读取字节码，然后解释程序对字节码进行解码，并完成指明的操作。
    解释程序除了
