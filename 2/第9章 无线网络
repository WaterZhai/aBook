第9章   无线网络

近十年来，无线蜂窝电话通信技术得到了飞速发展。无论在世界范围还是在我国范围的统计结果都是一样的：仅仅发展了十几年的移动电话数已经超过了发展历史达一百多年的固定电话数。据信息产业部的统计，截止到2007年第一季度，我国的移动电话总数已超过4.8亿部，比固定电话总数3.7亿部还要多近三成。这种情况说明了目前人们普遍对移动通信有比较迫切的需求。
对移动通信的这种需求也必然反映到计算机网络中。人们也希望能够在移动中使用计算机网络。随着便携机和个人数字助理PDA（Personal Digital Assistant）的普遍使用，无线计算机网络也逐渐流行起来了。
本章主要讨论的是无线局域网WLAN，重点是无线局域网MAC层协议CSMA/CA的原理。对无线个人区域网WPAN和无线城域网WMAN也要进行简单的介绍。这些网路标准的指定组织是IEEE的802委员会和欧洲电信标准协会ETSI（European Telecommunications Standards Institute）。这些计算机网络的发展情况值得我们关注。

9.1无线局域网WLAN
    无线局域网提供了移动接入的功能，这就给许多需要发送数据但又不能坐在办公室的工作人员提供了方便。当一个工厂跨越的面积很大时，若要把各个部门都用电缆连接成网，其费用可能很高。但若使用无线局域网，不仅节省了投资，而且建网的速度也会较快。另外，当大量持有便携式电脑的用户都在同一个地方同时要求上网时（如在图书馆中或在证券公司的大厅里），若用电缆连网，那么布线就是个很大的问题。这是若采用无线局域网则比较容易。无线局域网常简写为WLAN（Wireless Local Area Network）。
    9.1.1无线局域网的组成可分为两大类。第一类是固定基础设施的，第二类是无固定基础设施的。所谓“固定基础设施”是指预先建立起来的、能够覆盖一定地理范围的一批固定基站。大家经常使用的蜂窝移动电话就是利用电信公司预先建立的、覆盖全国的大量固定基站来接通用户手机拨打电话。
    1.IEEE 802.11
    对于第一类有固定基础设施的无线局域网，1997年IEEE制定出无线局域网的协议标准802.11列标准。2003年5月，我国颁布了WLAN的国家标准，该标准采用ISO/IEC8802-11系列国际标准，并针对WLAN的安全问题，把国家对密码算法和无线电频率的要求纳入了进来。它是基于国际标准之上的符合我国安全规范的WLAN标准，是属于国家强制执行的标准。该国标在2004年6月已经正式执行，不符合此标准的WLAN产品将不允许出现在国内市场上。有关无线局域网的IEEE标准都可从因特网下载。
    802.11是个相当复杂的标准。但简单地说，802.11是无线以太网的标准，它使用星星拓扑，其中心叫做接入点AP（Access Point），在MAC层使用CSMA/CA协议（在后面的9.1.3节讨论）。凡使用802.11系列协议的局域网又称为Wi-Fi（Wireless-Fidelity，意思是“无线保真度”）。因此，在许多文献中，Wi-Fi几乎成为了无线局域网WLAN的同义词。
    802.11标准规定无线局域网的最小构件是基本服务集BSS（Basic Service Set）。一个基本服务集BSS包括一个基站和若干个移动站，所有的站在本BSS比内都可以直接通信，但在和本BSS以外的站通信时都必须通过本BSS的基站。在802.11的术语中，上面提到的接入点AP就是基本服务集内的基站（base station）。当网络管理员安装AP时，必须为该AP分配一个不超过32字节的服务集标识符SSID（Service SetIDentifier）和一个信道。一个基本服务及BSS一样。分配系统可以使用以太网（这是最常用的）、点对点链路或其他无线网络。扩展服务集ESS还可为无线用户提供到802.x局域网（也就是非802.11无心局域网）的接入。这种接入是通过叫做Portal（门户）的设备来实现的。Portal是802。11定义的新名词，其实它的作用就相当于一个网桥。在一个扩展服务集内的不同的基本服务集也可能有相交的部分。在图中的移动站A如果要和另一个基本服务集中的移动站B通信，就必须经过两个接入点AP1和AP2，即A->AP1->AP2->B。我们应当注意到，从AP1到AP2的同系你是使用有线传输的。
    图还画出了移动站A从一个基本服务及漫游到另一个基本服务集，而仍然可保持与另一个移动站B的通信，但A在不同的基本服务集所使用的接入点AP改变了。基本服务集的服务范围是由移动站所发射的电磁波的辐射范围确定的，在图中用一个椭圆来表示基本服务集的服务范围，当然实际上的服务范围可能是很不规则的几何形状。
    802.11标准并没有定义如何实现漫游，但定义了一些基本的工具。例如，一个移动站若要加入到一个基本的服务集BSS，就必须先选择一个接入点AP，并与此接入点建立关联（association）。建立关联就表示这个移动站加入了选定的AP所属的子网，并和这个接入点AP之间创建了一个虚拟线路。只有关联的AP才向这个移动站发送数据帧。而这个移动站也只有通过关联的AP才能向其他站点发送数据帧。这和手机开机后必须和某个基站建立关联的概念是相似的。
    此后，这个移动站就和选定的AP互相使用802.11关联协议进行对话。移动站点还要向该AP鉴别自身。在关联阶段过后，移动站点要通过关联的AP向该子网发送DHCP发现报文以获取IP地址。这时，因特网中的其他部分就把这个移动站当做该AP子网中的一台主机。
    若移动站使用重建关联（reassociation）服务，就可把这种关联转移到另一个接入点。当使用分离（dissociation）服务时，就可终止这种关联。
    移动站与接入点建立关联的方法有两种。一种是被动扫描，即移动站等待接收接入站周期性发出的（例如每秒10次或100次）信标帧（beacon frame）。信标帧中包含有若干系统参数（如服务集标识符SSID以及支持的速率等）。另一种是主动扫描，即移动站主动发出探测请求帧（probe request frame），然后等待从接入点发回的探测响应帧（probe response frame）。
    现在许多地方，如办公室、机场、快餐店、旅馆、购物中心等都能够向公众提供有偿或无偿接入Wi-Fi的服务。这样的地点就叫做热点（hot spot）。有许多热点和接入点AP连接起来的区域叫做热区（hot zone）。热点也就是公众无线入网点。由于无线信道的使用日益增多，因此现在也出现了无线因特网服务提供者WISP（Wireless Internet Service Provider）这一名词。用户可以通过无线信道接入到WISP，然后再经过无线信道接入到因特网。
    2.移动自组网络
    另一类无线局域网是无固定基础设施的无线局域网，它又叫做自组网络（ad hoc network）。这种自组网络没有上述基本服务集中的接入点AP而是由一些处于平等状态的移动站之间相互通信组成的临时网络。图中还画出了当移动站A和E通信时，是经过A->B，B->C，C->D，和最后D->E这样一连串的存储转发过程。因此在从源结点A到目的结点E的路径中的移动站B，C和D都是转发结点，这些结点都具有路由器的功能。由于自组网络没有预先建好的网络固定基础设施（基站），因此自组网络的服务范围通常是受限的，而且自组网络一般也不和外界的其他网络相连接。移动自组网络也就是移动分组无线网络。
    自组网络通常是这样构成的：一些可移动的设备发现在它们附近还有其他的可移动设备，并且要求和其他移动设备进行通信。随着便携式电脑的大量普及，自组网络的组网方式已受到人们的广泛关注。由于咋izizuwnagluo中的每一个移动站都要参与到网络中的其他移动站的路由的发下内核维护，同时由移动站构成的网络拓扑有可能随时间变化得很快，因此在固定网络中行之有效的一些路由选择协议对移动自组网络已不适用。这样，在自组网络中路由选择协议就引起了特别的关注。另一个重要问题是多播。在移动自组网络中往往需要将某个总要信息同时向多个移动站传送。这中多播比固定结点网络的多播要复杂得多，需要有实时性好而效率又高的多播协议。在移动自组网络中，安全问题也是一个更为突出的问题。在IETF下面设有一个专门研究移动自组网络的工作组MANET（Mobile Ad-hoc NETworks），读者可在MANET网站查阅到有关移动自组网络的技术资料。
    移动自组网络在军用和民用领域都有很好的应用前景。在军事领域中，由于战场上往往没有预先建好的固定接入点，其移动站就可以利用临时建立的移动自组网络进行通信。这种组网方式也能够应用到作战的地面车辆群和坦克群，以及海上的舰艇群。空中的机群。由于每一个移动设备都具有路由器转发分组的功能，因此分布式的移动自组网络的生存性非常好。在民用领域，持有笔记本电脑的人可以利用这种移动自组网络方便地交换信息，而不受便携式电脑附近没有电话线插头的限制。当出现自然灾害时，在抢险救灾时利用移动自组网络进行及时的通信往往也是很有效的，因为这时事先已建好的固定网络基础设施（基站）可能已经都被破坏了。
    近年来，移动自组网络中的一个子集--无线传感器网络WSN（Wireless Sensor Network）引起了人们广泛的关注。无线传感器网络是由大量传感器结点通过无线通信技术构成的自组网络。无线传感器网络的应用就是进行各种数据的采集、处理和传输，一般并不需要很高的带宽，但是在大部分时间必须保持低功耗，以节省电池的消耗。由于无线传感结点的存储容量受限，因此对协议栈的大小有严格的限制。此外，无线传感器网络还对网络安全性、结点自动配置、网络动态重组等方面有一定的要求。
    据统计，全球98%的处理器并不在传统的计算机中，而是处在各种家电设备、运输工具以及工厂的机器中。如果在这些设备上能够嵌入合适的传感器和无线通信功能，就可能把数量极大的结点连接成分布式的传感器无线网络，因而能够实现连网计算和处理。
    图给出了一种传感器结点的形状，图是典型的传感器结点的组成，它的主要构件包括CPU、存储器、传感器硬件、无线收发器和电池。
    无线传感器网络中的结点基本上是固定不变的，这点和移动自组网络有很大的区别。无线传感器网络主要的应用领域是：
    （1）环境监测与保护（如洪水预报、动物栖息的监控）；
    （2）战争中对敌情的侦查和对兵力、装备、物资等的监控；
    （3）医疗中对病房的监测和对患者的护理；
    （4）在危险的工业环境（如矿井、核电站等）中的安全监测；
    （5）城市交通管理、建筑内的温度/照明/安全控制等。
    关于无线传感器网络更详细的内容可参阅。
    顺便指出，移动自组网络和移动IP并不相同。移动IP技术使漫游的主机可以用多种方式连接到因特网。漫游的主机可以直接连接到或通过无线链路连接到固定网络上的另一个子网。支持这种形式的主机移动性需要地址管理和增加协议的互操作性，但移动IP的核心网络功能仍然是基于在固定互联网中一直在使用的各种路由选择协议。但移动自组网络是把移动性扩展到无线领域中的自治系统，它具有自己特定的路由选择协议，并且可以不和因特网相连。即使在和因特网相连时，移动自组网络也是以残桩网络（stub network）方式工作的。所谓“残桩网络”就是通信量可以进入残桩网络，也可以从残桩网络发出，但不允许外部的通信量穿过残桩网络。
    最后需要弄清在文献中经常要遇到的、与接入有关的几个名词。
    固定接入（fixed access）--在作为网络用户期间，用户设置的地理位置保持不变。
    移动接入（mobility access）--用户设备能够以车辆速度（一般取为每小时120公里）移动时进行网络通信。当发生切换（即用户移动到不同蜂窝小区）时，通信仍然是连续的。
    便携接入（portable access）--受限的网络覆盖面积中，用户设备能够在以步行速度移动时进行网络通信，提供有限的切换能力。
    游牧接入（nomadic access）--用户设备的地理位置至少在进行网络通信时保持不变。如果用户设备移动了位置（改变了蜂窝小区），那么再次进行通信时可能还要寻找最佳的基站。
    也有的文献把便携接入和游牧接入当做一样的，定义为可以在通信时以步行速度移动。这点在阅读文献时应加以注意。
    9.1.2  802.11局域网的物理层
    802.11标准中物理层相当复杂。限于篇幅，这里对无线局域网的物理层不能展开讨论。根据物理层的不同（如工作频段、数据率、调制方法等），802.11无线局域网可再细分为不同的类型。现在最流行的无线局域网是802.11b，而另外两种（802.11a和802.11g）的产品也广泛存在。表是这三种无线局域网的简单比较。在今后的几年内可能还会有一些更高速率的无线局域网在市场上流行。
    无线局域网最初还使用过跳频扩频FHSS（Frequency Hopping Spread Spectrum）和红外技术IR（InfraRed），但现在已经很少使用了。
    以上三种标准都使用共同的媒体接入控制协议，都可以用于有固定基础设施的或无固定基础设施的无线局域网。
        |标准   |频段   |数据速率    |物理层 |优缺点                                                                         |
        |802.11b|2.4GHz|最高为11Mb/s|HR-DSSS|最高数据率较低，价格最低，信号传播距离最远，且不易受阻碍                           |
        |802.11a|5GHz  |最高为54Mb/s|OFDM   |最高数据率较高，支持更多用户同时上网，价格最高，信号传播距离较短，且易受阻碍         |
        |802.11g|2.4GHz|最高为54Mb/s|OFDM   |最高数据率较高，支持更多用户同时上网，信号传播距离最远，且不易受阻碍，价格比802.11b贵|
    对于最常用的802.11b无线局域网，所工作的2.4~2.485GHz频路范围中有85MHz的带宽可用。802.11b定义了11个部分重叠的信道集。但仅当两个信道由四个或更多信道隔开时它们才无重叠。因此信道1，6和11的集合是唯一的三个非重叠信道的集合。因此在同一个位置上可以设置三个AP，并分别给它们分配信道1，6，和11，然后用一个交换机把这三个AP连接起来。这样就可以构成一个最大传输速率为33Mb/s的无线局域网。
    除IEEE的802.11委员会外，欧洲电信标准协会ETSI的RES10工作组也为欧洲制定无线局域网的标准，他们把这种局域网取名为HiperLAN。ETSI和IEEE的标准是可以互操作的。
    下面我们讨论802.11标准的MAC层。
    9.1.3  802.11局域网的MAC层协议
    1.CSMA/CA协议
    CSMA/CD协议已成功地应用于使用有线连接的局域网，但在无线局域网的环境下，却不能简单地搬用CSMA/CD协议，特别是碰撞检测部分。这里主要有两个原因：
    第一，在无线局域网的适配器上，接收信号的强度往往会远小于发送信号的强度，因此若要实现碰撞检测，那么在硬件上需要的花费就会过大。
    第二，在无线局域网中，并非所有的站点都能够听见对方，而“所有站点都能够听见对方”正是实现CSMA/CD协议必须具备的基础。
    下面用图的例子来说明这点。我们知道，虽然无线电波能够向所有方向传播，但其传播距离受限，而且当电磁波在传播的过程中遇到障碍物时，其传播距离就更短。图中画有四个无线移动站，并假定无线电信号传播的范围是以发送站为圆心的一个圆形面积。
    图表示站点A和C都想和B通信。但A和C相距较远，彼此都听不见对方。当A和C检测到信道空闲时，就都向B发送数据，结果发生了碰撞。这种未能检测出信道上其他站点信号的问题叫做隐蔽站问题（hidden station problem）。
    当移动站之间有障碍物时也有可能出现上述问题。例如，三个站点A，B和C彼此距离都差不多，相当于在一个等边三角形的三个顶点。但A和C之间有一座山，因此A和C彼此都听不见对方。若A和C同时向B发送数据就会发生碰撞，使B无法正常接收。
    图给出了另一种情况。站点B向A发送数据。而C又想和D通信。但C检测到信道忙，于是就停止向D发送数据，其实B向A发送数据并不影响C向D发送数据（如果这时不是B向A发送数据而是A向B发送数据，则当C向D发送数据时就会干扰B接收A发来的数据）。这就是暴露站问题（exposed station problem）。在无线局域网中，在不发生干扰的情况下，可允许同时多个移动站进行通信。这点与有线局域网有很大的差别。
    由此可见，无线局域网可能出现检测错误的情况：检测到信道空闲，其实并不空闲；而检测到信道忙，其实并不忙。
    我们知道，CSMA/CD有两个要点。一是发送前先检测信道。信道空闲就立即发送，信道忙就随机推迟发送。二是边发送边检测信道，一发现碰撞就立即停止发送。因此偶尔发生的碰撞并不会使局域网的运行效率降低很多。既然无线局域网不能使用碰撞检测，那么就应当尽量减少碰撞的发生。为此，802.11委员会对CSMA/CD协议进行了修改，把碰撞检测改为碰撞避免CA（Collision Avoidance）。这样，802.11局域网就使用CSMA/CA协议。碰撞避免的思路是：协议的设计要尽量减少碰撞发生的概率。请注意，在无线局域网中，即使在发送过程中发生了碰撞，也要把整个帧发送完毕。因此在无线局域网中一旦出现碰撞，在这个帧的发送时间内信道资源都被浪费了。
    802.11局域网在使用CSMA/CA的同时还使用停止等待协议。这是因为无线信道的通信质量远不如有线信道的，因此无线站点每通过无线局域网发送完一帧后，要等到收到对方的确认帧后才能继续发送下一帧。这叫作链路层确认。
    我们在讨论CSMA/CA协议之前先要介绍802.11的MAC层。
    802.11标准设计了独特的MAC层。它通过协调功能（Coordination Function）来确定在基本服务集BSS中的移动站在什么时间能发送数据或接收数据。802.11的MAC层在物理层的上面，它包括两各子层。
    （1）分布协调功能DCF（Distributed Coordination Function）。DCF不采用任何中心控制，而是在每一个结点使用CSMA机制的分布式接入算法，让各个站通过争用信道来获取发送权。因此DCF向上提供争用服务。802.11协议规定，所有的实现都必须有DCF功能。
    （2）点协调功能PCF（Point Coordination Function）。PCF是选项，是用接入点AP集中控制整个BSS内的活动，因此自组网络就没有PCF子层。PCF使用集中控制的接入算法，用类似于探询的方法把发送数据权轮流交给各个站，从而避免了碰撞的产生。对于时间敏感的业务，如分组话音，就应使用提供无争用服务的点协调功能PCF。
    为了尽量避免碰撞，802.11规定，所有的站在完成发送后，必须再等待一段很短的时间（继续监听）才能发送下一帧。这段时间的通称是帧间间隔IFS（InterFrame Sopace）。帧间间隔的长短取决于该站要发送的帧的类型。高优先级帧需要等待的时间较短，因此可优先获得发送权，但低优先级桢就必须等待较长的时间。若低优先级帧还没来得及发送而其他站的高优先级帧已发送到媒体，则媒体变为忙态因而低优先级桢就只能再推迟发送了。这样就减少了发生碰撞的机会。至于各种帧间间隔的具体长度，则取决于所使用的物理层特性。下面解释常用的三种帧间间隔的作用。
    （1）SIFS，即短（Short）帧间间隔。SIFS是最短的帧间间隔，用来分隔开属于一次对话的各帧。在这段时间内，一个站应当能够从发送方式切换到接收方式。使用SIFS的帧类型有：ACK帧、CTS帧（在后面第2小节中讲）、由过长的MAC帧分片后的数据帧，以及所有回答AP探询的帧和在PCF方式中接入点AP发送出的任何帧。
    （2）PIFS，即点协调功能帧间间隔（比SIFS长），是为了在开始使用PCF方式时（在PCF方式下使用，没有争用）优先获得接入到媒体中。PIFS的长度是SIFS加一个时隙时间（slot time）长度。时隙的长度是这样确定的：在一个基本服务集BSS内，当某个站在一个时隙开始时接入到信道时，那么在下一个时隙开始时，其他站就都能检测出信道已转变为忙态。
    （3）DIFS，即分布协调功能帧间间隔（最长的IFS），在DCF方式中用来发送数据帧和管理帧。DIFS的长度比PIFS再多一个时隙长度。
    为了尽量减少碰撞的机会，802.11标准采用了一种叫做虚拟载波监听（Virtual Carrier Sense）的机制，这就是让源站把它要占用信道的时间（包括目的站发回确认帧所需的时间）写入到所发送的数据帧中（即在首部中的“持续时间”字段中写入需要占用信道的时间，以微秒为单位，一直到目的站把确认帧发送完为止），以便使其他所有站在这一段时间都不要发送数据。“虚拟载波监听”的意思是其他各站并没有监听信道，而是由于这些站知道了源站正在占用信道才不发送数据。这种效果好像是其他站都监听了信道。
    当站点检测到正在信道中传送的帧中的“持续时间”字段时，就调整自己的网络分配向量NAV（Network Allocation Vector）。NAV指出了信道处于忙状态的持续时间。信道处于忙状态就表示：或者是由于物理层的载波监听检测到信道忙，或者是由于MAC层的虚拟载波监听机制指出了信道忙。
    CSMA/CA协议的工作原理比较复杂，我们先讨论比较简单的情况。
    当某个站点由数据帧要发送时：
    （1）先检测信道（进行载波监听）。若检测到信道空闲，则在等待一段时间DIFS后（如果这段时间内信道一直是空闲的）就发送整个数据帧，并等待确认。为什么信道空闲还要再等待呢？就是考虑可能有其他站点有高优先级的帧眼发送。如有，就让高优先级帧先发送。
    （2）目的站若正确收到此帧，则经过时间间隔SIFS后，向源站发送确认帧ACK。
    （3）所有其他站都设置网络分配向量NAV，表明在这段时间内信道忙，不能发送数据。
    （4）当确认帧ACK结束时，NAV（信道忙）也就结束了。在经历了帧间间隔之后，接着会出现一段空闲时间，叫做争用窗口，表示在这段时间内有可能出现各站点争用信道的情况。
    争用信道的情况比较复杂，因为有关站点要执行退避算法。我们用图的例子来说明。
    图表示当A正在发送数据时，B，C和D都有数据要发送。由于它们都检测到信道忙，因此都要执行退避算法，各自随机退避一段时间再发送数据。802.11标准规定，退避时间必须是整数倍的时隙时间。
    802.11使用的退避算法和以太网的稍有不同。第i次退避是在时隙{0，1，…，2^(2+i)-1}中随机地选择一个。这样做是为了使不同站点选择相同退避时间的概率减少。这就是说，第1次退避（i=1）要推迟发送的时间是在时隙{0，1，…，7}中（共8个时隙）随机选择一个，而第2次退避是在时隙{0，1，…，15}中（共16个时隙）随机选择一个。当时隙编号达到255时（这对应于第6次退避）就不再增加了。
    退避时间选定后，就相当于设置了一个退避计时器（backoff timer）。站点每经历一个时隙的时间就检测一次信道。这可能发生两种情况。若检测到信道空闲，退避计时器就继续倒计时。若检测到信道忙，就冻结退避计时器的剩余时间，重新等待信道变为空闲并再经过时间DIFS后，从剩余时间开始继续倒计时。如果退避计时器的时间减小到零时，就开始发送整个数据帧。
    从图可以看出，C的退避计时器最先减到零，于是C立即把整个数据帧发送出去。请注意，A发送完数据后信道就变为空闲。C的退避计时器一直在倒计时。当C在发送数据的过程中，B和D检测到信道忙，就冻结各自的退避计时器的数值，重新期待信道变为空闲。正在这时E也想发送数据。由于E检测到信道忙，因此E就执行退避算法和设置退避计时器。
    当C发送完数据并经过了时间DIFS后，B和D的退避计时器又各自的剩余时间开始倒计时。现在争用信道的除B和D外，还有E。D的退避计时器最先减到零，于是D得到了发送权。在D发送数据时，B和E都冻结其退避计时器。
    以后R的退避计时器比B先减少到零。当E发送数据时，B再次冻结其退避计时器。等到E发送完数据并经过时间DIFS后，B的退避计时器才继续工作，一直到把最后剩余的时间用完，然后就发送数据。
    冻结退避计时器剩余时间的做法是为了使协议对所有站点更加公平。
    根据以上讨论的情况，可把CSMA/CA算法归纳如下：
    （1）若站点最初有数据要发送（而不是发送不成功再进行重传），且检测到信道空闲，在等待时间DIFS后，就发送整个数据帧。
    （2）否则，站点执行CSMA/CA协议的退避算法。一旦检测到信道忙，就冻结退避计时器。只要信道空闲，退避计时器就进行倒计时。
    （3）当退避计时器时间减少到零时（这是信道只可能是空闲的），站点就发送整个的帧并等待确认。
    （4）发送站若收到确认，就知道已发送的帧被目的站正确收到了。这时如果要发送第二帧，就要从上面的步骤（2）开始，执行CSMA/CA协议的退避算法，随机选定一段退避时间。
    若源站在规定时间内没有收到确认帧ACK（由重传计时器控制这段时间），就必须重传此帧（再次使用CSMA/CA协议争用接入信道），直到收到确认为止，或者经过若干次的重传失败后放弃发送。
    应当指出，当一个站要发送数据帧时，仅在下面的情况下才不使用退避算法：检测到信道时空闲的，并且这个数据帧时它想发送的第一个数据帧。
    除此以外的所有情况，都必须使用退避算法。具体来说，一下集中情况都必须使用退避算法：
    （1）在发送第一个帧之前检测到信道处于忙态。
    （2）每一次的重传。
    （3）每一次的成功发送后再发送下一帧。
    2.对信道心境预约
    为了更好地解决隐蔽站带来的碰撞问题，802.11允许要发送数据的站对信道进行预约。具体的做法是这样的：如图所示，源站A在发送数据帧之前先发送一个短的控制帧，叫做请求发送RTS（Request to Send），它包括源地址、目的地址和这次通信（包括相应的确认帧）所需的持续时间。若信道空闲，则目的站B就相应一个控制帧，叫做允许发送CTS（Clear To Send），如图所示，它也包括这次通信所需的持续时间（从RTS帧中把这个持续时间复制到CTS帧中）。A收到CTS帧后就可发送其数据帧。下面讨论在A和B两个站附近的一些站将做出的反应。
    C处于A的传输范围内，但不在B的传输范围内。因此C能够收到A发送的RTS，但经过一小段时间后，C不会收到B发送的CTS帧。这样，在A向B发送数据时，C也可以发送自己的数据给其他的站而不会干扰B。请读者注意，C收不到B的信号表明B也收不到C的信号。
    再观察D。D收不到A发送的RTD帧，但能收到B发送的CTS帧。因此D知道B将要和A通信，因此D在A和B通信的一段时间内不能发送数据，因而不会干扰B接收A发来的数据。
    至于站E，它能收到RTS和CTS，因此E和D一样，在A发送数据帧和B发送确认帧的整个过程中都不能发送数据。
    可见这种协议实际上就是在发送数据帧之前先对信道进行预约一段时间。
    使用RTS和CTS帧会使整个网络的效率有所下降。但这两种控制帧都很短，其长度分别为20字节和14字节，与数据帧（最长可达2345字节）相比开销不算大。相反，若不使用这种控制帧，则一旦发生碰撞而导致数据帧重发，则浪费的时间就更多。虽然如此，但协议还是设有三种情况共用户选择：一种是使用RTS和CTS帧；另一种是只有当数据帧的长度超过某一数值时才使用RTS和CTS帧（显然，当数据帧本身就很短时，再使用RTS和CTS帧只能增加开销）；还有一种是不使用RTS和CTS帧。
    虽然协议经过了精心设计，但碰撞仍然会发生。例如，B和C同时向A发送RTS帧。这两个RTS帧发生碰撞后，使得A收不到正确的RTS帧，因而A就不会发送后续的CTS帧。这是，B和C像以太网发生碰撞那样，各自随机地推迟一段时间后重新发送其RTS帧。推迟时间额算法也是使用二进制指数退避。
    图给出了RTS和CTS帧以及数据帧和ACK帧的插损胡时间关系。源站在发送数据之前要检测信道。如信道忙，则按照前面的退避算法推迟发送。如空间，则等待时间DIFS后发出RTS帧。如收到CTS帧，则在再等待时间SIFS后开始发送数据。在除源站和目的站以外的其他站中，有的在收到RTS帧后就设置其网络分配向量NAV，有的则在收到CTS帧或数据帧后才设置其NAV。因此图中画出了几种不同的NAV的设置。
    9.1.4  802.11局域网的MAC帧
    为了更好地了解802.11局域网的工作原理，我们应当进一步了解802.11局域网的MAC帧的结构。802.11帧共有三种类型，即控制帧、数据帧和管理帧。通过下面图所介绍的802.11局域网数据帧的主要字段，可以进一步了解802.11局域网的MAC帧的特点。
    从图可以看出，802.11数据帧由以下三大部分组成：
    （1）MAC首部，共30字节。帧的复杂性都在帧的首部。
    （2）帧主题，也就是帧的数据部分，不超过2312字节。这个数值以以太网的最大长度长很多。不过802.11帧的长度通常都是小于1500字节。
    （3）帧检验序列FCS是尾部，共4字节。
    1.关于802.11数据帧的地址
    802.11数据帧最特殊的地方就是有四个地址字段。地址4用于自组网络。我们在这里只讨论前三种地址。这三个地址的内容取决于帧控制字段中的“到DS”（到分配系统）和“从DS”（从分配系统）这两个子字段的数值。这两个子字段各占1位，合起来共有4中组合，用于定义802.11帧中的几个地址字段的含义。
    表给出的是802.11帧的地址字段最常用的两种情况（都只使用前三种地址，而不使用地址4）。
        |到DS|从DS|地址1   |地址2 |地址3   |地址4|
        |0   |1   |目的地址|AP地址|源地址  |--   |
        |1   |0   |AP地址  |源地址|目的地址|--   |
    现结合图的例子进行说明。站点A向B发送数据帧，但这个过程要分两步走。首先要由站点A把数据帧发送到接入点AP1，然后再由AP1把数据帧发送给站点B。
    当站点A把数据帧发送给AP1时，帧控制字段中的“到DS=1”而“从DS=0”。因此地址1是AP1的MAC地址（接收地址），地址2是A的MAC地址（源地址），地址3是B的MAC地址（目的地址）。请注意，“接收地址”与“目的地址”并不等同。
    当AP1把数据帧发送给站点B时，帧控制字段中的“到DS=0”而“从DS=1”。因此地址1是B的MAC地址（目的地址），地址2是AP1的MAC地址（发送地址），地址3是A的MAC地址（源地址）。请注意，上述的“发送地址”与“源地址”也不相同。
    2.序号控制字段、持续期字段和帧控制字段
    下面有选择地介绍802.11数据帧中的其他一些字段。
    （1）序号控制字段占16位，其中序号子字段占12位（从0开始，每发送一个新帧就加1，到4095后再回到0），分片子字段占4位（不分片则保持为0。如分片则帧的序号子字段保持不变，而分片子字段从0开始，每个分片加1，最多到15）。重传的帧的序号和分片子字段的值都不变。序号控制的作用是使接收方能够区分开是新传送的帧还是因出现差错而重传的帧。这和运输层讨论的序号的概念是相似的。
    （2）持续其字段占16位。在9.1.3节中已经讲过CSMA/CA协议允许传输站点预约信道一段时间（包括传送数据帧和确认帧的时间）。这个时间就是写入到持续期字段中。由于这个字段有多种用途（这里不对这些用途进行详细的说明），因此最高位为0时才表示持续期。这样，持续期不能超过2^15-1=32767，单位是微妙。
    （3）帧控制字段共分为11个子字段。下面介绍其中较为重要的几个。
    协议版本字段现在是0。
    类型字段和子类型字段用来区分帧的功能。802.11帧共有三种类型：控制帧、数据帧和管理帧，而每一种帧又分为若干种子类型。例如，控制帧有RTS，CTS和ACK等几种不同的控制帧。控制帧和管理帧都有其特定的帧格式，这里从略。
    更多分片字段置为1时表明这个帧属于一个帧的多个分片之一。我们知道，无线信道的通信质量是较差的。因此无心局域网的数据帧不宜太长。当帧长为n而误比特率p=10^(-4)时，正确收到这个帧的概率p=（1-p）^n。若n=12144bit（相当于1518字节长的以太网帧），则算出这时p=0.2969，即正确收到这样的帧的概率还不到30%。因此为了提高传输效率，在信道质量较差时，需要把一个较长的帧划分为许多较短的分片。这时可以在一词使用RTS和CTS帧预约信道后连续发送这些分片。当然这仍然要使用停止等待协议，即发送一个分片，等到收到确认后再发送下一个分片，不过后面的分片都不需要用RTS和CTS帧从新预约信道。
    有线等效保密字段WEP（Wired Equivalent privacy）占1位。若WEP=1，就表明采用了WEP加密算法。WEP表明使用在无线信道的这种加密算法在效果上可以和有线信道上通信一样地保密。WEP加密算法相当复杂，限于篇幅，这里从略。
9.2无线个人区域网WPAN
    无线个人区域网WPAN（Wireless personal Area NetWork）就是在个人工作地方把属于个人使用的电子设备（如便携式电脑、掌上电脑、便携式打印机以及蜂窝电话等）用无线技术连接起来自组网络，不需要使用接入点AP，整个网络的范围大约在10m左右。WPAN可以是一个人使用，可可以是若干人共同使用（例如，一个外科手术小组的几位医生把几米范围内使用的一些电子设备组成一个无线个人区域网）。这些电子设备可以很方便地进行通信，就像用普通电缆一样。请注意，无线个人区域网WPAN和个人区域网PAN（Personality Area Network）并不完全等同，因为PAN不一定都是使用无线连接。
    WPAN和WLAN并不一样。WPAN是一个人为中心来使用的无线个人区域网，它实际上就是一个地公路、小范围、低速率和低价格的电缆替代技术。但WLAN却是同时为许多用户服务的无线局域网，它是一个大功率、中等范围、高速率的局域网。
    WPAN的IEEE标准都由IEEE的802.15工作组制定，这个标准也是包括MAC层和物理层这两层的标准。WPAN都工作在2.4GHz的ISM频段。欧洲的ETSI标准则把无线个人区域网取名为HiperPAN。
    1.蓝牙系统
    最早使用的WPAN是1994年爱立信公司推出的蓝牙（Bluetooth）系统，其标准是IEEE 802.15.1。蓝牙的数据率为720kb/s，通信范围在10米左右。蓝牙使用TDM方式和扩频跳频FHSS技术组成不用基站的皮可网（piconet）。Piconet直译就是“微微网”，因为前缀pico-本来是微微（10^(-12)）的意思，表示这种无线网络的覆盖面积非常小。每一个皮可网有一个主设备（Master）和最多7个工作的从设备（Slave）。通过共享主设备或从设备，可以把多个皮可网链接起来，形成一个范围更大的扩散网（scatternet）。这种主从工作方式的个人区域网实现起来价格就会比较便宜。
    图给出了蓝牙系统中的皮可网和扩散网的概念。图中标有M和S的小圆圈分别表示主设备和从设备，而标有P的小圆圈表示不工作的搁置的（Parked）设备。一个皮可网最多可以有255个搁置的设备。
    为了适应不同用户的需求，WPAN还定义了另外两种低速WPAN和高速WPAN。
    2.低速WPAN
    低速WPAN主要用于工业监控组网、办公自动化与控制等领域，其速率是2~250kb/s。低速WPAN的标准是IEEE 802.15.4。最近新修订的标准是IEEE802.15.4-2006。在低速WPAN中最重要的就是ZigBee。ZigBee名字来源于蜂群使用的赖以生存和发展的通信方式。密封通过跳Z形（即ZigZig）的舞蹈，来通知其伙伴所发现的新食物源的位置、距离和方向等信息，因此就把ZigBee作为新一代无线通信技术的名称。ZigBee技术主要用于各种电子设备（固定的、便携的或移动的）之间的无线通信，其主要特点是通信距离短（10~80m），传输数据速率低，并且成本低廉。
    ZigBee的另一个特点是功耗非常低。在工作时，信号的收发时间很短；而在非工作时，ZigBee结点处于休眠状态（处于这种状态的时间一般都远远大于工作时间）。这就使得ZigBee结点非常省电，其结点的电池工作时间可以长达6个月到2年左右。对于某些工作时间和总时间（工作时间+休眠时间）之比小于1%的情况，电池的寿命甚至可以超过10年。
    ZigBee网络容量大。一个ZigBee的网络最多包括255个结点，其中一个是主设备（Master），其余则是从设备（Slave）。若是通过网络协调器（Network Coordinator），整个网络最多可以支持超过64000个结点。
    ZigBee标准是在IEEE 802.15.4标准基础上发展而来的。因此，所有ZigBee产品也是802.15.4产品。虽然人们常常把ZigBee和802.15.4作为同义词，但它们之间是有区别的。图是ZigBee的协议栈。可以看出，IEEE 802.15.4只是定义了ZigBee协议栈的最低的两层（物理层和MAC层），而上面的两层（网络层和应用层）则是由ZigBee联盟定义的。在一些文献中可以见到“ZigBee/802.15.4”的写法，这就表示ZigBee标准是由两个不同的组织制定的。
    IEEE 802.15.4的物理层定义了表所示的三个频段（都是免费开放的）。
        |频段          |数据率 |信道数|
        |2.4GHz（全球）|250kb/s|16    |
        |915MHz（美国）|40kb/s |10    |
        |868MHz（欧洲）|20kb/s |1     |
    在MAC层，主要沿用802.11无线局域网的CSMA/CA协议。这就是在传输之前，会先检查信道是否空闲，若信道空闲，则开始进行数据传输，若产生碰撞，则推后一段时间重传。
    在网络层，ZigBee可采用星型和网状拓扑，或两者的组合。一个ZigBee网络最多可以有255个结点。ZigBee的结点按功能的强弱可划分为两大类，即全功能设备FFD（Full-Function Device）和精简功能设备RFD（Reduced-Function Device）。RFD结点是ZigBee网络中数量最多的端设备，它的电路简单，存储容量较小，因而成本较低。FFD结点具备控制器（Controller）的功能，能够提供数据交换，是ZigBee网络中的路由器。RFD结点只能与处在该星型网的中心的FFD结点交换数据。在一个ZigBee网络中有一个FFD充当该网络的协调器（coordinator）。协调器负责维护整个ZigBee网络的结点信息，同时还可以与其他ZigBee网络的协调器交换数据。通过各网络协调器的互相通信，可以得到覆盖更大范围、超过65000个结点的ZigBee网络。
    3.高速WPAN
    高速WPAN的标准是IEEE802.15.3，是专为在便携式多媒体装置之间传送数据而制定的。这个标准支持11~55Mb/s的数据率。这在个人使用的数据设备日益增多的情况下特别方柏霓。例如，使用告诉WPAN可以不用连接线就能把PC机和在同一间屋子里的打印机、扫描仪、外接硬盘，以及各种消费电子设备连接起来。别人使用数码摄像机拍摄的视频节目，可以不用连接线就能复制到你的数据摄像机的磁带上。在会议厅中的便携式电脑可以不用连接线就能通过投影机把制作好的幻灯片投影到大屏幕上。IEEE 802.15.3a工作组还提出了更高数据率的物理层标准的超高速WPAN。这种网络使用超宽带UWB（Ultra-Wide Band）技术。根据地章所介绍的香农公式，我们知道信道的极限传输速率与信道的带宽成正比。超宽带技术工作在3.1~10.6GHz微波频段就是为了得到非常高的信道带宽。现在的超宽带信号的带宽，应超过信号中心频率的25%以上，或者信号的绝对带宽超过500MHz。超宽带技术使用了瞬间高速脉冲，因此信号的频带就很宽，就是指可支持100~400Mb/s的数据率，可用于小范围内高速传送图像或DVD质量的多媒体视频文件。
9.3无线城域网WMAN
    下面要介绍的是无线城域网WMAN（Wireless Metropolitan Area Network）。
    我们已经有了多种有线宽带接入因特网的网络（如xDLC，HFC或FTTx等）。然而人们发现，在许多情况下，使用无线宽带接入可以带来很多好处，如更加经济和安装便捷，同时也可以得到更高的数据率。
    早期出现的本地多点分配系统LMDS（Local Multipoint Distribution System）就是一种宽带无线城域网接入技术。许多国家把27.5GHz~29.5GHz定位LMDS频段。然而由于缺乏统一的技术标准，LMDS一直未能普及起来。
    后来IEEE 成立了802.16委员会，专门制定无线城域网的标准。2002年4月通过了802.16无线城域网的标准（又称为IEEE无线城域网空中接口标准）。欧洲的ETSI也制定类似的无线城域网标准Hip而MAN。于是近几年来无线城域网WMAN又成为无线网络中的一个热点。WMAN可提供“最后一英里”的宽带无线接入（固定的、移动的和便携的）。在许多情况下，无线城域网可用来代替现有的有线宽带接入，因此它有时又称为无线本地环路（wireless local loop）。
    2001年4月WIMAX论坛成立了。WIMAX是Worldwide Interoperability for Microwave Access的缩写（意思是“全球微波接入的互操作性”，AX表示Access）。现在已有超过150家著名IT行业的厂商参加了这个论坛。Intel公司是WiMAX的积极倡导者。为了推动无线城域网的使用，WiMAX论坛给通过WiMAX的兼容性和互操作性测试的宽带无线接入设备颁发“WiMAX论坛证书”。在许多文献中，我们可以见到WiMAX常用来表示无线城域网，这与Wi-Fi常用来表示无线局域网WLAN相似。但应分清：IEEE的802.16工作组是无线城域网标准的制定者，而WiMAX论坛则是802.16技术的推动者。
    现在无线城域网共有两个正式标准。一个是2004年6月通过了802.16的修订版本，即802.16d（它的正式名字是802.16-2004），是固定宽带无线接入空中接口标准（2~66GHz频段）。另一个是2005年12月通过的802.16的增强版本，即802.16e，是支持移动性的宽带无线接入空中接口标准（2~6GHz），它向下兼容802.16-2004。图是表示802.16无线城域网服务范围的示意图。
    另外，802.16可覆盖一个城市的部分区域，通信的距离变化很大（远的可达50公里），因此接收到的信号功率和信噪比等也会有很大的差别。这就要求有多种的调制方法。因此工作在毫米波段的802.16必须有不同额物理层。802.16的基站可能需要多个定向天线，各指向对应的接收点。由于天气条件（雨、雪、雹、雾等）对毫米微波传输的影响较大因此与室内工作的无线局域网相比时，802.16对差错的处理也更为重要。
    图的横坐标是网络的覆盖范围，纵坐标是用户数据率。图中画出了本章所介绍的几种无线网络的大致位置。图中还给出了第二代（2G）移动蜂窝电话通信（就是现在最流行的手机通信），以及第三代（3G）或第四代（4G）移动通信的大致位置作为参考。
    第一代（1G）和第二代(2G)移动蜂窝电话通信和本书讲述的计算机网络并没有什么关联，因为它们都是使用传统的电路交换通信方式。在话音编码方面，1G是模拟编码，而2G则采用了更先进的数字编码。第三代（3G）移动通信和计算机网络就离得更近了，因为它使用IP的体系结构和混合的交换机制（电路交换和分组交换），能够提供多媒体业务（话音、数据、视频等），可以收发电子邮件，浏览网页，进行视频会议等。未来的第四代（4G）移动通信的标准尚未出台，但它在各方面提供的服务都将优于3G的水平。人们预计4G可提供更高带宽的、端到端的IP流媒体服务（采用分组交换），以及随时随地的移动接入。有人认为，4G有些像Wi-Fi和WiMAX的组合。有人把4G称为MAGIC（Mobile multimedia，Anytime/any-where，Global mobility support，Integrated wireless and Customized personal service），意思是移动多媒体，任何时间/地点、支持全球移动性、综合无线和定制的个人服务。我们在学习计算机网络的同时，也应适当关注一下移动通信的进展。


习题
9-01    无线局域网都由哪几部分组成？无线局域网中的固定基础设施对网络的性能有何影响？接入点AP是否就是无线局域网中的固定基础设施？
9-02    Wi-Fi与无线局域网WLAN是否为同义词？请简单说明一下。
9-03    服务集标识符SSID与基本服务集标识符BSSID有什么区别？
9-04    在无线局域网中的关联（association）的作用是什么？
9-05    以下几种接入（固定接入、移动接入、便携接入和游牧接入）的主要特点是什么？
9-06    无线局域网的物理层主要有哪几种？
9-07    无线局域网的MAC协议有哪些特点？为什么在无线局域网中不能使用CSMA/CD协议而必须使用CSMA/CA协议？
9-08    为什么无线局域网的站点在发送数据帧时，即使检测到信道空闲也仍然要等待一小段时间？为什么在发送数据帧的过程中不像以太网那样继续对信道进行检测？
9-09    结合隐蔽站问题和暴露站问题说明RTS帧和CTS帧的作用。RTS/CTS是强制使用还是选择使用？请说明理由。
9-10    为什么在无线局域网上发送数据帧后要对方必须发回确认帧，而以太网就不需要对方发回确认帧？
9-11    无线局域网的MAC协议中的SIFS，PIFS和DIFS的作用是什么？
9-12    试解释无线局域网中的名词：BSS，ESS，AP，BSA，DCF，PCF和NAV。
9-13    冻结退避计时器剩余时间的做法是为了使协议对所有站点更加公平。请进一步解释。
9-14    为什么某站点在发送第一帧之前，若检测到信道空闲就可在等待时间DIFS后立即发送出去，但在收到对第一帧的确认后并打算发送下一帧时，就必须执行退避算法？
9-15    无线局域网的MAC帧为什么要使用四个地址字段？请用简单的例子说明地址3的作用。
9-16    试比较IEEE 802.3和IEEE 802.11局域网，找出它们之间的主要区别。
9-17    无线个人区域网WPAN的主要特点是什么？现在已经有了什么标注？
9-18    无线城域网WMAN的主要特点是什么？现在已经有了什么标准？
