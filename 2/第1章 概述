第1章  概述

1.1 计算机网络在信息时代中的作用

    21世纪的一些重要特征就是数字化、网络化和信息化，它是一个以网络为核心的信息时代。

    这里所说的网络是指“三网”，即电信网络、有线电视网络和计算机网络。

    自从上个世纪90年代以后，以因特网为代表的计算机网络得到了飞速的发展，已从最初的教育科研网络逐步发展成为商业网络，并已成为仅次于全球电话网的世纪第二大网络。···  ··· 可以毫不夸大的说，因特网是人类自印刷术发明以来在通信方面最大的变革。现在人们的生活、工作、学习和交往都已离不开因特网。

    计算机网络向用户提供的最重要的功能有两个，即：1.连通性  2.共享

1.2因特网概述
    1.2.1  网络的网络

        网络（network）  由若干结点（node）和连接这些结点的链路（link）组成。
            网络中的结点可以是计算机、集线器、交换机或路由器等。
        网络和网络还可以通过路由器互连起来，这样就构成了一个覆盖范围更大的网络，即互联网。因此，互联网是网络的网络（network of networks）
            网络把许多计算机连接在一起，而因特网则把许多网络连接在一起。
    1.2.2  因特网发展的三个阶段
        因特网的基础结构大体上经历了三个阶段的演进。但这三个阶段在时间划分上并非截然分开而是有部分重叠的，这是因为网络的演进是逐渐的而不是在某个日期突然发生了变化。

        第一个阶段是从单个网络ARPANET向互联网发展的过程。1969年美国国防部创建的第一个分组交换网ARPANET最初只是一个单个的分组交换网。所有要连接在ARPANET上的主机都直接与就近的结点交换机相连。但到了70年代中期，人们已认识到不可能仅适用一个单独的网络来满足所有的通信问题。于是，ARPA开始研究多种网络（如分组无线电网络）互连的技术，这就导致后来的互联网的出现。这样的互连网就成为现在因特网的雏形。1983年TCP/IP协议成为ARPANET上的标准协议，使得所有使用TCP/IP协议的计算机都能利用互联网通信，因而人们就把1983年作为因特网的诞生时间。1990年ARPANET正式宣布关闭，因为它的试验任务已经完成。
        （两个名词：internet和Internet）
            internet是一个通用名词，泛指由多个计算机网络互连而成的网络。在这些网络协议之间的通信协议可以是任意的。
            Internet是一个专用名词，它指当前全球最大的、开放的、由众多网络相互连接而成的特定计算机网络，它采用TCP/IP协议族作为通信的规则，且前身是美国的ARPANET。

        第二阶段的特点是建成了三级结构的因特网。从1985年起，美国国家科学基金会NSF（NationalScienceFoundation）就围着六个大型计算机中心建设计算机网络，即国家科学基金网NSFNET。它是一个三级计算机网络，分为主干网、地区网和校园网（或企业网）。这种三级计算机网络覆盖了全美国主要的大学和研究所，并且成为因特网中的主要组成部分。1991年，NSF和美国的其他政府机构开始认识到，因特网必将扩大其适用范围，不应仅限于大学和研究机构。世界上的许多公司纷纷接入因特网，使网络上的通信量急剧增大，使因特网的容量已满足不了需要。于是美国政府决定将因特网的主干网转交给私人公司来经营，并开始对接入因特网的单位收费。1992年因特网上的主机超过100万台。1993年因特网主干网的速率提高到45Mb/s（T3速率）。

        第三阶段的特点是逐渐形成了多层次ISP结构的因特网。从1993年开始，由美国政府资助的NSFNET逐渐被若干个商用的因特网主干网替代，而政府机构不再负责因特网的运营。这样就出现了一个新的名词：因特网服务提供者ISP（InternetServiceProvider）。在许多情况下，因特网服务提供者ISP就是一个进行商业活动的公司，因此ISP又常译为因特网服务提供商。ISP拥有从因特网管理机构申请到的多个IP地址（因特网上的主机必须有IP地址才能进行通信），同时拥有通信线路（大的ISP自己建造通信线路，小的ISP向电信公司租用通信线路）以及路由器等联网设备，因此任何机构和个人只要向ISP缴纳规定的费用，就可以从ISP得到所需的IP地址，并通过该ISP接入到因特网。
            三层ISP结构
            最高级别的第一层ISP的服务面积最大，并且还拥有告诉主干网。
            第二层ISP和一些大公司都是第一层ISP的用户。
            第三层ISP又称为本地ISP，它们是第二层ISP的用户，且只拥有本地范围的网络。一般的校园网或企业网以及拨号上网的用户，都是第三层ISP的用户。
            为了使用不同层次ISP经营的网络都能够互通，在1994年开始创建了四个网络接入点NAP（NetworkAccessPoint），分别由四个电信公司经营。网络接入点NAP用来交换因特网上流量。在NAP中安装有性能很好的交换设施（如ATM交换技术）。
            NAP算是最高等级的接入点。它主要向各ISP提供交换设施，使它们能够互相通信。NAP又称对等点（peering point），表示接入到NAP的设备不存在从属关系都是平等的。有些大的ISP绕过NAP直接与另一ISP通信，更快捷。

        一旦某个用户能够接入到因特网，那么他就能够成为一个ISP，他需要做的就是购买一些如调制解调器或路由器这样的设备，让其他用户能够和他相连接。

        因特网已经成为世界上规模最大的增长速率最快的计算机网络，没有人能够准确说出因特网究竟有多大。因特网的迅猛发展始于20世纪90年代。由欧洲原子和研究组织CERN开发的万维网WWW（WorldWideWeb）被广泛使用在因特网上，大大方便了广大非网络专业人员对网络的使用，成为因特网的这种指数级增长的主要驱动力。万维网的站点数目也急剧增长。

        1996年美国的一些研究机构和34所大学提出研制和建造新一代因特网的设想，并宣布在今后5年内用5亿美元的联邦资金实施“下一代因特网计划”，即“NGI计划”（NextGenerationInternetInitative）
            NGI计划要实现的主要目标是：
                1.开发下一代网络结构，以比现有的因特网高100倍的速率连接至少100个研究机构，以比现有的因特网高1000倍的速率连接10个类似的网点。其端到端的传输速率要超过100Mb/s至10Gb/s。
                2.使用更加先进的网络服务技术和开发许多带有革命性的应用，如远程医疗、远程教育、有关能源和地球系统的研究、高性能的全球通信、环境监测和预报、紧急情况处理等。
                3.使用超高速全光网络，能实现更快速的交换和路由选择，同时具有一些实时（realtime）应用保留带宽的能力
                4.对整个因特网的管理和保证信息的可靠性及安全性方面进行较大的改进。
      1.2.3  因特网的标准化工作
          1992年由于因特网不再归美国政府管辖，成立了一个国际性组织叫做因特网协会（InternetSociety，ISOC），以便对因特网进行全面管理以及在世界范围内促进发展和使用。ISOC下面有一个技术组织叫做因特网体系结构委员会IAB（InternetArchitectureBoard），负责管理因特网有关协议的开发。
              IAB下面由设有两个工程部：
                  1.因特网工程部IETF（InternetEngineeringTaskForce）
                      IETF是由许多工作组WG（WorkingGroup）组成的论坛（forum），具体工作由因特网工程指导小组IESG（InternetEngineeringSteeringGroup）管理。这些工作组划分为若干个领域（area），每个领域集中研究某一特定的短期和中期工程问题，主要是针对协议的开发和标准化。
                  2.因特网研究部IRTF（InternetResearchTaskForce）
                      IRTF是由一些研究组RG（ResearchGroup）组成的论坛，具体工作由因特网研究指导小组IRSG（InternetResearchSteeringGroup）管理。IRTF的任务是进行理论方面研究和开发一些需要长期考虑的问题。
          所有的因特网标准都是以RFC的形式在因特网上发表。RFC（RequestForComments）的意思就是“请求评论”。所有的RFC文档都可以从因特网上免费下载。但是，并非所有的RFC文档都是因特网标准，只有一小部分才变成标准。
              制定因特网的正式标准要经过以下的四个阶段：
                  1.因特网草案（InternetDraft），还不是RFC文档。
                  2.建议标准（ProposedStandard），开始成为RFC文档
                  3.草案标准（DraftStandard）
                  4.因特网标准（InternetStandard）
              除了以上三种RFC外还有三种，即历史的、实验的和提供信息的。
1.3  因特网的组成
    从工作方式上看，可以划分为两大块：
        1.边缘部分
            由所有连接在因特网上的主机组成。这部分是用户直接使用的，用来进行通信和资源共享。
        2.核心部分
            由大量网络和连接这些网络的路由器组成。这部分是为边缘部分提供服务的。

    1.3.1因特网的边缘部分
        处于因特网边缘的部分就是连接在因特网上的所有主机。这些主机又称为端系统（endsystem）。
        我们说，主机A和主机B进行通信，实际是指，运行在主机A上的某个程序和运行在主机B上的另一个程序进行通信，也是指，主机A的某个进程和主机B上的另一个进程进行通信。

        在网络边缘的端系统中运行的程序之间的通信方式通常可划分为两大类：
            客户服务器方式（C/S方式）和对等方式（P2P方式）

            1.客户服务器方式
                这种方式在因特网上是最常用的，也是传统的方式。我们在上网发送电子邮件或在网站上查找资料时，都是使用客户服务器方式。
                客户是服务请求方，服务器是服务提供方。
                客户程序：
                    被用户调用后运行，在通信时主动向远程服务器发起通信。因此，客户程序必须知道服务器的地址。
                    不需要特殊的硬件和很复杂的操作系统
                服务器程序：
                    是一种专门用来提供某种服务的程序，可同时处理多个远程或本地客户的请求。
                    系统启动后即自动调用并一直不断地运行着，被动地等待并接受来自各地的客户的通信请求。因此，服务器程序不需要知道客户程序的地址。
                    一般需要强大的硬件和高级的操作系统支持。
                客户与服务器的通信关系建立后，通信可以是双向的，客户和服务器都可发送和接收数据。
            2.对等连接方式
                对等连接（peer-to-peer，简写为P2P）是指两个主机在通信是并不区分哪一个是服务请求方还是服务提供方。只要两个主机都运行了对等连接软件（P2P软件），它们就可以进行平等的、对等连接通信。这时，双方都可以下载对方已经存储在硬盘中的共享文档。因此这种工作方式也称为P2P文件共享。
                实际上，对等连接方式从本质上看仍然是使用客服服务器方式，只是对等连接中的每一个主机既是客户又同时是服务器。

    1.3.2因特网的核心部分
        网络核心部分是因特网中最复杂的部分，因为网络中的核心部分要向网络边缘中的大量主机提供连通性，是边缘部分中的任何一个主机都能够向其他主机通信。
            路由器，是一种专用计算机（不是主机），是实现分组交换的关键构建，其任务是转发收到的分组，这是网络核心部分最重要的功能。   为了弄清分组交换，我们要先介绍电路交换的基本概念，在此基础上再讨论分组交换的特点。
        1.电路交换的主要特点
            在电话问世后不久，人们发现，要让所有的电话机都两两相连是不现实的。
            若N部电话要两两相连，就需要N（N-1）/2对电线。当电话机的数量很大时，这种连接方法需要的电线数量就太大了（与电话机的数量的平方成正比）。
            于是，要使每一部电话能够很方便的和另一部电话进行通信，就应当使用电话交换机将这些电话连接起来。

            交换（switching）就是按照某种方式动态地分配传输线路的资源。
            在使用电路交换打电话之前，必须先拨号建立连接。当拨号的信令通过许多交换机到达被叫用户所连接的交换机时，该交换机就向被叫用户的电话机振铃。在被叫用户摘机且摘机信令传送回到主叫用户所连接的交换机后，呼叫即完成。这时，从主叫端到被叫端就建立了一条连接（物理通路）。这条连接占用了双方通话时所需的通信资源，而这些资源在双方通信时不会被其他用户占用，此后主叫和被叫双方才能互相通电话。正是因为有了这个特点，电路交换对端到端的通信质量有可靠的保证。通话完毕挂机后，挂机信令告诉这些交换机，使交换机释放刚才使用的这条物理通路（即归还刚才占用的所有通信资源）。
            这种必须经过“建立连接（占用通信资源）--->通话（一直占用通信资源）--->释放连接（归还通信资源）”三个步骤的交换方式称为电路交换。

            电路交换的重要特点是，在通话的全部时间内，通话的两个用户始终占用端到端的通信资源。

            当使用电路交换来传送计算机数据时，其线路的传输效率往往很低。这是因为计算机的数据是突发式地出现在传输线路上，因此线路上真正用来传送数据的时间往往不到10%甚至1%。实际上，已被用户占用的通讯线路在绝大部分时间都是空闲的。例如，当用户阅读终端屏幕上的信息或用键盘输入和编辑一份文件时，或计算机正在处理而结果尚未返回时，宝贵的通信线路资源并未被利用而是白白被浪费了。
        2.分组交换的主要特点
            分组交换则采用存储转发技术。
            把一个报文划分为几个分组。通常我们把要发送的整块数据称为一个报文（message）。
            在发送报文之前，先把较长的报文划分成为一个个更小的等长数据段。
            例如，每个数据段为1024bit，在每一个数据段前面，加上一些必要的控制信息组成的首部（header）后，就构成了一个分组（packet）。分组又称为“包”，而分组的首部也可称为“包头”。分组是在因特网中传送数据的数据单元。分组中的“首部”是非常重要的，正是由于分组的首部包含了诸如目的地址和源地址等重要控制信息，每一个分组才能在因特网中独立地选择传输路径。
            （注：在因特网核心部分的路由器之间一般用高速链路相连接，而在网络边缘的主机接入到核心部分则通常以相对较低速率的链路相连接）

            主机和路由器都是计算机，但它们的作用很不一样。主机是为用户进行信息处理的，并且可以和其他主机通过网络交换信息。路由器则是用来转发分组的，即进行分组交换的。

            路由器收到一个分组，先暂时存储下来，再检查其首部，查找转发表，按照首部中的目的地址，找到合适的接口转发出去，把分组交给下一个路由器。这样一步一步地以存储转发的方式，吧分组交付到最终的目的主机。各路由器之间必须经常交换彼此掌握的路由信息，以便创建和维持在路由器中的转发表，使得转发表能够在整个网络拓扑发生变化时及时更新。

            当我们讨论因特网的核心部分中的路由器转发分组的过程时，往往把单个的网络简化为一条链路，而路由器成为核心部分的结点。
            路由器暂时存储的是一个个短分组，而不是整个的长报文。短分组是暂存在路由器的存储器中而不是存储在磁盘中。这就保证了较高的交换速率。
            因特网可以容许非常多的主机同时进行通信，而一个主机中的多个进程（即正在运行中的多道程序）也可以各自和不同主机中的不同进程进行通信。
            注意，分组交换在传送数据之前不必先占用一条端到端的通信资源。分组在哪段链路上传送才占用这段链路的通信资源。分组到达一个路由器后，先暂时存储下来，查找转发表，然后从另一条合适的链路转发出去。分组在传输时就这样一段段地断续占用通信资源，而且还省去了建立连接和释放连接的开销，因而数据的传输效率更高。
            因特网采取了专门的措施，保证了数据的传送具有非常高的可靠性。当网络中的某些结点或链路突然故障，在各路由器中运行的路由选择协议（protocol）能够自动找到其他路径转发分组。

            从以上所述可知，采用存储转发的分组交换，实质上是采用了在数据通信的过程中断续（或动态）分配传输带宽的策略。
            为了提高分组交换网的可靠性，因特网的核心部分常常采用网状拓扑结构，使得当发生网络拥塞或少数结点、链路出现故障时，路由器可灵活地改变转发路由而不致引起通信中的中断或全网的瘫痪。此外，通讯网络的主干线路往往由一些高速链路构成，这样就可以较高的数据率循序地传送计算机数据。

            综上所述，分组交换网的主要优点可归纳：
                优点        所采用的手段
                高效        在分组传输的过程中动态分配传输带宽，对通信链路是逐段占用
                灵活        为每一个分组独立地选择转发路由
                迅速        以分组作为传送单位，可以不先建立连接就能向其他主机发送分组
                可靠        保证可靠性的网络协议：分布式多路由的分组交换网，使网络有很好的生存性

            分组交换也带来一些新的问题。例如，分组在各路由器存储转发时需要排队，这就会造成一定的时延。此外，由于分组交换不像电路交换那样通过建立连接来保证通信时所需的各种资源，因而无法确保通信时端到端所需的带宽。
                                      分组交换网带来的另一个问题是各分组必须携带的控制信息也造成了一定的开销。整个分组交换网还需要专门的管理和控制机制。
            从本质上讲，这种断续分配传输带宽的存储转发原理并非是完全新的概念。自古代就有的邮政通信，就其本质来说也是属于存储转发方式。而在20世纪40年代，电报通信业采用了基于存储转发原理的报文交换（message switching）。在报文交换中心，一份份电报被接受下来，并穿成纸带。操作员以每份报文为单位，撕下纸带，根据报文的目的站地址，拿到相应的发报机转发出去。这种报文交换的时延较长，从几分钟到几小时不等。现在报文交换已经很少有人使用了。分组交换虽然也采用存储转发原理，但由于使用了计算机进行处理，这就使分组的转发非常迅速。例如，ARPANET建网初期的经验表明，在正常的网络负荷下，当时横跨美国东西海岸的端到端平均时延小于0.1秒。这样，分组交换虽然采用了某些古老的交换原理，但实际上已变成了一种崭新的交换技术。

            三种交换方式在数据传送阶段的主要特点：
                电路交换--整个报文的比特流连续地从源点直达终点，好像在一个管道中传送。
                报文交换--整个报文先传送到临近结点，全部存储下来后查找转发表，转发到下一个结点。
                分组交换--单个分组（这只是整个报文的一部分）传送到相邻接点，存储下来后查找转发表，转发到下一个结点。

1.4计算机网络在我国的发展
    最早着手建设专用计算机广域网的是铁道部。铁道部在1980年即开始进行计算机联网实验。1989年11月我国第一个公用分组交换网CNPAC建成运行。在20世纪80年代后期，公安、银行、军队以及其他一些部门也相继建立了各自的专用计算机广域网。这对迅速传递重要的数据信息起着重要的作用。另一方面，从20世纪80年代起，国内的许多单位相继安装了大量的局域网。局域网的价格便宜，其所有权和使用权都属于本单位，因此便与开发、管理和维护。局域网的发展很快，对各行各业的管理现代化和办公自动化已起了积极的作用。
    这里应当特别提到的是1994年4月20日我国用64kb/s专线正式连入因特网。从此，我国被国际上正式承认为接入因特网的国家。同年5月中国科学院高能物理研究所设立我国的第一个万维网服务器。同年9月中国公用计算机互联网CHINANET正式启动。到目前为止，我国陆续建造了基于因特网技术的并可以和因特网互连的9个全国范围的公用计算机网络。是：
        1）中国公用计算机互联网CHINANET
        2）中国教育和科研计算机网CERNET
        3）中国科学技术网CSTNET
        4）中国联通互联网UNINET
        5）中国网通公用互联网CNCNET
        6）中国国际经济贸易互联网CIETNET
        7）中国移动互联网CMNET
        8）中国长城互联网CGWNET
        9）中国卫星集团互联网CSNET
        此外，还有一个中国高速互联研究试验网NSFnet，是中国科学院、北京大学、清华大学等单位在北京中关村地区建造的为研究因特网新技术的高速网络。

1.5计算机网络的类别
    1.5.1 计算机网络的定义
        计算机网络的精确定义并未统一。
        最简单的定义是：一些互相连接的、自治的计算机的集合。
            若按此定义，早期的面向终端的网络都不能算是计算机网络，而只能称为联机系统。
        最简单的计算机网络就只有两台计算机和连接它们的一条链路，即两个结点和一条链路。因为没有第三台计算机，因此不存在交换问题。

        “计算机通信网”和“计算机网络”含义相同。
        “计算机通信”和“数据通信”常混用，前者强调通信主题是计算机中运行的程序，后者强调通信的内容是数据。
    1.5.2 几种不同类别的网络
        计算机网络有多种类别，下面进行简单的介绍。
        1.不同作用范围的网络
            1）广域网WAN（WideAreaNetwork）   广域网的作用范围通常为几十到几千公里，因而有时也称为远程网（long haul network）。广域网是因特网的核心部分，其任务是通过长距离（例如，跨越不同国家）运送主机所发送的数据。连接广域网各结点交换机的链路一般都是高速链路，具有较大的通信容量。
            2）城域网MAN（MetropolitanAreaNetwork）   城域网的作用范围一般是一个城市，可跨越几个街区甚至整个城市，其作用距离约为5~50km。城域网可以为一个或几个单位所拥有，但也可以是一种公用设施，用来将多个局域网进行互联。目前很多城域网采用的是以太网技术，因此有时也常并入局域网的范围进程讨论。
            3）局域网LAN（LocalAreaNetwork）    局域网一般用微型计算机或工作所通过高速通信线路相连（速率通常在10Mb/s以上），但地理上则局限在较小的范围（如1km左右）。在局域网发展的初期，一个学校或工厂往往只拥有一个局域网，但现在局域网已经非常广泛地使用，一个学校或企业大都拥有许多个互连的局域网（这样的网络常称为校园网或企业网）。
            4）个人区域网PAN（PersonalAreaNetwork）   个人区域网就是在个人工作地方把属于个人使用的电子设备（如便携式电脑等）用无线技术连接起来的网络，因此也常称为无线个人区域网WPAN（WirelessPAN），其范围大约在10m左右。
            如果：   中央处理机之间的距离非常近（如仅1米的数量级或更小），则一般就称之为多处理机系统，而不称它为计算机网络。
        2.不同使用者的网络
            1）公用网（public network）   这是指电信公司（国有或私有）出资建造的大型网络。“公用”的意思就是所有愿意按电信公司的规定见那费用的人都可以使用这种网络。因此公用网也可称为公众网。
            2）专用网（private network）    这是某个部门为本单位的特殊业务工作的需要而建造的网络。这种网络不向本单位以外的人提供服务。例如，军队、铁路、电力等系统均有本系统的专用网。
            公用网和专用网都可以传送多种业务。如传送的是计算机数据，则分别是公用计算机网络和专用计算机网络。
        3.用来把用户接入到因特网的网络
            这种网络就是接入网AN（AccessNetwork），它又称为本地接入网或居民接入网。这是一类比较特殊的计算机网络。前面介绍了用户必须通过ISP才能接入到因特网。由于从用户家中接入到因特网可以使用的技术有许多种，因此就出现了可以使用接入网技术连接到因特网的情况。接入网本身既不属于因特网的核心部分，也不属于因特网的边缘部分。实际上，由ISP技工的接入网只是起到让用户能够与因特网连接的“桥梁”作用。在因特网发展初期，用户多用电话线拨号接入因特网，速率很低（每秒几千比特到几十千比特），因此那是并没有使用接入网这个名词。直到最近，由于出现了多种宽带接入技术，宽带接入网才成为因特网领域中的一个热门课题。
1.6计算机网络的性能
    计算机网络的性能一般是指它的几个重要的性能指标。但除了这些重要的性能指标外，还有一些非性能特征（nonperformance characteristics）也对计算机网络的新跟你更有很大的影响。
    1.6.1   计算机网络的性能指标
        性能指标从不同的方面来度量计算机网络的性能。以下七个性能指标。
        1）速率
            计算机发送出的信号都是数字形式的。比特（bit）是计算机中数据量的单位，也是信息论中使用的信息量的单位。英文字bit来源于binary digit，意思是一个“二进制数字”，因此一个比特就是二进制数字中的一个1或0。网络技术中的速率指的是连续在计算机网络上的主机在数字信道上传送数据的速率。速率的单位是b/s（比特每秒）（或bit/s，有事也写为bps，即bit per second）。当数据率较高时，就可以用kb/s（k=10^3=千）、Mb/s(M=10^6=兆)、Gb/s（G=10^9=吉）或Tb/s（T=10^12=太）。现在人们常用更简单的并且是很不严格的记法来描述网络的速率，如100M以太网，而省略了单位中的b/s，它的意思是速率为100Mb/s的以太网。以上所说的速率往往是额定速率或标定速率。
        2）带宽
            “带宽”有两种不同的意义：
            2.1）带宽本来是值某个信号具有的频带宽度。信号的带宽是指该信号所包含的各种不同频率成份所占据的频率范围。例如，在传统的通信线路上传送的电话信号的标准带宽是3.1kHz（从300Hz到3.4kHz，即话音的主要成分的频率范围）。这种意义的带宽单位是赫（或千赫、兆赫、吉赫等）。在过去很长的一段时间，通信的主干线路传送的是模拟信号（即连续变化的信号）。因此，表示通信线路允许通过的信号频带范围就称为带宽（或通频带）。
            2.2）在计算机网络中，带宽用来表示网络的通信线路所能传送数据的能力，因此网络带宽表示在单位时间内从网络中的某一点到另一点所能通过的“最高数据率”。在本书中再提到“带宽”是，主要是指这个意思。这种意义的带宽的单位是“比特每秒”，记为b/s。在这种单位的前面也常常加上千（k）、兆（M）、吉（G）或太（T）这样的倍数。
        3）吞吐量
            吞吐量（throughput）表示在单位时间内通过某个网络（或信道、接口）的数据量。吞吐量更经常地用于对现实世界中的网络的一种测量，以便知道实际上到底有多少数据量能够通过网络。显然，吞吐量受网络的带宽或网络的额定速率的限制。例如，对于一个100Mb/s的以太网，其额定速率是100Mb/s，那么这个数值也是该以太网的吞吐量的绝对上限值。因此，对100Mb/s的以太网，其典型的吞吐量可能也只有70Mb/s。有时吞吐量还可以用每秒传送的字节数或帧数来表示。
        4）时延
            时延（delay或latency）是指数据（一个报文或分组，甚至比特）从网络（或链路）的一端传送到另一端的时间。时延是个很重要的性能指标，它有时也称为延迟或迟延。
            网络中的时延由几个不同的部分组成：
                4.1）发送时延    发送时延（transmission delay）是主机或路由器发送数据帧所需要的时间，也就是从发送数据帧的第一个比特算起，到该帧的最后一个比特发送完毕所需的时间。因此发送时延也叫做传输时延。公式是：发送时延=数据帧长度（b）/信道带宽（b/s）。由此可见，对于一定的网路，发送时延并非固定不变，而是与发送的帧长成正比，与信道带宽成反比。
                4.2）传播时延    传播时延（propagation delay）是电磁波在信道中传播一定的距离需要花费的时间。传播时延的计算公式是：传播时延=信道长度（m）/电磁波在信道上的传播速率（m/s）。电磁波在自由空间的传播速率是光速，即3.0x10^5km/s。电磁波在网络传输媒体中的传播速率比在自由空间要略低一些：在铜线电缆中的传播速率约为2.3x10^5km/s，在光纤中的传播速率约为2.0x10^5km/s。例如，1000m长的光纤线路产生的传播时延大约为5ms。
            两种时延不要弄混。发送时延发生在机器的内部的发送器中（一般就是发生在网络适配器中），而传播时延则发生在机器外部的传输信道媒体上。可以用一个简单的比喻来说明。假定有10辆车的车队从公路收费站入口出发到相距50公里的目的地。再假定每一辆车过收费站要花费6秒钟，而车速是每小时100公里。现在可以算出整个车队从收费站到目的地总共花费的时间：发车时间共需10秒（相当于网络中的发送时延），行车时间需要30分钟（相当于网络中的传播时延），因此总共花费的时间是31分钟。
                4.3）处理时延    主机或路由器在收到分组时要花费一定的时间进行处理，例如分析分组的首部、从分组中提取数据部分、进行差错检验或查找适当的路由等等，这就查生了处理时延。
                4.4）排队时延    分组在经过网络传输时，要经过许多的路由器。但分组在进入路由器后要先在输入队列中排队等待处理。在路由器确定了转发接口后，还要在输出队列中排队等待转发。这就产生了排队时延。排队时延的长短往往取决于网络当时的通信量。当网络的通信量很大时会发生队列溢出，使分组丢失，这相当于排队时延为无穷大。
              总时延 = 发送时延 + 传播时延 + 处理时延 + 排队时延 。
            一般来说，小时延的网络要优于大时延的网络。在某些情况下，一个低速率、小时延的网络很可能要优于一个高速率但大时延的网络。

            在总时延中，究竟是哪一种时延占主导地位，必须具体分析。
                假定有一个长度为100MB的数据块（这里的M显然不是指10^6而是2^10，即1048576。B是字节，1字节=8比特）。在带宽为1Mb/s的信道上（这里的M是10^6）连续发送，起发送时延是100 x 1048576 x 8 / 10^6 = 838.9s，即将近用14分钟才能把这样打的数据块发送完毕。然而若将这样的数据用光纤传送到1000km远的计算机，那么每一个比特在1000km的光纤上只需用5ms就能到达目的地。因此对于这种情况，发送时延占主导地位。
                如果我们把传播距离减小到1km，那么传播时延也会相应地减小到原来数值的千分之一。然而由于传播时延在总时延中的比重是微不足道的，因此总时延的数值基本上还是由发送时延来决定的。
                再看一个例子。要传送的数据仅有1个字节（如键盘上键入一个字符，共8bit）。在1Mb/s的信道上的发送时延是8 / 10^6 = 8x10^6 = 8μs 。当传播时延为5ms时，总时延为5.008ms。显然，在这种情况下，传播时延决定了总时延。这时，即使把数据率提高到1000倍（即将数据的发送速率提高到1Gb/s），总时延也不会减少多少。这个例子告诉我们，不能笼统地认为：“数据的发送速率越高，传送得就越快”。这是因为数据传送的总时延是由公式右端的四项时延组成的，不能仅考虑发送时延一项。
            必须强调指出，初学网络的人容易产生这样错误的概念，就是“在高速链路（或高带宽链路）上，比特应当跑得更快些”。但这是不对的。我们知道，汽车在路面质量很好的高速公路上可明显地提高行驶速率。然而对于高速网络链路，我们提高的仅仅是数据的发送速率而不是比特在链路上的传播速率。荷载信息的电磁波在通信线路上的传播速率（这时光速的数量级）与数据的发送速率并无关系。提高数据的发送速率只是见笑了数据的发送时延。
                还有一点，数据的发送速率的单位是没买哦发送多少个比特，是指某个点或某个接口上的发送速率。而传播速率的单位是每秒传播多少公里，是指传输线路上比特的传播速率。因此，通常所说的“光纤信道的传输速率高”是指向光纤信道发送数据的速率可以很高，而光纤信道的传播速率实际上还要比铜线的传播速率略低一点。这是因为经过测量得知，光在光纤中的传播速率是每秒20.5万公里，它比电磁波在铜线（如5类线）中的传播速率（每秒23.1万公里）略低一些。
        5）时延带宽积
            把以上讨论的网络性能的两个度量，传播时延和带宽相乘，就得到另一个有用的度量：传播时延带宽积。即：时延带宽积 = 传播时延 x 带宽 。又称为 以比特为单位的链路长度。
        6）往返时间RTT
            在计算机网络中，往返时间RTT（Round-Trip Time）也是一个重要的性能指标，它表示从发送方发送数据开始，到发送方收到来自接收方的确认（接收方收到数据后便立即发送确认），总共经历的时间。对于上述例子，往返时间RTT是40ms，而往返时间和带宽的乘积是4x10^5（bit）。在互联网中，往返时间还包括各中间结点的处理时延、排队时延以及转发数据时的发送时延。显然，往返时间与所发送的分组长度有关。发送很长的数据块的往返时间，应当比发送很短的数据块的往返时间要多些。
            往返时间带宽积的意义是当发送方连续发送数据时，即使能够即使能够收到对方的确认，但已经将许多比特发送到链路上。对于上述例子，假定数据的接收方即使发现了差错，并告知发送方，使发送方立即停止发送，但也已经发送了40万个比特了。
            当使用卫星通信是，往返时间RTT相对较长，是很重要的一个性能指标。
        7）利用率
            利用率有信道利用率和网络利用率两种。信道利用率指出某信道有百分之几的时间是被利用的（有数据通过）。完全空闲的信道的利用率是零。网络利用率则是全网络的信道利用率的加权平均值。信道利用率并非越高越好。这是因为，根据排队论的理论，当某信道的利用率增大时，该信道引起的时延也就迅速增加。这和高速公路的情况有些相似。当高速公路上的车流量很大时，由于在公路上的某些地方会出现堵塞，因此行车所需的时间就会增大。网络也有类似的情况。当网络的通信量很少时，网络产生的时延并不大。但在网络通信量不断增大的情况下，由于分组在网络结点（路由器或结点交换机）进行处理时需要排队等候，因此网络引起的时延就会增大。
            如果D0表示网络空闲时的时延，D表示网络当前的时延，U是利用率。
                D = D0 / （1-U）表示D，D0和利用率U之间的关系。
            这里U是网络的利用率，数值在0到1之间。当网络的利用率达到其容量的1/2时，时延就要加倍。特别值得注意的就是：当网络的利用率接近最大值1时，网络的时延就趋于无穷大。因此我们必须有这样的概念：信道或利用率过高会产生非常大的时延。因此一些拥有较大主干网的ISP通常控制他们的信道利用率不超过50%。如果超过了就要准备扩容，增大线路的带宽。

    1.6.2计算机网络的非性能特征
        计算机网络还有一些非性能特征也很重要。这些非性能特征与前面介绍的性能指标有很大的关系。下面简单地加以介绍。
        1）费用
            网络的价格（包括设计和实现的费用）总是必须考虑的，因为网络的性能与其价格密切相关。一般来说，网络的速率越高，其价格也越高。
        2）质量
            网络的质量取决于网络中所有构件的质量，以及这些狗剑士怎样组成网络的。网络的质量影响到很多方面，如网络的可靠性、网络管理的简易性，以及网络的一些性能。但网络的性能与网络的质量并不是一回事。例如，有些性能也还可以的网络，运行一段时间后就出现了故障，变得无法再继续工作，说明其质量不好。高质量的网络往往价格也较高。
        3）标准化
            网络的硬件和软件的设计既可以按照通用的国际标准，也可以遵循特定的专用网络标准。最好采用国际标准的设计，这样可以得到更好的互操作性，更易于升级换代和维修，也更容易得到技术上的支持。
        4）可靠性
            可靠性与网络的质量和性能都有密切关系。速率更高的网络的可靠性不一定会更差。但速率更高的网络要可靠地运行，则往往更加困难，同时所需的费用也会较高。
        5）可扩展性和可升级型
            在构造网络时就应当考虑到今后可能会需要扩展（即规模扩大）和升级（即性能和版本的提高）。网络的性能越高，其扩展费用往往也越高，难度也会相应增加。
        6）易于管理和维护
            网络如果没有良好的管理和维护，就很难达到和保持所设计的性能。
1.7计算机网络体系结构
    在计算机网络的基本概念中，分层次的体系结构是最基本的。计算机网络体系的抽象概念较多，在学习时要多思考。
    1.7.1计算机网络体系结构的形成
        计算机网络是个非常复杂的系统。为了说明这一点，可以设想一个最简单的情况：连接在网络上的两台计算机要互相传送文件。
        显然，在这两台计算机之间必须有一条传送数据的通路。但这还远远不够。至少还有几件工作需要完成：
            1）发起通信的计算机必须将数据通信的通路进行激活（activate）。所谓“激活”就是要发出一些信令，保证要传送的计算机数据能在这条通路上正确发送和接收。
            2）要告诉网络如何识别接收数据的计算机。
            3）发起通信的计算机必须查明对方计算机是否开机，并且与网络连接正常。
            4）发起通信的计算机中的应用程序必须弄清楚，在对方计算机中的文件管理程序是否已做好文件接收和存储文件的准备工作。
            5）若计算机网文件格式不兼容，则至少其中的一个计算机应完成格式转换功能。
            6）对出现的各种差错和意外事故，如数据传送错误、重复或丢失，网络中某个结点交换机故障等，应当有可靠的措施保证对方计算机最终能够收到正确的文件。
            还可以举出一些要做的其他工作。
            互相通信的两个计算机系统必须高度协调工作才行，而这种“协调”是相当复杂的。为了设计这样复杂的计算机网络，早在最初的ARPANET设计时即提出了分成的方法。
            “分层”可将庞大而复杂的问题，转化为若干较小的局部问题，而这些较小的局部问题就比较易于研究和处理。
        1974年，美国的IBM公司宣布了系统网络体系结构SNA（SystemNetworkArchitecture）。这个著名的网络标准就是按照分层的方法指定的。现在用IBM大型机构建的专用网络仍在使用SNA。不久后，其他一些公司也相继推出自己公司的具有不同名称的体系结构。
        不同的网络体系结构出现后，使用同一个公司生产的各种设备都能够很容易地互连成网。这种情况显然有利于一个公司垄断市场。用户一旦购买了某个公司的网络，当需要扩大容量时，就只能再购买原公司的产品。如果购买了其他公司的产品，那么由于网络体系结构的不同，就很难互相连通。
        然而，全球经济的发展使得不同网络体系结构的用户迫切要求能够互相交换信息。为了使不同体系结构的计算机网络都能互连，国际标准化组织ISO于1977年成立了专门机构研究该问题。不久，他们就提出了一个试图使各种计算机在世界范围内互连成网的标准框架，即著名的开放系统互联基本参考模型OSI/RM（OpenSystemInterconnectionReferenceModel），简称OSI。“开放”是指非独家垄断。因此只要遵循OSI标准，一个系统就可以和位于世界上任何地方的、也遵循这统一标准的其他任何系统进行通信。这一点很像世界范围的电话和邮政系统，这两个系统都是开放系统。“系统”是指在现实的系统中与互联有关的各部分（我们知道，并不是一个系统中的所有部分都与互联有关。OSI/RM参考模型是把与互联无关的部分除外，而仅仅考虑与互联有关的那些部分）。所以开放系统互连参考模型OSI/RM是个抽象的概念。在1983年形成了开放系统互联基本参考模型的正是文件，即著名的ISO7498国际标准，也就是所谓的七层协议的体系结构。
        OSI试图达到一种理想境界，即全世界的计算机都遵循这个同意的标准，因而全世界的计算机将能够很方便地进行互连和交换数据。在20世纪80年代，许多大公司甚至一些国家的政府机构纷纷表示支持OSI。当时看来似乎在不久的将来全时间一定会按照OSI指定的标准来构造自己的计算机网络。然而到了20世纪90年代初期，虽然整套的OSI国际标准都已经制定出来了，但由于因特网已抢先在全世界覆盖了相当大的范围，而与此同时却几乎找不到有什么厂家生产出符合OSI标准的商用产品。因此人们得出这样的结论：OSI只获得了一些理论研究的成果，但在市场化方面OSI则事与愿违地失败了。现在规模最大的、覆盖全世界的因特网并未使用OSI标准。OSI失败的原因可归纳为：
            1）OSI的专家们缺乏实际经验，他们在完成OSI标准时缺乏商业驱动力
            2）OSI的协议实现起来过分复杂，而且运行效率很低
            3）OSI标准的制定周期太长，因而使得按OSI标准生产的设备无法及时进入市场
            4）OSI的层次划分不太合理，有些功能在多个层次中重复出现。
        按照一般的概念，网络技术和设备只有符合有关的国际标准才能大范围地获得工程上的应用。但现在情况却反过来了。得到最广泛应用的不是法律上的国际标准OSI，而是非国际标准TCP/IP。这样，TCP/IP就常被称为事实上的国际标准。从这种意义上说，能够占领市场的就是标准。在过去指定标准的组织中往往以专家、学者为主。但现在许多公司都纷纷挤进各种各样的标准化组织，使得技术标准具有浓厚的商业气息。一个新标准的出现，有事不一定反映其技术水平是最先进的，而是往往有着一定的市场背景。
        顺便说一下，虽然OSI在一开始是由ISO来制定的，但后来的许多标准都是ISO与原来的国际电报电话咨询委员会CCITT联合制定的。从历史上来看，CCITT原来是从通信的角度考虑一些标准的指定，而ISO则关心信息的处理。但随着科学技术的发展，通信与信息处理的界限变得比较模糊了。于是，通信与信息处理就都成为CCITT和ISO所共同关心的领域。CCITT的建议书X.200就是关于开放系统互连参考模型，它和上面提到的ISO7498基本上是相同的。
    1.7.2协议与划分层次
        在计算机网络中要做到有条不紊地交换数据，就必须遵守一些事先约好的规则。这些规则明确规定了所交换的数据的故事以及有关的同步问题。这里所说的同步不是狭义的（即同频或同频同相）而是广义的，即在一定的条件下应当发生什么事件（如发送一个应答信息），因而同步含有时序的意思。这些为进行网络中的数据交换而建立的规则、标准或约定称为网络协议（network protocol）。网络协议也可简称为协议。更进一步讲，网络协议主要由以下三个要素组成：
            1）语法，即数据与控制信息的结构或格式
            2）语义，即需要发出何种控制信息，王城何种动作以及做出何种响应
            3）同步，即事件实现顺序的详细说明
            由此可见，网络协议是计算机网络的不可缺少的组成部分。实际上，只要我们想让连接在网络上的另一台计算机做点什么事情（例如，从网络上的某个主机下载文件），我们都需要有协议。但是当我们经常在自己的PC机上进行文件存盘操作时，就不需要任何网络协议，除非这个用来存储文件的磁盘是网络上的某个文件服务器的磁盘。
        协议通常有两种不同的形式。一种是使用便于人来阅读和理解的文字描述。另一种是使用让计算机能够理解的程序代码。这两种不同形式的协议都必须能够对网络上信息交换过程做出精确的解释。
        ARPANET的研制经验表明，对于非常复杂的计算机网络协议，其结构应该是层次式的。我们可以举一个简单的例子来说明划分层次的概念。
        现在假定我们在主机1和主机2之间通过一个通信网络传输文件。这是一件比较复杂的工作，因为需要做不少的工作。
        我们可以将要做的工作划分为三类。第一类松祚与传送文件直接有关。例如，发送端的文件传送应用程序应当确信接收端的文件管理程序已做好接受和存储文件的准备。若两个主机所用的文件格式不一样，则至少其中的一个主机应完成文件格式的转换。这两件工作可用一个文件传送模块来完成。这样，两个主机可将文件传送模块作为最高的一层。
            在这两个模块之间的虚线表示两个主机系统交换文件和一些文件交换的命令
                主机1                                               主机2
                文件传送模块-------------文件及文件传送命令------------文件传送模块
                通信服务模块-------------与通信有关的报文--------------通信服务模块
                网络接入模块==（网络接口）====通信网络====（网络接口）==网络接入模块
            但是，我们并不想让文件传送模块完成全部工作的细节，这样会使传送模块过于复杂。可以再设立一个通信服务模块，用来保证文件和文件传送命令可靠地在两个系统之间交换。也就是说，让位于上面的文件传送模块利用下面你的通信服务模块提供的服务。我们还可以看出，如果将位于上面的文件传送模块换成电子邮件模块，那么电子邮件模块同样可以利用在它下面的通信服务模块所提供的可靠通信的服务。
            同样的道理，我们再构造一个网络接入模块，让这个模块负责做与网路接口细节有关的工作，并向上层提供服务，使上面的通信服务模块能够完成可靠通信的任务。

            从上述简单例子可以更好地理解分层可以带来很多好处。如：
            1）各层之间是独立的。某一层并不需要知道它的下一层是如何实现的，而仅仅需要知道该层通过层间的接口（即界面）所提供的服务。由于每一层只实现一种相对独立的功能，因而可将一个难以处理的复杂问题分解为若干个较容易处理的更小一些的问题。这样，整个问题的复杂程度就下降了。
            2）灵活性好。当任何一层发生变化时（例如由于技术的变化），只要层间节后关系保持不变，则在这层以上或以下的各层均不受影响。此外，对某一层提供的服务还可进行修改。当某层提供的服务不再需要时，甚至可以将这层取消。
            3）结构上课分隔开。各层都可以采用最合适的技术来实现。
            4）易于实现和维护。这种结构使得实现和调试一个庞大而又复杂的系统变得易于处理，因为整个的系统已被分解为若干个相对独立的子系统。
            5）能促进标准化工作。因为每一层的功能及其所提供的服务都已有了精确的说明。
            分层时应注意使每一层的功能非常明确。若层数太少，就会使每一层的协议太复杂。但层数太多又会在描述和综合各层功能的系统工程任务时遇到较多的困难。通常各层所要完成的功能主要由以下一些（可以只包括一种，也可以包括多种）：
            1））差错控制   使得和网络对等端的相应层次的通信更加可靠。
            2））流量控制   使得发送端的发送速率不要太快，要使接收端来得及接收。
            3））分段和重装    发送端将要发送的数据块划分为更小的单位，在接收端将其还原。
            4））复用和分用    发送端几个高层会话复用一条底层的连接，在接收端再进行分用。
            5））连接建立和释放    交换数据前先建立一条逻辑连接。数据传送结束后释放链接。
            分层当然也有一些缺点，例如，有些功能会在不同的层次中重复出现，因而产生了额外开销。
        我们把计算机网络的各层及其协议的集合，称为网络的体系结构（architecture）。换种说法，机损及网络的体系结构就是这个计算机网络及其构件所应完成的功能的经确定以。需要强调而是：这些功能究竟是用何种硬件或软件完成的，则是一个遵循这种体系结构的实现（implementation）。体系结构的英文名词architecture的原意是建筑学或建筑的设计和风格。它和一个具体的建筑物的概念很不同。例如，我们可以走进一个明代的建筑物中，但却不能走进一个明代的建筑风格之中。同理，我们也不能把一个具体的计算机网络说成是一个抽象的网络体系结构。总之，体系结构是抽象的，而实现则是具体的，是真正在运行的计算机硬件和软件。
    1.7.3具有五层协议的体系结构
        OSI的七层协议体系结构的概念清楚，理论也较完整，但它既复杂又不实用。TCP/IP体系结构则不同，但它现在却得到了非常广泛的应用。TCP/IP是一个四层的体系结构，它包括应用层、运输层、网际层和网络接口层（用网际层这个名字是强调这一层是为了解决不同网络的互连问题）。不过从实质上讲，TCP/IP只有最上面的三层，因为最下面的网络接口层并没有什么具体内容。因此在学习计算机网络的原理时往往采用折中的办法，即综合OSI和TCP/IP的优点，采用一种只有五层协议的体系结构，这样既简洁又能将概念阐述清楚。
            OSI的体系结构                      TCP/IP的体系结构               五层协议的体系结构
            7应用层                            应用层                        5应用层
            6表示层
            5会话层
            4运输层----------------------------运输层（TCP或UDP）             4运输层
            3网络层----------------------------网际层（IP）                   3网络层
            2数据链路层                                                       2数据链路层
            1物理层                            网络接口层                      1物理层
        现在结合因特网的情况，自上而下地、非常简要地介绍一下各层的主要功能。实际上，只有认真学习完本书各章的协议后才能真正弄清各层的作用。
            1）应用层（application layer）    应用层是体系结构中的最高层。应用层直接为用户的应用进程提供服务。这里的进程就是指正在进行的程序。在因特网中的应用层协议很多，如支持万维网应用的HTTP协议，支持电子邮件的SMTP协议，支持文件传送的FTP协议等等。
            2）运输层（transport layer）    运输层的任务就是复杂向两个主机中进程之间的通信提供服务。由于一个主机可同时运行多个进程，因此运输层有复用和分用的功能。复用就是多个应用层可同时使用下面运输层的服务，分用则是运输层把收到的信息分别交付给上面应用层中的响应的进程。
                运输层主演使用的两种协议：
                    1））用户控制协议TCP（TransmissionControlProtocol）--面向连接的，数据传输的单位是报文段（segment），能够提供可靠的交付。
                    2））用户数据报协议UDP（UserDatagramProtocol）--无连接的，数据传输的单位是用户数据报，不保证提供可靠的交付，只能提供“尽最大努力交付（best-effort delivery）”。
            3）网络层（network layer）    网络层负责为分组交换网上的不同主机提供通信服务。在发送数据时，网络层把运输层产生的报文段或用户数据报封装成分组或包进行传送。在TCP/IP体系中，由于网络层使用IP协议，因此分组也叫做IP数据报，或简称为数据报。本书把“分组”和“数据报”作为同义词使用。
                            不要讲运输层的“用户数据报UDP”和网路层的“IP数据报”弄混。
                            还有一点，无论在哪一层传送的数据单元，习惯上都可笼统地用“分组”来表示。在阅读国外文献时，特别要注意packet（分组或包）往往是作为任何一层传送的数据单元的同义词。
                            网络层的另一个任务就是要选择合适的路由，是源主机运输层所传下来的分组，能后通过网络中的路由器找到目的主机。这里要强调指出，网路层中的“网络”二字，已不是我们通常谈到的具体的网络，而是在计算机网络体系结构模型中的专用名词。
                            对于由广播信道构成的分组交换网，路由选择的问题很简单，因此这种网络的网络层非常简单，甚至可以没有。
                            因特网是一个很大的互联网，它由大量的异构（heterogeneous）网络通过路由器（router）相互连接起来。因特网主要的网络层协议是无连接的网际协议IP（InternetProtocol）和许多种路由选择协议，因此因特网的网络层也叫做网际层或IP层。在本书中，网络层、网际层和IP层都是同义语。
            4）数据链路层（data link layer）    常简称为链路层。我们知道，两个主机之间的数据传输，总是在一段一段的链路上传送的，也就是说，在两个相邻结点之间（主机和路由器之间或两个路由器之间）传送数据是直接传送的（点对点）。这时就需要使用专门的链路层的协议。在两个相邻结点之间传送数据时，数据链路层将网络层交下来的IP数据报组装成帧（framing），在两个相邻结点间的链路上“透明”地传送帧（frame）中的数据。每一帧包括数据和必要的控制信息（如同步信息、地址信息、差错控制等）。典型的帧长是几百字节到一千多字节。
                            “透明”是一个很重要的术语。它表示：某一个实际存在的事物看起来却好像不存在一样（例如，你看不见你前面有100%透明的玻璃的存在）。“在数据链路层传送数据”表示无论什么样的比特组合的数据都能够通过这个数据链路层。因此，对所传送的数据来说，这些数据就“但不见”数据链路层。或者说，数据链路层对这些数据来说是透明的。
                            在接收数据时，控制信息使接收端能够知道一个帧从那个比特开始和到哪个比特结束。这样，数据链路层在收到一个帧后，就可以从中提取出数据部分，上交给网络层。
                            控制信息还使接收端能够检测到所受到的帧中有无差错。如发现有差错，数据链路层就简单地丢弃这个出了差错的帧，以免，一面继续传送下去白白浪费网路资源。如果需要改正错误，就有运输层的TCP协议来完成。
            5）物理层（physical layer）   在物理层上所传数据的单位是比特。物理层的任务就是透明地传送比特流。也就是说，发送方发送1（或0）时，接收方应当收到1（或0）而不是0（或1）。因此物理层要考虑用多大的电压代表“1”或“0”，以及接收方如何识别出发送方所发送的比特。物理层还要确定连接电缆的插头应当有多少根引脚以及各条引脚应如何连接。当然，哪几个比特代表什么意思，则不是物理层所要管的。请注意，传递信息所利用的一些物理媒体，如双绞线、同轴电缆、光缆、无线信道等，并不在物理层协议之内而是在物理层协议的下面。因此也有人把物理媒体当做第0层。
                            在因特网所使用的各种协议中，最重要的和最著名的就是TCP和IP两个协议。现在人们经常提到的TCP/IP并不一定单指TCP和IP这两个具体的协议，而往往是表示因特网所使用的整个TCP/IP协议族（protocol suite）。
                            图片：数据在各层之间的传递过程.png
                                主机1                                            主机2
                                |AP1                |应用程序数据|                 AP2|
                                |5               |H5|数据部分    |                 5  |
                                |4            |H4| 数据部分      |                 4  |
                                |3        |H3 |  数据部分        |                 3  |
                                |2     |H2| 数据部分             |T2（尾部）|       2  |
                                |1     |            比特流                 |       1  |
                                ------------------------------------------------------
                                |                       物理传输媒体                   |
                                ------------------------------------------------------
                                假定主机1的应用进程AP1向主机2的应用进程AP2传送数据。AP1先将其数据交给本主机的第5层（应用层）。第5层加上必要的控制信息H5就变成了下一层的数据单元。第4层（运输层）收到这个数据单元后，加上本层的控制信息H4，再交给第3层（网络层），成为第3层的数据单元。以此类推。不过到了第2层（数据链路层）后，控制信息分成两部分，分别加到本层数据单元的首部（H2）和尾部（T2）而第1层（物理层）由于是比特流的传送，所以不再加上控制信息。请注意，传送比特流时应从首部开始传送。
                                OSI参考模型把对等层次之间传送的数据单元称为该层的协议数据单元PDU（Protocol Data Unit）。这个名词现已被许多非OSI标准采用。
                                当这一串的比特流离开主机1经过网络的物理媒体传送到目的站主机2时，就从主机2的第1层依次上升到第5层。每一层根据控制信息进行必要的操作，然后将控制信息剥去，将该层剩下的数据单元上交给更高的一层。最后，把应用进程AP1发送的数据交给目的站的应用进程AP2 。
                                可以用一个简单例子来比喻上述过程。有一封信从最高层往下传。没经过一层就报上一个新的信封，写上必要的地址信息。包有多个信封的信件传送到目的站后，从第1层起，每层拆开一个信封后就把信封中的信交给它的上一层。传到最高层后，取出发信人所发的信将诶收信人。
                                虽然应用进程数据要经过复杂过程才能送到终点的应用进程，但这些复杂过程对用户来说，却都被屏蔽掉了，以致应用进程AP1觉得好像是直接把数据交给了应用进程AP2。同理，任何两个同样的层次（例如在两个系统的第4层）之间，将数据（即数据单元加上控制信息）通过水平虚线直接传递给对方。这就是所谓的“对等层”（peer layer）之间的通信。我们以前京城提到的各层协议，实际上就是在各个对等层之间传递数据时的各项规定。
                                在文献中也还可以见到术语“协议栈”（protocol Stack）。这是因为几个层次画在一起很像一个栈（stack）的结构。
    1.7.4实体、协议、服务和服务访问点
        当研究开放系统中的信息交换时，往往使用实体（entity）这一较为抽象的名词表示任何可发送或接受信息的硬件或软件进程。在许多情况下，实体就是一个特定的软件模块。
        协议是控制两个对等实体（或多个实体）进行通信的规则的集合。协议的语法方面的规则定义了所交换的信息的格式，而协议的语义发明和奶奶的规则就定义了发送者或接收者所要完成的操作，例如，在何种条件下数据必须重传或丢弃。
        在协议的控制下，两个对等实体间的通信使得本层能够向上一层提供服务。要实现本层协议，还需要使用下面一层所提供的服务。
        一定要弄清楚，协议和服务在概念上是很不一样的。
        首先，协议的实现保证了能够向上一层提供服务。使用本层服务的实体只能看见服务而无法看见下面的协议。下面的协议对上面的实体是透明的。
        其次，协议是“水平的”，即协议是控制对等实体之间通信的规则。但服务是“垂直的”，即服务是由下层向上层通过层间接口提供的。另外，并非在一个层内完成的全部功能都称为服务。只有那些能够被高一层实体“看得见”的功能才能称之为“服务”。上层使用下层所提供的服务必须通过与下层交换一些命令，这些命令在OSI中称为服务原语。
        在同一系统中相邻两层的实体进行交互（即交换信息）的地方，通常称为服务访问点SAP（ServiceAccessPoint）。服务访问点SAP是一个抽象的概念，它实际上就是一个逻辑接口，有点像邮政邮箱（可以把邮件放入信箱和从信箱中取走邮件），但这种层间接口和两个设备之间的硬件接口（并行的或串行的）并不一样。OSI把层与层之间交换的数据的单位称为服务数据单元SDU（ServiceDataUnit），它可以与PDU不一样。例如，可以是多个SDU合成为一个PDU，也可以是一个SDU划分为几个PDU。
            服务用户        |实体（n+1）|      协议（n+1）     |实体（n+1）|        第n+1层
            ----------------------------------------------------------------------------
                               SAP                                SAP
            服务提供者      |实体（n）|         协议（n）       |实体（n）|         第n层

            这样，在任何相邻两层之间的关系可概括为上这样。这里要注意的是，第n层的两个“实体（n）”之间通过“协议（n）”进行通信，而第n+1层的两个“实体（n+1）”之间则通过另外的“协议（n+1）”进行通信（每一层都是用不同的协议）。第n层向上面的第n+1层所提供的服务实际上已包括了在它一下各层所提供的服务。第n层的实体对第n+1层的实体就相当于一个服务提供者。在服务提供者的上一层的实体又称为“服务用户”，因为它使用下层服务提供者所提供的服务。
        计算机网络的协议还有一个很重要的特点，就是协议必须把所有不利的条件事先都估计到，而不能假定一切都是正常的和非常理想的。例如两个朋友在电话中约会好，下午3时在某公园门口碰头，并且约定“不见不散”。这就是一个很不科学的协议，因为任何一方临时有急事来不了而又无法通知对方时（如对方的电话或手机都无法接通），则另一方按照协议就必须永远等待下去。因此，看一个计算机网络协议是否正确，不能只看正常情况下是否正确，而且还必须非常仔细地检查这个协议能否应付各种异常情况。
            下面是一个有关网络协议的非常著名的例子。
            1）例1.1  占据东、西两个山顶的蓝军1和蓝军2与驻扎在山谷的白军作战。其力量对比是：单独的蓝军1或蓝军2打不过白军，但蓝军1和蓝军2协同作战则可战胜白军。现蓝军1拟于次日正午向白军发起攻击。于是用计算机发送电文给蓝军2。但通信线路很不好，电文出错或丢失的可能性较大（没有电话可使用）。因此要求收到电文的友军必须送回一个确认电文。但此确认电文也可能出错或丢失。试问能否设计出一种协议使得蓝军1和蓝军2能够实现协同作战因而一定（即100%而不是99.999...%）取得胜利？
                解 蓝军1先发送：“拟于明日正午向白军发起攻击。请协同作战和确认。”
                假定蓝军2收到电文后发回了确认。
                然而现在蓝军1和蓝军2都不敢下决心进攻。因为蓝军2不知道此确认电文对方是否正确地收到了。如未正确收到，则蓝军1必定不嘛冒然进攻。在此情况下，自己单方面发起进攻就肯定要失败。因此，必须等待蓝军1发送“对确认的确认”。
                假定蓝军2收到蓝军1发来的确认。但蓝军1同样关系自己发出的确认是否已被对方正确地收到。因此还要等待蓝军2的“对确认的确认的确认”。
                这样无限循环下去，蓝军1和蓝军2都始终无法确定自己最后发出的电文对方是否已经收到。
                因此，在本例题给出的条件下，没有一种协议可以使蓝军1和蓝军2能够100%地确保胜利。
                这个例子告诉我们，看似非常简单的协议，设计起来要考虑的问题还是比较多的。
    1.7.5TCP/IP的体系结构
        前面已经说过，TCP/IP的体系结构比较简单，它只有四层。
            主机A                                 主机B
            应用层               路由器           应用层
            运输层                                运输层
            网际层               网际层           网际层
            网络接口层--网络1--网络接口层--网络2--网络接口层

        路由器在转发分组时最高只用到网络层而没有使用运输层和应用层。
        还有一种方法，即使分层次画出具体的协议来表示TCP/IP协议族，它的特点是上下两头大而中间小：应用层和网络接口层都有多种协议，而中间的IP层很小，上层协议都向下汇聚到一个IP协议汇总。这种很像沙漏计时器形状的TCP/IP协议族表明：TCP/IP协议可以为各式各样的应用提供服务（所谓的everything over IP），同时TCP/IP协议也允许IP协议在各式各样的网络构成的互联网上运行（所谓的IP over everything）。正因为如此，因特网才会发展到今天的这种全球规模。不难看出IP协议在因特网中的核心作用。
            应用层   HTTP---SMTP   DNS---RTP   H.323 ---SIP
                          |          |              |
            运输层       TCP         UDP           SCTP
                            \         |             /
            网际层                    IP
                              /       |       \
            网络接口层   网络接口1   网络接口2   网络接口3……
        例1-2    利用协议栈的概念，说明在因特网中常用的客户服务器工作方式。
        解       主机A                                           主机B
                应用层（客户） ← 接受连接建立请求|发起连接建立请求 → 应用层（服务器）
                运输层                                           运输层
                网络层                                           网络层
                数据链路层                                       数据链路层
                物理层                                           物理层
                                       因特网

            主机A和主机B都各有自己的协议栈。主机A中的应用进程（即客户进程）的位置在最高的应用层。这个客户进程向主机B应用层的服务器进程发出请求，请求建立连接。然后，主机B中的服务器进程接受A的客户进程发来的请求。所有这些通信，实际上都需要使用各层所提供的服务。

                主机A                         主机C                     主机B
                应用层（客户1）----->（服务器1）应用层（服务器2）---->应用层（客户2）
                运输层                       运输层                   运输层
                网络层                       网络层                   网络层
                数据链路层                   数据链路层                数据链路层
                物理层                       物理层                   物理层
                  |--------------------------因特网-----------------------|
            主机C的应用层中同时有两个服务器进程在通信。服务器1在和主机A中的客户1通信，而服务器2在和主机B中的客户2通信。有的服务器进程可以同时向几百个客户进程提供服务。

习题
1-01    计算机网络向用户可以提供哪些服务？
1-02    试简述分组交换的要点。
1-03    试从多个方面比较电路交换、报文交换和分组交换的主要优缺点。
1-04    为什么说因特网是自印刷术以来人类通信方面最大的变革？
1-05    因特网的发展大致分为哪几个阶段？请指出这几个阶段最主要的特点。
1-06    简述因特网标准制定的几个阶段。
1-07    小写和大写开头的英文名字internet和Internet在意思上有何重要区别？
1-08    计算机网络都有哪些类别？各种类别的网络都有哪些特点？
1-09    计算机网络中的主干网和本地接入网的主要区别是什么？
1-10    试在下列条件下比较电路交换和分组交换。要传达的报文公x（bit）。从源点到终点共经过k段链路，每段链路的传播时延为d（s），数据率为b（b/s）。在电路交换时电路的建立时间为s（s）。在分组交换时分组长度为p（bit），且各结点的排队等待时间可忽略不计。问在怎样的条件下，分组交换的时延比电路交换的要小？（提示：画一下草图观察k段链路共有几个结点。）
1-11    在上题的分组交换网中，设报文长度和分组长度分别为x和（p+h）（bit），其中p为分组的数据部分的长度，而h为每个分组所带的控制信息固定场地，与p的大小无关。通信的两端共经过k段链路。链路的数据率为b（b/s），但传播时延和结点的排队时间均可忽略不计。若打算使总的时延为最小，问分组的数据部分长度p应取多大？（提示：参考图中分组交换部分，观察总的时延由哪几部分组成。）
1-12    因特网的两大组成部分（边缘部分与核心部分）的特点是什么？它们的工作方式各有什么特点？
1-13    客户服务器方式与对等通信方式的主要区别是什么？有没有相同的地方？
1-14    计算机网络有哪些常用的性能指标？
1-15    假定网络的利用率到达了90%。试估算一下现在的网络时延是它的最小值的多少倍？
1-16    计算机通信网有哪些非性能特征？非性能特征与性能特征有什么区别？
1-17    收发两端之间的传输距离为1000km，信号在媒体上的传播速率为2x10^8m/s。试计算以下两种情况的发送时延和传播时延：（1）数据长度为10^7bit，数据发送速率为100kb/s。（2）数据长度为10^3bit，数据发送速率为1Gb/s。从以上计算结果可得出什么结论？
1-18    假设信号在媒体上的传播速率为2x10^8m/s。媒体长度l分贝为：（1）10cm（网络接口卡）（2）100m（局域网）（3）100km（城域网）（4）5000km（广域网）试计算当数据率为1Mb/s和10Gb/s时在以上媒体中正在传播的比特数。
1-19    长度为100字节的应用层数据交给运输层传送，需加上20字节的TCP首部。再交给网络层传送，需加上20字节的IP首部。最后交给数据链路层的以太网传送，加上首部和尾部共18字节。试求数据的传输效率。数据的传输效率是指发送的应用层数据除以所发送的总数据（即应用数据加上各种首部和尾部的额外开销）。若应用层数据长度为1000字节，数据的传输效率是多少？
1-20    网络体系结构为什么要采用分层次的结构？试举出一些与分层体系结构的思想相似的日常生活。
1-21    协议与服务有何区别？有何关系？
1-22    网络协议的三个要素是什么？各有什么含义？
1-23    为什么一个网络协议必须把各种不利的情况都考虑到？
1-24    试述具有五层协议的网络体系结构的要点，包括各层的主要功能。
1-25    试举出日常生活中有关“透明”这种名词的例子。
1-26    试解释以下名词：协议栈、实体、对等层、协议数据单元、服务访问点、客户、服务器、客户-服务器方式。
1-27    试解释everything over IP和IP over everything的含义。
