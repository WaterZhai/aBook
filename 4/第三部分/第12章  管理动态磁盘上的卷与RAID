第12章  管理动态磁盘上的卷与RAID

操作动态磁盘时，创建的是卷，而不是分区。简单地说，卷是可以直接用于存储数据的磁盘部分。进过创建卷与创建分区有很多相似之处，但卷有很多附加的功能。创建卷时，可以完成如下一些任务。
· 在单一驱动器上创建一个卷，称为简单卷。
· 对卷进行扩展，使其占据磁盘上所有空闲空间，这一过程创建了一个扩展卷。
· 创建一个扩月多个驱动器的卷，称为扩区卷。
· 配置RAID（独立磁盘冗余阵列），Windows Server 2008支持RAID-0、RAID-1与RAID-5，Windows则仅支持RAID-0。
由于卷与RAID阵列是在动态驱动器上创建的，因此只能由Windows 2000、Windows XP、Windows Vista、Windows Server 2003和Windows Server 2008访问。如果将计算机设置为包含早起Windows版本的双引导系统，则其上的动态驱动器对早起Windows版本是不可用的。然而，在网络上吗可以访问其他驱动器。这意味着运行早期Windows版本的计算机可以通过网络访问动态驱动器。

12.1获取卷信息与状态
    在使用DiskPart并希望检查分区或卷的状态时，可以使用LIST VOLUME命令。如下面实例所示，LIST VOLUME命令可以列出计算机上所有卷、分区、逻辑驱动器的统计信息：
        DISKPART>  list volume 
        Volume  ###    Ltr    Label       Fs        Type       Size      Status      info
        -----------    ---    --------    ----     -------     -----    --------     -------
        Volume 0       N                           Removable   0 B      No Media             
        Volume 1       F      Blank Disc  CDUDF    DVD-ROM     2048 B   Healthy              
        Volume 2       J                           Removable   0 B      No Media             
        Volume 3       I                           Removable   0 B      No Media
        Volume 4       L                           Removable   0 B      No Media
        Volume 5       G                           DVD-ROM     0 B      No Media
        Volume 6       E      Recovery    NTFS     Simple      9 GB     Healthy     
        Volume 7       C                  NTFS     Mirrored    457 GB   Healthy      System 
        Volume 8       D                  NTFS     Mirrored    457 GB   Healthy     
        Volume 9       O                  NTFS     RAID-5      466 GB   Healthy      
        Volume 10      Q                  NTFS     RAID-5      466 GB   Healthy             
        Volume 11      P                  NTFS     RAID-5      466 GB   Healthy          
        Volume 12      K                  NTFS     Simple      477 GB   Healthy             
    从上面的输出信息可以看出，LIST VOLUME命令可以展示如下一些要素。
    · Volume ###。卷编号，你可以通过select volume n命令来选定代操作的卷。
    · Ltr。卷的驱动器盘符。
    · Label。卷标。
    · Fs。文件系统类型，比如CDUDF、FAT、FAT32或NTFS。
    · Type。布局类型，对于动态磁盘，卷布局类型会报告卷的配置为简单、跨区、镜像、条带或RAID-5。
    · Size。卷的总存储容量。
    · Status。卷的状态，展示位正常、失败冗余等。
    · Info。提供了关于该卷的一些附加信息，比如该卷是否为系统卷等。
    卷状态是重要的一个统计信息。在安装新卷或进行故障排除时，理解卷状态是有用的。表12-1总结了一些卷状态值，主要是与动态卷相关的。在DiskPart中，可以使用如下的命令执行相关任务。ONLINE命令，用于使得某个卷联机：RECOBER命令，用于在磁盘上进行恢复与再同步；REPAIR，用于修复失效的RAID-5成员；RESCAN，用于重新扫描计算机的磁盘与卷。
        表12-1理解与解决卷状态问题
            ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
            状态           |描述                                                                                                |解决
            --------------|----------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
            数据不完整     |在外部磁盘上的跨区不完整，你可能忘记从跨区卷中添加其他磁盘                                               |遍历包含跨区卷剩余部分的磁盘，一次性导入所有磁盘
            数据非冗余      |在外部磁盘上容错卷不完整（非冗余），你可能忘记从镜像或RAID-5集中添加其他磁盘                             |添加剩余的磁盘，一次性导入所有磁盘
            失败           |磁盘错误状态，该磁盘不可访问或者已损坏                                                                |确保相关的动态磁盘联机。如果有必要，重新扫描卷。或将该卷联机。你也可以尝试恢复该卷
            失败冗余       |磁盘错误状态，镜像或RAID-5中的某个磁盘状态脱机                                                         |确保相关的动态磁盘状态为联机。如果有必要，重新扫描卷。或将该卷联机。你也可以尝试恢复该卷。如果卷无法联机，则可能需要替换失效的镜像或修复失效的RAID-5卷。
            格式化         |临时状态，表示该卷正处于格式化过程中                                                                  |格式化过程会显示完成的百分比，成功格式化之后，卷状态会设置为良好
            良好           |正常的卷状态                                                                                        |卷没有任何已知的问题
            良好（有风险）  |Windows在读、写动态卷所在物理磁盘时出现问题，在Windows遇到错误时会呈现这一状态                           |确保相关的动态磁盘状态为联机。如果有必要，重新扫描卷，或将该卷联机。你也可以尝试恢复该卷。如果卷持续呈现这一状态或者周期性呈现这一状态，则说明该卷可能已经失效，应该对磁盘上所有数据进行备份
            良好（未知分区）|Windows 无法识别分区，在分区来自不同的操作系统，或者是手工创建的用于存储系统文件的分区时，就可能呈现这一状态|不需要纠正措施
            初始化         | 临时状态，表示该磁盘正处于初始化过程中                                                                |驱动器状态在几秒之后会变化
            正在重新生成    |临时状态，表示镜像卷正被添加或导入，或者RAID-5的数据与奇偶信息正被重建                                   |重建过程会显示完成的百分比。成功重建之后，卷状态会设置为良好
            重新同步       |临时状态，表明镜像集正被再同步                                                                        |再同步过程会显示完成的百分比。成功完成之后，卷状态会设置为良好
            过期数据       |容错的外部磁盘上的数据失去同步                                                                        |重新扫描磁盘，或者重新同步镜像卷或RAID-5卷，之后检查状态使应该发现已经显示为新状态，比如失败冗余
            未知          |卷不能被访问，可能包含损坏的引导扇区                                                                   |该卷可能中了引导扇区病毒，用最新病毒库对其进行检测，重新扫描磁盘或重启计算机，之后检查状态
            ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
12.2创建并管理简单卷
    对动态磁盘，可以使用DiskPart创建简单卷，且简单卷是最基本的动态卷类型。与分区不同的是，简单卷可以遍布整个磁盘。当然，你也可以根据所配置的计算机的实际需要为简单卷指定适当的大小。
    12.2.1创建简单卷
        在向磁盘添加简单卷之前，应该对磁盘上空闲空间总量进行评估，并检查当前卷配置。你可以遵循如下步骤完成这些任务。
            （1）在命令提示符中键入diskpart，调用DiskPart。
            （2）列出计算机上的磁盘，并检查空闲空间，使用如下命令：
                Disk ###    Status    Size    Free    Dyn    Gpt
                --------    ------    ----    ----    ---    ---    
                Disk 0      Online    372 GB  0 B      
                Disk 1      Online    329 GB  204 GB  *
                Disk 2      Online    337 GB  37 GB   *
        这一实例中，disk 1与disk 2被格式化为动态磁盘（由Dyn列的*可以看出），分区格式为MBR（由Gpt列为空白可以看出）。Disk 1有204GB的可用空闲空间，disk 2有37GB的可用空闲空间。
        确定了待操作的磁盘后，就可以使用如下命令创建简单卷：
            create volume simple size=n disk=n 
        其中，size=n设置了卷的大小（以MB计数），disk=n指定了要操作的磁盘编号。
        创建卷之后，焦点将自动地被放置到其上，表示该卷已被选定。但该卷尚无盘符或挂载点，必须使用ASSIGN命令进行分配。要完成最后的创建工作，还必须使用FORMAT命令对其进行格式化。对于卷与分区，这些任务的执行方式都是一致的。要了解更多信息，参阅11.3.1小节与11.3.4小节。
    12.2.2扩展简单卷
        如果某简单卷需要更多磁盘空间，有两种方式可以对其进行扩展。一种是在同意磁盘上对其进行扩展，所得的卷叫做扩展卷；一种是在其他磁盘上进行扩展，所得的卷叫做跨区卷。对这两种情况，卷都必须格式化为NTFS格式。
        要对简单卷进行扩展，可以遵循如下步骤。
            （1）在命令提示符中键入diskpart，调用DiskPart。
            （2）列出计算机上的磁盘，并检查空闲空间，使用如下命令： 
                DISKPART> list disk 
            （3）列出计算机上的卷：
                DISKPART> list volume 
            （4）选定带扩展的卷，比如volume 5：
                DISKPART> select volume 5
            （5）对卷进行扩展。
            · 要在当前磁盘上对卷进行扩展，使用如下命令：
                DISKPART> extend size=n
                其中，size=n设置了要增加的空间大小（以MB计数）。比如，使用如下命令，可以将选定的卷扩展1024MB：
                DISKPART> extend size=1004 disk=2
            （注解  size大小在最近柱面边界附近，这会导致最终扩展的磁盘空间大小有或多或少的些微变化。）
            · 要在另外的动态磁盘上对卷进行扩展，使用如下命令：
                DISKPART> extend size=n disk=n 
                其中，size=n设置了要增加的空间大小（以MB计数），disk=n指定了卷应该扩展到的磁盘。比如，如果卷在disk 0上，现在需要将其扩展到disk 1，可以使用如下命令：
                DISKPART> extend size=2008 disk=1
                这里，将disk 0的卷扩展到disk 1上，在disk 1上的扩展区域大小为2008MB。
        （警告  扩展卷集时，有很多限制因素。你不能扩展引导卷或系统卷，不能扩展使用镜像或条带卷（RAID-0、RAID-1和RAID-5），也不能将卷扩展到32块以上的磁盘。此外，FAT卷与FAT32卷不能直接扩展。在扩展之前，必须先将其转换为NTFS格式。）
    12.2.3将动态磁盘联机
        动态磁盘由比基本磁盘丰富得多的功能。你可以很容易地解决其上存在的错误，并返回已经脱机的驱动器。你也可以检查驱动器配置的变化，并在不同计算机之间迁移与导入磁盘。
        如第10章中所讨论的，LIST DISK命令可以展示系统中每个可用磁盘的状态。如果某动态磁盘状态显示为联机（错误）或脱机，通常可以使用ONLINE命令纠正这一问题；DiskPart命令则可以用于指定待操作的磁盘，比如先键入select disk 0，之后键入online。如果驱动器状态没有改变，则可能需要重新引导计算机。如果重新引导计算机后仍不能解决问题，则需要检查驱动器及其控制器、电缆、电源等，确保相关硬件都已经正确连接。通过ONLINE命令，还可以重新同步镜像卷或RAID-5卷。
        如果驱动器配置已经改变，或者新的磁盘被添加到计算机中，则可以使用RESCAN命令重新扫描计算机上所有驱动器，并检查驱动器配置的更新。有时候，重新扫描还可以解决驱动器状态显示为不可读等问题。
        如果将动态磁盘从某计算机移动到其他计算机，则该磁盘可能会被标记为外部磁盘。磁盘可能标记为外部的另一种情况是该磁盘已经失效，但又试图将其联机。如果需要使用DiskPart将磁盘联机，可以先使用select disk 0选定代操作的磁盘，之后使用import命令。
    12.2.4删除卷
        在动态磁盘上，不应该使用DELETE PARTITION命令，因为该命令将删除磁盘上所有动态卷。如果需要删除动态磁盘上焦点所在卷，可以使用DELETE VOLUME命令。与DELETE PARTITION命令类似，你也不能使用DELETE VOLUME命令删除系统卷或引导卷，也不能删除包含活跃页面文件或崩溃转储文件（内存转储）的卷。
        要了解如何使用DELETE VOLUME命令，可以参考如下实例。
            （1）在命令提示符中键入diskpart，调用DiskPart。
            (2)列出计算机删过的卷，使用如下命令：
                DISKPART> list volume 
            （3）选定待删除的卷并删除该卷：
                DISKPART> select volume 5
                DISKPART> delete volume 
        （更多信息  默认情况下，DiskPart只可以删除已知的数据卷。至于分区，你可以在DELETE VOLUME命令中使用Override参数绕过这种限制。）
12.3通过动态磁盘上的RAID提供容错功能
    通过RAID，可以为重要数据提供增强的保护功能，来防止驱动器失效导致的数据丢失。RAID可以在硬件层面实现，也可以在软件层面实现。硬件RAID需要使用硬件销售商提供的工具实现与管理，软件RAID则可以使用操作系统本身实现与管理。
    在动态磁盘上，Windows Vista支持RAID-0，Windows Server 2008则支持下面3个层面的RAID。
    · RAID-0。磁盘分割。RAID-0包含两个或多个卷，每个卷都分布在不同的驱动器，并配置为一个条带集。数据被划分为多个块，称为条带，多块数据被顺序写入条带集所在的所有取定期。RAID-0提供了增快的速度与增强的性能，但没有提供容错功能。
    · RAID-1。磁盘镜像与双控。RAID-1中包含两个卷，分布在两个驱动器上，所作的配置是等同的。数据同时写入到两个驱动器。如果某个驱动器失效，由于另一个驱动器上也包含了同样的数据，因而不会造成数据丢失。RAID-1提供了数据冗余以及比带奇偶校验的磁盘分割（RAID-5）更好的性能。
    · RAID-5。带奇偶校验的磁盘分割。RAID-5包含3块或更多的卷，每个卷分布在不同的磁盘上，以便创建带奇偶校验的条带集。失效的时候，数据可以得以恢复。RAID-5提供了容错功能，并且比镜像技术有更低的开销与更高的性能。
    12.3.1实现RAID-0：磁盘分割
        RAID-0，即磁盘分割，包含了两个或更多的卷，每个卷位于不同的驱动器，配置为条带集。写入到条带集的数据被分割为称为条带的数据块，且这些条带按顺序写入条带集中的所有驱动器。此外，尽管理论上讲，可以将条带集中过的卷分布在最多32块驱动器上。但大多数场景下，条带集中包含2个到5个卷可以提供最好的性能提升，超过这一数值后，提升的性能将大幅下降。
        1.使用RAID-0
            使用RAID-0关键的一个原因就是速度的提升。由于可以使用多个驱动器磁头在多个磁盘上访问数据，因此，读性能可以大幅提升。然而，这种方式也提高了灾难性故障的可能性。如果条带集中的某个硬盘驱动器失效，则条带集将无法继续使用，并且其上所有数据将丢失。如果需要恢复，你可能需要重建条带集并从备份中恢复数据。数据备份与恢复在Windows Server 2008 Administrator's Pocket Consultant（Microsoft Press，2008）一书的第16章进行了讨论。
            创建条带集时，应该记住如下一些要点。
            · 引导卷与系统卷不可以作为条带集的一部分，对这些卷不能使用磁盘分割技术。
            · 条带集的总容量以最小卷容量为基础。有鉴于此，在创建条带集时，应该使用大小大致相等的卷。
            · 通过使用不同磁盘控制器删过的磁盘，可以使得性能提升最大化。因为这种方式可以使得系统同时访问多个驱动器。
            在使用RAID-0的磁盘上，运行LIST VOLUME命令或DETAIL DISK命令，会发现卷类型显示为STRIPED。如果在条带卷上使用DETAIL VOLUME命令，DiskPart会展示条带集中所有简单卷。
            在条带卷被破坏时，磁盘状态会显示为丢失。你可以在余下的驱动器上使用DETAIL DISK命令，此时显示的状态应为Failed，表示磁盘冗余已经失效。如果发现存在Failed状态，但不知道还有哪些其他磁盘是该条带卷的一部分，则可以在计算机上每块其他磁盘上运行DETAIL DISK命令，以便追踪出现故障的磁盘--该磁盘状态应该显示为丢失。
            典型情况下，要修复条带集，需要移除失效磁盘、使用新磁盘对其进行替代、将新磁盘配置为条带集的一部分等几个步骤。为此，你可以运行DiskPart，选择新磁盘，之后运行CONVERT DYNAMIC命令转换磁盘类型，之后对新磁盘进行格式化，并为其分配盘符。完成上述工作后，需要使用DiskPart移除驱动器（该驱动器是损坏的条带集的一部分）上的卷，并使用CREATE VOLUME STRIPE命令创建一个新的条带集。完成上述过程后，你可以选择条带卷，并使用LIST VOLUME命令查看其状态。如果一切正常，状态应该显示为良好。
            （警告  移除卷后，驱动器上所有数据将丢失，你只能从备份中重建数据。如果没有对数据进行备份，则不要重新驱动器。如果一旦数据已经丢失，也可以尝试使用第三方恢复工具恢复一部分数据。）
        2.配置条带集
            要实现RAID-0，可以遵循如下步骤。
            （1）在命令提示符中键入diskpart，调用DiskPart。
            （2）列出计算机上的磁盘，并检查空闲空间，并确保待操作磁盘都已经配置为动态磁盘，使用如下命令：
                DISKPART> list disk 
            （3）使用下面的命令创建条带集：
                DISKPART> create volume stripe size=n disk=n,n,n,...
            其中，size=n表示卷在每个磁盘上使用的空间总量（以MB计数）。如果没有指定size，DiskPart将使用最小磁盘上的所有剩余空间，并在其他磁盘上使用这一数值。disk=n,n,n,...表示的是磁盘编号，卷将被分割在这些磁盘上，你需要使用至少两块动态磁盘。
            参考如下实例。
            使用最小磁盘上所有可用空间在disk 0、disk 1、disk 2上创建条带卷，之后在所有剩余磁盘上使用同样的空间总量：
                create volume stripe disk=0,1,2
                使用80GB（81920MB）的空间在disk 0、disk 1、disk 2上创建条带卷：
                create volume stripe size=81920 disk=0,1,2
            （注解  将硬件RAID与软件RAID结合在一起使用时，你可能需要将卷或分区的起点与最临近的对其边界对齐，来提高性能。为此，你可以使用Align参数，语法格式为align=n。其中，n为从磁盘起始处到最近的对其边界的KB数，比如align=64.要记住的是，为与最近的对其边界协调，此值可能会有或大或小的变化，并改变分区或逻辑驱动器的最终大小。）
    12.3.2实现RAID-1：磁盘镜像与双控
        RAID-1，也称为磁盘镜像。这种技术中，在两个不同的驱动器上使用等同大小的卷，以便创建冗余的数据集。相互镜像的驱动器包含了完全等同的信息，也就是说，你可以只从主镜像中读取数据，但可以向两个驱动器中写入数据。由于有必要两次进行写数据操作，通常每个镜像驱动器有自己的磁盘控制器，以便同时像两个驱动器中写入数据。使用两个磁盘控制器时，驱动器称为双控的。因而，磁盘镜像与磁盘双控的区别在于是使用一个磁盘控制器还是两个（本章余下部分中，将不对其进行区分）。
        1.使用RAID-1
            使用磁盘镜像关键一个原因是，在一块磁盘失效后，另外一块磁盘可以自动地用于数据读写。你也可以使用正常工作的驱动器，在同一块磁盘或其他磁盘上重建失效驱动器数据。在对失效驱动器进行修复之前，你需要分离镜像。要了解如何做到这些，可以参考12.4节。
            磁盘镜像的不足之处是带来了额外的开销，即磁盘镜像会将有效存储空间减半。比如，如果需要镜像一个750GB的驱动器，就需要另一个750GB的驱动器。也就是说，使用磁盘镜像时，如果需要存储750GB的数据，就需要1500GB的存储空间。
            （注解  与磁盘分割不同的是，磁盘镜像可以对任意类型的简单卷进行镜像，包括引导卷与系统卷。）
            在使用RAID-1的磁盘上，运行LIST DISK命令或DETAIL DISK命令，会发现卷类型显示为Mirrored。如果在镜像卷上使用DETAIL VOLUME命令，DiskPart会展示镜像集中两个卷。
            在镜像卷被破坏时，磁盘状态会显示为丢失。你可以在余下的磁盘上使用DETAIL DISK命令，此时显示的状态应为失败冗余，表示磁盘冗余已经失效。如果发现存在失败冗余状态，但不知道还有哪些其他磁盘是镜像集的一部分，则可以在计算机上的每块磁盘上运行DETAIL DISK命令，以便追踪出现故障的磁盘--该磁盘状态应该显示为丢失。
            典型情况下，要修复镜像集，需要移除失效磁盘、使用新磁盘对其进行替代、将新磁盘配置为镜像集的一部分等几个步骤。为此，你可以运行DiskPart，选择新磁盘，之后运行CONVERT DYNAMIC命令转换磁盘类型。之后，你需要使用BREAK DISK命令打破现存的镜像，再之后使用ADD DISK命令将新磁盘指定为添加到新镜像集中的磁盘。完成上述过程后，你可以选择镜像卷，并使用LIST VOLUME命令查看其状态。如果一切正常，状态应该显示为良好。
        2.配置磁盘镜像与双控
            要创建镜像集，可以先选择想要镜像的简单卷，之后添加一个磁盘作为镜像集中的另一个驱动器。从驱动器中至少应该包含与选定卷大小相等的未分配空间，且遵循如下步骤。
                （1）在命令提示符中键入diskpart，调用DiskPart。
                （2）列出计算机上的磁盘，并检查空闲空间，并确保待操作磁盘都已经配置为动态磁盘，使用如下命令：
                    DISKPART> list disk 
                （3）选择需要进行镜像的磁盘，下面的命令选定disk 0进行镜像：
                    DISKPART> select disk 0
                （4）添加一个磁盘，该磁盘在镜像集中用作第二块硬盘。下面的实例中，添加的是disk 1： 
                    DISKPART> add disk=1
            进行上述操作后，操作系统开始镜像创建过程，两个卷的状态都显示为再同步。如果希望DiskPart等待，直至卷完成同步才返回，则可以使用Wait参数。此外，与RAID-0中的磁盘分割类似，你也可以使用Align参数，使得分区或卷的起点与最近邻的对其边界对齐。
    12.3.3实现RAID-5：带奇偶校验的磁盘分割
        RAID-5，也称为带奇偶校验的磁盘分割。这种技术中，至少要使用3个硬盘驱动器，以便使用等同大小的卷实现容错功能。使用RAID-5关键的一个原因是，可以防止计算机的单一磁盘失效。如果两个磁盘实现，则奇偶校验信息不足以恢复数据，此时需要从备份数据中重建条带集。
        1.使用RAID-5
            你可以把RAID-5理解为增强版的RAID-0，不仅通过磁盘分割提高了性能，还通过奇偶校验增强了容错功能。因而，与RAID-0不同的是，单一驱动器的失效将不再使得整个条带集失效，而是继续使用条带集中余下的正常卷继续进行工作。并且，这些余下的正常卷还可以用于在新磁盘（或者12.4中讨论的恢复磁盘）上重建条带集。
            （警告  引导卷或系统君不能作为条带集的一部分，不要在这些卷上使用带奇偶校验的磁盘分割技术。）
            在使用RAID-5的磁盘上，运行LIST DISK命令或DETAIL DISK命令，会发现卷类型显示为RAID-5。如果在RAID-5卷上使用DETAIL VOLUME命令，DiskPart会展示其中的所有卷。
            在RAID-5卷被破坏时，磁盘状态会显示为丢失。你可以在余下的磁盘上使用DETAIL DISK命令，此时显示的状态应为失败冗余，表示磁盘冗余已经失效。如果发现存在失败冗余状态，但不知道还有哪些其他磁盘是该镜像的一部分，则可以在计算机上的每块其他磁盘上运行DETAIL DISK命令，以便追踪出现故障的磁盘--该磁盘状态应该显示为丢失。
            典型情况下，要修复RAID-5集，需要移除失效磁盘、使用新磁盘对其进行替代，将新磁盘配置为RAID-5集的一部分等几个步骤。为此，你可以运行DiskPart，选择新磁盘，之后运行CONVERT DYNAMIC命令转换磁盘类型。之后，你需要使用SELECT DISK命令选定RAID-5卷，再之后使用REPAIR DISK命令将新磁盘指定为待使用的磁盘，这将重建RAID-5集并使得新磁盘称为该集的一部分。完成上述过程后，你可以选择RAID-5卷，并使用LIST VOLUME命令查看其状态。如果一切正常，状态应该显示为良好。
        2.配置带奇偶校验的条带集
            要创建RAID-5，可以先选择3个动态磁盘。这些磁盘上应该具备足够的未分配空间，以便创建指定大小的RAID-5集。遵循如下步骤。
            （1）在命令提示符中键入diskpart，调用DiskPart。
            （2）列出计算机上的磁盘，并检查空闲空间，并确保待操作磁盘都已经配置为动态磁盘。使用如下命令：
                DISKPART> list disk 
            （3）创建RAID-5集，如下：
                DISKPART> create volume raid size=n disk=n,n,n,...
            其中，size=n表示卷在每个磁盘上使用过的空间总量（以MB计数）。如果没有指定size，DiskPart将使用最小磁盘上的所有剩余空间，并在其他磁盘上也使用这一数值。disk=n,n,n,...表示的是磁盘编号，RAID-5集将被分割在这些磁盘上，你需要使用至少3块动态磁盘。
            参考如下实例。
            使用最小磁盘上的所有可用空间在disk 2、disk 3、disk 4上创建RAID-5集，之后在剩余磁盘上使用同样的空间总量：
                create voluem raid disk=2,3,4
            使用80GB（81920MB）的空间在disk 2、disk 3、disk 4上创建RAID-5卷：
                create volume raid size=81920 disk=2,3,4
            （注解  磁盘分割与磁盘镜像类似，在RAID-5中，也可以使用Align参数使得卷、分区与最近邻对其边界对齐。但在创建RAID-5之后，不能再对其进行扩展，有鉴于此，在创建RAID-5之前，应该认真规划它。）
12.4管理RAID并从失效中恢复
    在管理镜像驱动器与条带集时，所采用的方法不同于管理其他类型的卷。如果某个镜像驱动器或条带集失效，必须以特定方式进行恢复。如果需要终止使用磁盘镜像，必须分离镜像集。如果需要终止RAID-5，必须删除整个卷集。
    12.4.1分离镜像集
        在需要终止使用磁盘镜像或重建镜像集时，都需要分离镜像集。如果不再需要对驱动器进行镜像，你可以分离镜像集，并使用安歇只存在于一个驱动器上的数据，另外驱动器上空间则可用于其他用途。如果镜像集中某个驱动器失效，磁盘操作会使用余下的磁盘驱动器继续进行。要修复镜像，必须首先分离镜像集，之后对其进行重建。
        （提示  尽管分离镜像集并不会删除镜像集中的数据，但你还是应该在分离镜像集之前对其中数据进行备份，这将确保出线故障时可以对数据进行恢复。）
        如果需要分离镜像集，可以遵循如下步骤。
        （1）在命令提示符中键入diskpart，调用DiskPart。
        （2）列出计算机上的磁盘，并确定哪些磁盘是镜像集的一部分，使用如下命令：
            DISKPART> list disk 
        （3）在指定的磁盘上分离镜像，进行分离之后，该磁盘将不再包含驱动器盘符与挂载点。比如，如果disk 0与disk 1是镜像的，现在希望用户只继续使用disk 0，则可以使用如下命令分离镜像：
            DISKPART> break disk=1 
        分离镜像之后，仍然拥有两个包含了相同信息的驱动器，但只有disk 0有可用的盘符或挂载点。如果需要在分离镜像之后丢弃第2个磁盘上的重复信息，并将其上所有磁盘空间作为未分配空间，则可以使用Nokeep参数，如下：
            DISKPART> break disk=l nokeep 
    12.4.2重新同步与修复镜像集
        镜像集中某个驱动器失效后，在恢复镜像之前，需要对镜像集进行修复。方法是分离镜像集，之后在新驱动器（或者已恢复的失效驱动器）上重建镜像。有时候，所面临的并不是直接失效，而是数据不同步的情况。比如，镜像集中某个驱动器由于某些原因脱机，从而导致数据只能写入一个驱动器汇总。
        要恢复镜像集，你需要将镜像集中的两个驱动器都联机，所采取的纠正措施则依赖于失败驱动器的具体状态，如下所示。
        · 如果驱动器状态为丢失、脱机或良好（有风险），检查该驱动器是否供电，以及物理连接是否正确。之后启动DiskPart，使用RESCAN命令检测该卷，再之后使用ONLINE命令将该磁盘联机。如果一切正常，则驱动器状态应该逐渐从正在重新生成变为良好。如果该卷状态不能变为良好，可以尝试恢复该卷。如果不能恢复，则可以尝试分离镜像，之后添加恢复的磁盘以便重建镜像。
        · 如果驱动器状态为联机（错误）、过期数据、失败、失败中或失败冗余，可以使用RECOVER命令刷新镜像集的状态。如果必须就进行恢复，之后对镜像卷进行重新同步。如果一切正常，则驱动器状态逐渐从正在重新生成（或再同步）变为良好。如果该卷状态不能变为良好，可以使用BREAK命令终止镜像，之后使用ADD命令在恢复的磁盘或新磁盘上重建镜像。
        · 如果某个驱动器状态为不可读，可以使用RESCAN命令重新扫描系统上的驱动器。如果驱动器状态没有改变，则需要重新引导计算机。
        · 如果无法使得某个驱动器联机，可以分离镜像，指定失效磁盘为待移除磁盘。替换或恢复该磁盘，之后使用ADD命令重建镜像。
        （真是场景  镜像驱动器的失效将阻止系统进行引导，这主要发生在对系统卷或引导卷进行镜像后主镜像驱动器失效等情况，对这种情况，你需要修改引导配置数据，以便将镜像集中的从驱动器用于系统启动。更多信息可以参考Windows Server 2008 Administrator's Pocket Consultant一书的第13章。）
    12.4.3修复不带奇偶校验信息的RAID-0条带集
        如前面所讨论的，RAID-0并不能提供容错功能。如果RAID-0中某个磁盘失效，则整个条带集将不可用。在尝试恢复条带集之前，你应该修复或替换失效的驱动器，之后再重建RAID-0集，并从备份中恢复数据。
    12.4.4重建带奇偶校验信息的RAID-5条带集
        如果单一驱动器失效，RAID-5可以恢复条带集。如果条带集状态变为失败冗余，则可以获知某个驱动器失效，所采取的纠正措施则依赖于驱动器的具体状态，如下所示。
        · 如果驱动器状态为丢失、脱机或良好（有风险），检查该驱动器是否供电，以及物理连接是否正确。之后，启动DiskPart，使用ONLINE命令将该卷联机。如果一切正常，则驱动器状态应该逐渐从正在重新生成变为良好。如果该卷状态不能变为良好，可以尝试恢复该卷。如果不能恢复，你可能需要使用REPAIR命令。
        · 如果驱动器状态为联机（错误）、过期数据、失败、失败中或失败冗余，可以使用RECOVER命令刷新RAID-5集的状态。如果必须就进行恢复，之后对镜像卷进行重新同步。如果一切正常，则驱动器状态逐渐从正在重新生成（或再同步）变为良好。如果驱动器状态不能变为良好，则可能需要使用REPAIR命令。
        · 如果某个驱动器状态为不可读，可以使用RESCAN命令重新扫描系统上的驱动器。如果驱动器状态没有改变，则可能需要重新引导计算机。
        · 如果某个驱动器无法联机，则可能需要使用REPAIR命令。
        你可以使用REPAIR命令修复RAID-5。如果可能，在进行这一操作之前，你应该对数据进行备份，这将确保在发生故障时恢复数据。要解决RAID-5集中过的问题，可以遵循如下步骤。
            （1）在命令提示符中键入diskpart，调用DiskPart。
            （2）列出计算机上的磁盘，以便确认RAID-5集是否却已失效，使用如下命令：
                DSIKAPRT> list disk 
            (3)如果必要并且可能，移除并替换失效的驱动器。之后指定新驱动器作为RAID-5集的一部分，使用如下命令：
                DISKPART> repair disk=n 
        其中，n指定了用于替换失效的RAID-5驱动器的动态磁盘。要注意的是，指定的磁盘必须包含足够的空闲空间（等于或大于失效RAID磁盘上已用空间总量）。此外，你可以使用Align参数，以便将新卷上分区或卷起点与最近邻的对齐边界对齐。


        