第5章  管理Windows系统

作为系统管理员，主要的工作就是规划、组织系统与网络的正常运行，并能对网络运行的一些详细信息进行追踪与分析。如果你不想敷衍了事地应付这些工作，就应该学习如何以更加高效的方式来快速地完成这些工作。幸运的是，Windows提供了大量的命令行工具来帮助管理员完成这些任务，本章将讨论一些可用于系统日常管理的重要工具。

5.1检查系统信息
    通常，在使用某用户的计算机或远程服务器时，你可能需要检查一些基本的系统信息。比如，有哪些用户登录系统、当前的系统时间或者某特定文件在系统中的存放位置等。可用于收集基本系统信息的命令包括如下4个。
    · DATE。可显示并设置当前系统日期。
    · TIME。可显示并设置当前系统时间。
    · WHOAMI。显示当前登录到系统的用户名，比如adatum\Administrator。
    · WHERE。使用某种搜索模式搜索文件，并返回一些匹配的结果。
    要使用DATE或TIME命令，可以在命令shell窗口中键入命令，其后跟随/T参数，并按Enter键。比如，命令time /t的输出为Web 03/19/2008，命令date /t的输出为04：35 PM。要设置系统日期与时间，则可以在相应命令后指定想要设置的日期或时间。设置当前日期时，输入日期的格式为MM-DD-YY。其中，MM、DD、YY分别代表用两个数字表示的月份、日期、年份。比如，要设置当前日期为2008年3月20日，则需要输入03-20-08。
    设置当前时间时，输入时间的格式为HH：MM或HH：MM：SS。其中，HH、MM、SS分别为两个数字表示的小时、分数、面熟。如果输入时间时没有指定A.M.说P.M.，则系统会默认使用24小时制。其中，HH为00到11时代表A.M.，12到23时代表P.M.。下面几条命令的结果都是将时间设置为下午4点45分：
        time 04:45 PM
        time 04:45:00 PM
        time 16:45:00
    要使用WHOAMI命令来确定当前登录系统的用户，可以在命令shell窗口中键入该命令，之后按Enter键。如果该计算机是某工作组的一部分，则输出信息包括该计算机名，其后跟随一个反斜杠，之后跟随登录用户名，比如computer84\deanr。如果该计算机是某个域的一部分，则输出信息包括该计算机所属的域名，其后跟随一个反斜杠，之后跟随登录用户名，比如adatum\williams。
    默认情况下，WHERE命令会在当前目录以及环境变量PATH指定的路径中进行搜索。因此，只要在命令shell窗口中键入where命令，其后跟随要搜索的可执行程序名，就可以快速地在当前路径中搜索该可执行程序。比如，要想搜索CMD.EXE，可以键入如下命令：
        where cmd.exe
    上面命令的输出结果为CMD.EXE的全文件路径：
        c:\windows\system32\cmd.exe
    使用where命令时，还有一种最常用的语法格式为：
        where /r baseDir filename
    上面的命令格式中，/r代表从指定的目录（\baseDir）开始递归搜索，包含所有子目录。filename代表要搜索文件的全名或部分名，其中可以包括通配符。？可以匹配单个字符，*可以匹配多个字符。比如，data???.txt或data*.*。下面的命令会在c:\目录及其所有子目录下搜索文件名以data开始的文本文件：
        where /r c:\data*.txt
    下面的命令则搜索文件名以data开始的所有类型文件：
        where /r c:\data*.*
    有时候，可能需要获取系统配置信息或系统环境信息。对于那些关键性的系统，可能还需要将这些信息保存或打印出来，用来检索和使用。如下一些命令可以帮助管理员收集系统信息。
    · DRIVERQUERY。该命令可以显示一个列表，其中列出了系统中所有已安装的设备驱动程序及其属性，包括模块名、显示名、驱动程序类型、驱动程序连接日期等信息。使用详细模式进行输出时，该命令还会列出驱动程序状况、状态、启动模式、内存使用情况、文件系统路径等信息。通过使用/v参数，可以获取所有未签名驱动程序的详细输出。
    · SYSTEMINFO。该命令可以显示详细的系统配置信息，包括操作系统版本、系统类型、系统制造商、处理器、BIOS版本、内存大小、系统区域设置、时区设置、网卡配置等信息。此外，该命令还可以显示系统中已经安装了哪些热点补丁。
    要在本地系统中使用这些命令，可以在命令shell窗口中键入命令名，之后按回车。使用DRIVERQUERY命令时，可以指定/v参数来获取未签名驱动程序的详细信息，也可以指定/Si参数来显示签名驱动程序的属性信息，比如：
        driverquery /si
    使用DRIVERQUERY命令与SYSTEMINFO命令时，也可以指定要查询的远程计算机与运行许可权限。要做到这些，必须使用扩展的语法格式，包括如下参数：
        /S Computer /U [Domain\] User [/P Password]
    其中，Computer代表远程计算机名或IP地址，Domain代表域名（可选的，用户账号存在于该域内），User代表用户账号名（想使用的就是该用户的许可权限），Password代表该用户账号的口令（可选的）。如果不指定域名，则命令shell会将当前域名假定为该用户所在的域。如果不提供账号口令，则系统会呈现一个提示符要求输入口令。
    要具体了解计算机与用户信息怎样被添加到这种扩展的语法格式中，可以参考如下的实例。
    使用账号adatum\wrstanek查询MAILER1的驱动程序设置：
        driverquery /s mailer1 /u adatum\wrstanek
    使用账号adatum\administrator查询CORPSERVER01的系统信息：
        systeminfo /s corpserver01 /u adatum\administrator
    （提示  这些命令的基本输出格式为表格格式。通过使用/Fo List或/Fo Csv，也可以将输出格式分别转换为列表或以逗号分隔开的行，之所以要使用不同的输出格式，是因为不同格式命令的输出信息存在较大差别。比如，使用SYSTEMINFO命令时，如果想查看关于系统配置信息的所有详细资料，可以使用列表格式输出/Fo List）;使用DRIVERQUERY命令时，如果正在对未签名驱动程序进行故障排除，则可以使用详细列表格式输出（/Fo List  /v）。进一步地，对于以后可能会导出到电子表格或非关系数据库的文件，建议使用逗号分隔的行格式进行存储。此外，通过使用输出重定向符号（>或>>）,可以将DRIVERQUERY命令与SYSTEMINFO命令的输出信息重定向到特定的文件。）
5.2操作注册表
    Windows注册表存储了配置信息，通过使用命令行工具Reg，可以很方便地对注册表进行查看、添加、删除、比较、复制等操作。由于Windows注册表对Windows系统的正确运行是至关重要的，在修改注册表之前，要确保已经理解所作的修改对系统会有怎样的影响。在以任何方式编辑注册表之前，应该进行完全的系统备份，并创建系统恢复数据快照。这种做的发意义在于：如果所做的修改是错误的，或者对系统有不利影响，就可以通过备份数据对系统与注册表进行恢复。
    （警告  错误修改Windows注册表可能会引发严重问题，如果对注册表造成严重损坏，你可能不得不重装系统。在执行注册表相关命令之前，要认真理解该命令的用法，确保这些命令能正确地达到预定执行目标。）
    5.2.1理解注册表与键值
        Windows注册表存储了操作系统、应用程序、用户以及硬件等设备的配置设置信息。这些信息是以注册表键与键值的形式存储的，注册表键与键值存储在特定的root键下，并由其控制不同键与键值的使用时间和方式。
        表列出了注册表的root键及其描述信息，
